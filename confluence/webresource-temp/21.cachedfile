WRMCB=function(e){var c=console;if(c&&c.log&&c.error){c.log('Error running batched script.');c.error(e);}}
;
try {
/* module-key = 'com.atlassian.auiplugin:internal-src-js-aui-dialog2', location = 'src/js/aui/dialog2.js' */
("undefined"===typeof window?global:window).__df7047d25e7ae0c2f22a17f939177597=function(){function f(a){return a&&a.__esModule?a:{"default":a}}function e(a){var c=this.$el=a?(0,g.default)(a):(0,g.default)(aui.dialog.dialog2({}));g.default.each(i,function(a,b){var d="data-"+a;c[0].hasAttribute(d)||c.attr(d,b)})}var h={};"use strict";Object.defineProperty(h,"__esModule",{value:!0});var g=f(__700a145ba3db9966cc95664c892049f8),j=f(__65ca28a9d6b0f244027266ff8e6a6d1c),k=f(__28c84e7bb75f6c3b0ba124d57bd69571),
b=f(__3ada4a8272640e5242be87f12c7e0fdf),l=f(__d2e8fc66dac2ecebdc205fcab991f687),i={"aui-focus":"false","aui-blanketed":"true"};e.prototype.on=function(a,c){(0,b.default)(this.$el).on(a,c);return this};e.prototype.off=function(a,c){(0,b.default)(this.$el).off(a,c);return this};e.prototype.show=function(){(0,b.default)(this.$el).show();return this};e.prototype.hide=function(){(0,b.default)(this.$el).hide();return this};e.prototype.remove=function(){(0,b.default)(this.$el).remove();return this};e.prototype.isVisible=
function(){return(0,b.default)(this.$el).isVisible()};var d=(0,l.default)("dialog2",e);d.on=function(a,c){b.default.on(a,".aui-dialog2",c);return this};d.off=function(a,c){b.default.off(a,".aui-dialog2",c);return this};(0,g.default)(document).on("click",".aui-dialog2-header-close",function(a){a.preventDefault();d((0,g.default)(this).closest(".aui-dialog2")).hide()});d.on("show",function(a,c){var b;[".aui-dialog2-content",".aui-dialog2-footer",".aui-dialog2-header"].some(function(a){b=c.find(a+" :aui-tabbable");
return b.length});b&&b.first().focus()});d.on("hide",function(a,c){var d=(0,b.default)(c);c.data("aui-remove-on-hide")&&d.remove()});(0,j.default)("aui/dialog2",d);(0,k.default)("dialog2",d);h.default=d;return h=h["default"]}.call(this);
}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.atlassian.auiplugin:dialog2', location = 'src/soy/dialog2.soy' */
// This file was automatically generated from dialog2.soy.
// Please don't edit this file by hand.

/**
 * @fileoverview Templates in namespace aui.dialog.
 */

if (typeof aui == 'undefined') { var aui = {}; }
if (typeof aui.dialog == 'undefined') { aui.dialog = {}; }


aui.dialog.dialog2 = function(opt_data, opt_ignored) {
  return '' + aui.dialog.dialog2Chrome({id: opt_data.id, titleId: opt_data.id ? opt_data.id + '-dialog-title' : null, modal: opt_data.modal, tagName: opt_data.tagName, removeOnHide: opt_data.removeOnHide, visible: opt_data.visible, size: opt_data.size, extraClasses: opt_data.extraClasses, extraAttributes: opt_data.extraAttributes, content: '' + aui.dialog.dialog2Content({id: null, titleText: opt_data.titleText, titleContent: opt_data.titleContent, headerActionContent: opt_data.headerActionContent, headerSecondaryContent: opt_data.headerSecondaryContent, modal: opt_data.modal, content: opt_data.content, footerHintText: opt_data.footerHintText, footerHintContent: opt_data.footerHintContent, footerActionContent: opt_data.footerActionContent})});
};
if (goog.DEBUG) {
  aui.dialog.dialog2.soyTemplateName = 'aui.dialog.dialog2';
}


aui.dialog.dialog2Chrome = function(opt_data, opt_ignored) {
  opt_data = opt_data || {};
  return '<' + soy.$$escapeHtml(opt_data.tagName ? opt_data.tagName : 'section') + ((opt_data.id) ? ' id="' + soy.$$escapeHtml(opt_data.id) + '"' : '') + ((opt_data.titleId) ? ' aria-labelledby="' + soy.$$escapeHtml(opt_data.titleId) + '"' : '') + ' role="dialog" class=" aui-layer aui-dialog2 aui-dialog2-' + soy.$$escapeHtml(opt_data.size ? opt_data.size : 'medium') + aui.renderExtraClasses(opt_data) + '"' + ((opt_data.modal) ? 'data-aui-modal="true"' : '') + ((opt_data.removeOnHide) ? 'data-aui-remove-on-hide="true"' : '') + ((opt_data.visible != true) ? 'aria-hidden="true"' : '') + aui.renderExtraAttributes(opt_data) + '>' + ((opt_data.content) ? soy.$$filterNoAutoescape(opt_data.content) : '') + '</' + soy.$$escapeHtml(opt_data.tagName ? opt_data.tagName : 'section') + '>';
};
if (goog.DEBUG) {
  aui.dialog.dialog2Chrome.soyTemplateName = 'aui.dialog.dialog2Chrome';
}


aui.dialog.dialog2Content = function(opt_data, opt_ignored) {
  opt_data = opt_data || {};
  return '' + aui.dialog.dialog2Header({titleId: opt_data.id ? opt_data.id + '-dialog-title' : null, titleText: opt_data.titleText, titleContent: opt_data.titleContent, actionContent: opt_data.headerActionContent, secondaryContent: opt_data.headerSecondaryContent, modal: opt_data.modal}) + aui.dialog.dialog2Panel(opt_data) + aui.dialog.dialog2Footer({hintText: opt_data.footerHintText, hintContent: opt_data.footerHintContent, actionContent: opt_data.footerActionContent});
};
if (goog.DEBUG) {
  aui.dialog.dialog2Content.soyTemplateName = 'aui.dialog.dialog2Content';
}


aui.dialog.dialog2Header = function(opt_data, opt_ignored) {
  opt_data = opt_data || {};
  return '<header' + ((opt_data.id) ? ' id="' + soy.$$escapeHtml(opt_data.id) + '"' : '') + ' class="aui-dialog2-header' + aui.renderExtraClasses(opt_data) + '"' + aui.renderExtraAttributes(opt_data) + '><h2 ' + ((opt_data.titleId) ? ' id="' + soy.$$escapeHtml(opt_data.titleId) + '"' : '') + ' class="aui-dialog2-header-main">' + ((opt_data.titleText) ? soy.$$escapeHtml(opt_data.titleText) : '') + ((opt_data.titleContent) ? soy.$$filterNoAutoescape(opt_data.titleContent) : '') + '</h2>' + ((opt_data.actionContent) ? '<div class="aui-dialog2-header-actions">' + soy.$$filterNoAutoescape(opt_data.actionContent) + '</div>' : '') + ((opt_data.secondaryContent) ? '<div class="aui-dialog2-header-secondary">' + soy.$$filterNoAutoescape(opt_data.secondaryContent) + '</div>' : '') + ((opt_data.modal != true) ? '<a class="aui-dialog2-header-close"><span class="aui-icon aui-icon-small aui-iconfont-close-dialog">' + soy.$$escapeHtml('\u0417\u0430\u043a\u0440\u044b\u0442\u044c') + '</span></a>' : '') + '</header>';
};
if (goog.DEBUG) {
  aui.dialog.dialog2Header.soyTemplateName = 'aui.dialog.dialog2Header';
}


aui.dialog.dialog2Footer = function(opt_data, opt_ignored) {
  opt_data = opt_data || {};
  return '<footer' + ((opt_data.id) ? ' id="' + soy.$$escapeHtml(opt_data.id) + '"' : '') + ' class="aui-dialog2-footer' + aui.renderExtraClasses(opt_data) + '"' + aui.renderExtraAttributes(opt_data) + '>' + ((opt_data.actionContent) ? '<div class="aui-dialog2-footer-actions">' + soy.$$filterNoAutoescape(opt_data.actionContent) + '</div>' : '') + ((opt_data.hintText || opt_data.hintContent) ? '<div class="aui-dialog2-footer-hint">' + ((opt_data.hintText) ? soy.$$escapeHtml(opt_data.hintText) : '') + ((opt_data.hintContent) ? soy.$$filterNoAutoescape(opt_data.hintContent) : '') + '</div>' : '') + '</footer>';
};
if (goog.DEBUG) {
  aui.dialog.dialog2Footer.soyTemplateName = 'aui.dialog.dialog2Footer';
}


aui.dialog.dialog2Panel = function(opt_data, opt_ignored) {
  opt_data = opt_data || {};
  return '<div' + ((opt_data.id) ? ' id="' + soy.$$escapeHtml(opt_data.id) + '"' : '') + ' class="aui-dialog2-content' + aui.renderExtraClasses(opt_data) + '"' + aui.renderExtraAttributes(opt_data) + '>' + ((opt_data.content) ? soy.$$filterNoAutoescape(opt_data.content) : '') + '</div>';
};
if (goog.DEBUG) {
  aui.dialog.dialog2Panel.soyTemplateName = 'aui.dialog.dialog2Panel';
}

}catch(e){WRMCB(e)};
;
try {
/* module-key = 'confluence.web.resources:page-loading-indicator', location = '/includes/js/page-loading-indicator.js' */
define("confluence/page-loading-indicator",["jquery","underscore","ajs","confluence/templates"],function(c,g,a,h){return function(b){function d(){return c(".confluence-page-loading-blanket",b)}function e(){return c(".confluence-loading-indicator",b)}return{show:function(){0===d().length&&c(b).append(h.pageLoadingIndicator());d().show();e().spin({lines:12,length:8,width:4,radius:10,trail:60,speed:1.5,color:"#F0F0F0"})},hide:function(){e().stop();d().hide()},showUntilResolved:function(c,b){this.show();
c.always(g.bind(this.hide,this));b&&c.fail(function(){a.messages.error(".confluence-page-loading-errors",{body:b})})},showUntilDialogVisible:function(b,d){var f=this,e=d||"\u041f\u0440\u0438 \u043f\u043e\u0434\u043a\u043b\u044e\u0447\u0435\u043d\u0438\u0438 \u043a \u0441\u0435\u0440\u0432\u0435\u0440\u0443 \u0432\u043e\u0437\u043d\u0438\u043a\u043b\u0430 \u043e\u0448\u0438\u0431\u043a\u0430. \u041f\u043e\u043f\u0440\u043e\u0431\u0443\u0439\u0442\u0435 \u0441\u043d\u043e\u0432\u0430.",g=c(".aui-dialog:visible"),h=c(".aui-dialog2:visible");!g.length&&!h.length&&f.show();b.always(f.hide).fail(function(){a.messages.error(".confluence-page-loading-errors",{body:e})});a.bind("show.dialog",function i(){a.unbind("show.dialog",i);f.hide()});if(null!=a.dialog2&&void 0!=a.dialog2)a.dialog2.on("show",
function j(){a.dialog2.off("show",j);f.hide()})},destroy:function(){b.remove(".confluence-page-loading-blanket")}}}});require("confluence/module-exporter").exportModuleAsGlobal("confluence/page-loading-indicator","Confluence.PageLoadingIndicator");
}catch(e){WRMCB(e)};
;
try {
/* module-key = 'confluence.web.resources:page-loading-indicator', location = '/includes/soy/page-loading-indicator.soy' */
// This file was automatically generated from page-loading-indicator.soy.
// Please don't edit this file by hand.

/**
 * @fileoverview Templates in namespace Confluence.Templates.
 */

if (typeof Confluence == 'undefined') { var Confluence = {}; }
if (typeof Confluence.Templates == 'undefined') { Confluence.Templates = {}; }


Confluence.Templates.pageLoadingIndicator = function(opt_data, opt_ignored) {
  return '<div class="confluence-page-loading-errors"></div><div class="confluence-page-loading-blanket aui-blanket" aria-hidden="false"><div class="confluence-loading-indicator"></div></div>';
};
if (goog.DEBUG) {
  Confluence.Templates.pageLoadingIndicator.soyTemplateName = 'Confluence.Templates.pageLoadingIndicator';
}

}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.atlassian.confluence.plugins.confluence-onboarding:onboarding-common-resources', location = 'common/user.js' */
define("confluence/ob/common/user",["ajs"],function(b){var a={};a.isAdmin=function(){return b.Meta.get("is-confluence-admin")};a.isFirstSpaceCreated=function(){return b.Meta.get("is-first-space-created")};a.hasCreateSpacePermission=function(){return b.Meta.get("has-create-space-permission")};a.getFullName=function(){return b.Meta.get("current-user-fullname")};a.getUsername=function(){return b.Meta.get("remote-user")};a.getUserId=function(){return b.Meta.get("remote-user-key")};a.getUserLocale=function(){return b.Meta.get("user-locale")};return a});
}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.atlassian.confluence.plugins.confluence-onboarding:onboarding-common-resources', location = 'common/common-core.js' */
define("confluence/ob/common/common-core",["jquery"],function($){var CommonCore={};CommonCore.isEnglishLocale=function(){return !!CommonCore.getLocale().match(/^en/)};CommonCore.getLocale=function(){return AJS.Meta.get("user-locale")};CommonCore.getLocaleSupportedInfo=function(){var info={};info.locale=CommonCore.getLocale();info.supported=CommonCore.isEnglishLocale();return info};CommonCore.getContextPath=function(){return AJS.contextPath()};function sendAnalyticsEvent(eventName,data,isAjax){if(isAjax){return $.ajax({type:"POST",url:CommonCore.getContextPath()+"/rest/analytics/1.0/publish/bulk",data:JSON.stringify([{name:eventName,properties:data||{}}]),contentType:"application/json",dataType:"json"})}else{AJS.trigger("analyticsEvent",{name:eventName,data:data||{}})}}CommonCore.sendAnalyticsEvent=function(eventName,data){return sendAnalyticsEvent(eventName,data,false)};CommonCore.sendFlattenedAnalyticsEvent=function(eventName,data){return sendAnalyticsEvent(eventName,flatten(data),false)};CommonCore.sendAnalyticsEventViaAjax=function(eventName,data){var promise=sendAnalyticsEvent(eventName,data,true);if(typeof promise==="undefined"){promise=$.Deferred().resolve().promise()}return promise};CommonCore.isLoggedIn=function(){return !!AJS.Meta.get("remote-user")};CommonCore.getGlobal=function(){return(function(){return this||(0||eval)("this")}())};CommonCore.getAtlToken=function(){return $("#atlassian-token").attr("content")};CommonCore.isAnalyticsAvailable=function(){return !!(typeof AJS!=="undefined"&&AJS.EventQueue)};CommonCore.setGROW=function(property,value){var global=CommonCore.getGlobal();if(!global.GROW){global.GROW={}}global.GROW[property]=value};return CommonCore});
}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.atlassian.confluence.plugins.confluence-onboarding:onboarding-common-resources', location = 'common/page-utils.js' */
define("confluence/ob/common/page-utils",["jquery","ajs"],function(d,b){var a={};var c=Confluence.PageLoadingIndicator(d("body"));a.showLoadingIndicator=function(){c.show()};a.hideLoadingIndicator=function(){c.hide()};a.createPageDraft=function(e){return d.ajax({type:"GET",url:b.contextPath()+"/rest/onboarding/1/draft/generate?spaceKey="+e,contentType:"application/json",dataType:"json"})};a.isAdmin=function(){return d("#admin-menu-link-conf-admin").length!==0};a.isSiteAdmin=function(){return !!d("#admin-menu-link-site_admin_section").length};a.isOnSpaceHomePage=function(){return d("#title-heading").find("#breadcrumbs").find("li").length===1};a.getContextPath=function(){return b.contextPath};return a});
}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.atlassian.confluence.plugins.confluence-onboarding:onboarding-common-resources', location = 'common/space-utils.js' */
define("confluence/ob/common/space-utils",["jquery","ajs","confluence/ob/common/common-core","confluence/ob/common/test-evaluator"],function(f,a,c,e){var d={};var b=a.contextPath();var g="SPC";d.SPACE_DEMO_DESC="efionboardingspace";d.generateSpaceKey=function(h){var i=new KeyGenerator();return i.generateKey(h,{desiredKeyLength:4,maxKeyLength:10})||g};d.generateUniqueSpaceKey=function(i){var h=f.Deferred();f.ajax({url:b+"/rest/onboarding/1/space/generate?key="+i,type:"GET",contentType:"application/json",success:function(j){h.resolve(j.key)},error:function(k){if(k.status===401){h.reject({status:401,msg:"Unauthorized"})}else{if(k.status===504){h.reject({status:504,msg:"Gateway timeout"})}else{var j={status:k.status};h.reject(j)}}}});return h.promise()};d.createSpace=function(i,j){var h=f.Deferred();if(a.DarkFeatures.isEnabled("confluence.efi.onboarding.rich.space.content")){f.ajax({url:b+"/rest/onboarding/1/space",type:"POST",contentType:"application/json",dataType:"json",data:JSON.stringify({name:i,key:j,temporary:e.isTestingEvaluator()})}).done(function(l){h.resolve(l)}).fail(function(o){if(o.status===401){h.reject({status:401,msg:"Unauthorized"})}else{if(o.status===504){h.reject({status:504,msg:"Gateway timeout"})}else{var n="Unexpected error";try{var l=JSON.parse(o.responseText);if(l&&l.error){n=l.message}}catch(m){}h.reject({status:o.status,msg:n})}}})}else{var k={name:i,key:j};if(e.isTestingEvaluator()){k.description={plain:{value:d.SPACE_DEMO_DESC,representation:"plain"}}}f.ajax({url:b+"/rest/api/space",type:"POST",contentType:"application/json",dataType:"json",data:JSON.stringify(k),success:function(l){h.resolve(l)},error:function(o){if(o.status===401){h.reject({status:401,msg:"Unauthorized"})}else{if(o.status===504){h.reject({status:504,msg:"Gateway timeout"})}else{var n="An unexpected error occurred.";try{var l=JSON.parse(o.responseText);if(l&&l.message){n=l.message}}catch(m){}h.reject({status:o.status,msg:n})}}}})}return h.promise()};d.deleteSpace=function(i){var h=f.Deferred();f.ajax({type:"DELETE",url:b+"/rest/api/space/"+i,success:function(j){h.resolve(j)},error:function(j){h.reject(j)}});return h.promise()};d.getAvailableBlueprints=function(k){var h=f.Deferred();var j=(new Date()).valueOf().toString();var i=[c.getContextPath(),"/rest/create-dialog/1.0/blueprints/web-items?spaceKey=",k,"&_=",j].join("");f.ajax({url:i,dataType:"json"}).then(function(l){h.resolve(l)},function(){h.reject()});return h};return d});
}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.atlassian.confluence.plugins.confluence-onboarding:onboarding-common-resources', location = 'common/youtube-player.js' */
define("confluence/ob/common/youtube-player",["jquery"],function(g){var b={};var d;var a;var c=false;b.EVENT_CLICK="grow.common.youtubeplayer.click";b.EVENT_FINISH="grow.common.youtubeplayer.finish";b.embedVideo=function(i,k,j){if(typeof(YT)=="undefined"||typeof(YT.Player)=="undefined"){window.onYouTubePlayerAPIReady=function(){f(i,k,j)};g.getScript("//www.youtube.com/player_api")}else{f(i,k,j)}};b.destroy=function(){d&&d.destroy()};b.getCurrentTime=function(){try{return d.getCurrentTime()}catch(i){return -1}};b.getDuration=function(){try{return d.getDuration()}catch(i){return -1}};function f(i,l,k){k=k||{};var j=window.location.origin;if(j){j=window.location.protocol+"//"+window.location.host}d=new YT.Player(i,{playerVars:{modestbranding:1,rel:0,showinfo:0,autoplay:k.autoplay||0,origin:j,cc_load_policy:k.hl?1:0,hl:k.hl},height:k.height||315,width:k.width||560,videoId:l,events:{onReady:h,onStateChange:e}})}function h(i){a=d.getPlayerState()}function e(j){var i="";var m="";var k=j.data;if(k===YT.PlayerState.ENDED){i=b.EVENT_FINISH}else{if(k===YT.PlayerState.PLAYING&&a===YT.PlayerState.PAUSED){i=b.EVENT_CLICK;m="resume"}else{if(k===YT.PlayerState.PLAYING&&!c){c=true;i=b.EVENT_CLICK;m="start"}else{if(k===YT.PlayerState.PAUSED&&a===YT.PlayerState.PAUSED){i=b.EVENT_CLICK;m="skip"}else{if(k===YT.PlayerState.PAUSED&&j.target.getCurrentTime()!==d.getDuration()){i=b.EVENT_CLICK;m="pause"}}}}}if(i){a=d.getPlayerState();var l={};if(m){l.clickType=m}g(b).trigger(i,l)}}return b});
}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.atlassian.confluence.plugins.confluence-onboarding:onboarding-common-resources', location = 'common/promise.js' */
define("confluence/ob/common/promise",["jquery","underscore"],function(c,a){function b(g){var f=c.Deferred(),e=a.bind(f.resolve,f),d=a.bind(f.reject,f);if(typeof g!=="function"){throw Error("Argument resolver must be a function")}g(e,d);return f.promise()}return b});
}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.atlassian.confluence.plugins.confluence-onboarding:onboarding-common-resources', location = 'common/test-evaluator.js' */
define("confluence/ob/common/test-evaluator",[],function(){return{isTestingEvaluator:function(){return sessionStorage.getItem("onboarding-test-evaluator")==="true"},resetTestingEvaluator:function(){sessionStorage.setItem("onboarding-test-evaluator",window.location.href.indexOf("/welcome.action?evaluator=true")!=-1)}}});
}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.atlassian.confluence.plugins.confluence-onboarding:onboarding-common-resources', location = 'common/bacon.js' */
define("confluence/ob/common/bacon",[],function(){var t,al,n,aq,I,w,x,A,ae,y,j,E,ag,ad,h,p,aj,v,C,an,ai,H,u,g,R,X,am,Z,r,J,T,aa,ab,ah,D,e,N,m,z,b,o,ap,L,q,B,a,av,ac,aw,at,V,G,d,Q,U,ak,ar,Y,ax,F,f,k,s,c,P,au,S,M,K,W,i,af={}.hasOwnProperty,O=function(aB,az){for(var ay in az){if(af.call(az,ay)){aB[ay]=az[ay]}}function aA(){this.constructor=aB}aA.prototype=az.prototype;aB.prototype=new aA();aB.__super__=az.prototype;return aB},l=[].slice,ao=function(ay,az){return function(){return ay.apply(az,arguments)}};t={toString:function(){return"Bacon"}};t.version="0.7.70";E=(typeof global!=="undefined"&&global!==null?global:this).Error;ar=function(){};aw=function(az,ay){return ay};L=function(ay,az){return ay};aa=function(ay){return ay.slice(0)};g=function(ay,az){if(!az){throw new E(ay)}};J=function(ay){if(ay instanceof p&&!(ay instanceof aj)){throw new E("Observable is not a Property : "+ay)}};X=function(ay){if(!(ay instanceof j)){throw new E("not an EventStream : "+ay)}};r=function(ay){if(!(ay instanceof p)){throw new E("not an Observable : "+ay)}};am=function(ay){return g("not a function : "+ay,H.isFunction(ay))};a=function(ay){return ay instanceof Array};ac=function(ay){return ay instanceof p};R=function(ay){if(!a(ay)){throw new E("not an array : "+ay)}};Z=function(ay){return g("no arguments supported",ay.length===0)};T=function(ay){if(typeof ay!=="string"){throw new E("not a string : "+ay)}};H={indexOf:Array.prototype.indexOf?function(az,ay){return az.indexOf(ay)}:function(aB,ay){var aC,aA,az,aD;for(aC=aA=0,az=aB.length;aA<az;aC=++aA){aD=aB[aC];if(ay===aD){return aC}}return -1},indexWhere:function(aA,aC){var aB,az,ay,aD;for(aB=az=0,ay=aA.length;az<ay;aB=++az){aD=aA[aB];if(aC(aD)){return aB}}return -1},head:function(ay){return ay[0]},always:function(ay){return function(){return ay}},negate:function(ay){return function(az){return !ay(az)}},empty:function(ay){return ay.length===0},tail:function(ay){return ay.slice(1,ay.length)},filter:function(aD,aC){var aB,aA,az,ay;aB=[];for(aA=0,az=aC.length;aA<az;aA++){ay=aC[aA];if(aD(ay)){aB.push(ay)}}return aB},map:function(aD,aB){var aA,az,aC,ay;aC=[];for(aA=0,az=aB.length;aA<az;aA++){ay=aB[aA];aC.push(aD(ay))}return aC},each:function(ay,aB){var az,aA;for(az in ay){if(!af.call(ay,az)){continue}aA=ay[az];aB(az,aA)}return void 0},toArray:function(ay){if(a(ay)){return ay}else{return[ay]}},contains:function(az,ay){return H.indexOf(az,ay)!==-1},id:function(ay){return ay},last:function(ay){return ay[ay.length-1]},all:function(aB,aC){var aA,az,ay;if(aC==null){aC=H.id}for(aA=0,az=aB.length;aA<az;aA++){ay=aB[aA];if(!aC(ay)){return false}}return true},any:function(aB,aC){var aA,az,ay;if(aC==null){aC=H.id}for(aA=0,az=aB.length;aA<az;aA++){ay=aB[aA];if(aC(ay)){return true}}return false},without:function(ay,az){return H.filter((function(aA){return aA!==ay}),az)},remove:function(ay,az){var aA;aA=H.indexOf(az,ay);if(aA>=0){return az.splice(aA,1)}},fold:function(aC,az,aD){var aB,aA,ay;for(aB=0,aA=aC.length;aB<aA;aB++){ay=aC[aB];az=aD(az,ay)}return az},flatMap:function(az,ay){return H.fold(ay,[],(function(aB,aA){return aB.concat(az(aA))}))},cached:function(az){var ay;ay=h;return function(){if(ay===h){ay=az();az=void 0}return ay}},isFunction:function(ay){return typeof ay==="function"},toString:function(aC){var az,aA,ay,aB;try{ax++;if(aC==null){return"undefined"}else{if(H.isFunction(aC)){return"function"}else{if(a(aC)){if(ax>5){return"[..]"}return"["+H.map(H.toString,aC).toString()+"]"}else{if(((aC!=null?aC.toString:void 0)!=null)&&aC.toString!==Object.prototype.toString){return aC.toString()}else{if(typeof aC==="object"){if(ax>5){return"{..}"}aA=(function(){var aD;aD=[];for(ay in aC){if(!af.call(aC,ay)){continue}aB=(function(){try{return aC[ay]}catch(aE){az=aE;return az}})();aD.push(H.toString(ay)+":"+H.toString(aB))}return aD})();return"{"+aA+"}"}else{return aC}}}}}}finally{ax--}}};ax=0;t._=H;ai=t.UpdateBarrier=(function(){var aD,aK,az,aA,aH,aL,aI,aJ,aG,ay,aB,aC,aE,aF;ay=void 0;aB=[];aC={};aK=[];az=0;aD=function(aM){if(ay){return aK.push(aM)}else{return aM()}};aE=function(aO,aM){var aN;if(ay){aN=aC[aO.id];if(aN==null){aN=aC[aO.id]=[aM];return aB.push(aO)}else{return aN.push(aM)}}else{return aM()}};aH=function(){while(aB.length>0){aI(0)}return void 0};aI=function(aP){var aQ,aO,aN,aS,aM,aR;aS=aB[aP];aM=aS.id;aR=aC[aM];aB.splice(aP,1);delete aC[aM];aL(aS);for(aO=0,aN=aR.length;aO<aN;aO++){aQ=aR[aO];aQ()}return void 0};aL=function(aR){var aP,aQ,aO,aN,aM;aQ=aR.internalDeps();for(aN=0,aM=aQ.length;aN<aM;aN++){aP=aQ[aN];aL(aP);if(aC[aP.id]){aO=H.indexOf(aB,aP);aI(aO)}}return void 0};aG=function(aP,aO,aQ,aN){var aR,aM;if(ay){return aQ.apply(aO,aN)}else{ay=aP;try{aM=aQ.apply(aO,aN);aH()}finally{ay=void 0;while(az<aK.length){aR=aK[az];az++;aR()}az=0;aK=[]}return aM}};aA=function(){if(ay){return ay.id}else{return void 0}};aF=function(aR,aQ){var aP,aM,aO,aN;aN=false;aM=false;aP=function(){return aM=true};aO=function(){aN=true;return aP()};aP=aR.dispatcher.subscribe(function(aS){return aD(function(){var aT;if(!aN){aT=aQ(aS);if(aT===t.noMore){return aO()}}})});if(aM){aP()}return aO};aJ=function(){return aB.length>0};return{whenDoneWith:aE,hasWaiters:aJ,inTransaction:aG,currentEventId:aA,wrappedSubscribe:aF,afterTransaction:aD}})();an=(function(){function ay(az,aB,aA){this.obs=az;this.sync=aB;this.lazy=aA!=null?aA:false;this.queue=[]}ay.prototype.subscribe=function(az){return this.obs.dispatcher.subscribe(az)};ay.prototype.toString=function(){return this.obs.toString()};ay.prototype.markEnded=function(){return this.ended=true};ay.prototype.consume=function(){if(this.lazy){return{value:H.always(this.queue[0])}}else{return this.queue[0]}};ay.prototype.push=function(az){return this.queue=[az]};ay.prototype.mayHave=function(){return true};ay.prototype.hasAtLeast=function(){return this.queue.length};ay.prototype.flatten=true;return ay})();I=(function(ay){O(az,ay);function az(){return az.__super__.constructor.apply(this,arguments)}az.prototype.consume=function(){return this.queue.shift()};az.prototype.push=function(aA){return this.queue.push(aA)};az.prototype.mayHave=function(aA){return !this.ended||this.queue.length>=aA};az.prototype.hasAtLeast=function(aA){return this.queue.length>=aA};az.prototype.flatten=false;return az})(an);al=(function(ay){O(az,ay);function az(aA){az.__super__.constructor.call(this,aA,true)}az.prototype.consume=function(){var aA;aA=this.queue;this.queue=[];return{value:function(){return aA}}};az.prototype.push=function(aA){return this.queue.push(aA.value())};az.prototype.hasAtLeast=function(){return true};return az})(an);an.isTrigger=function(ay){if(ay instanceof an){return ay.sync}else{return ay instanceof j}};an.fromObservable=function(ay){if(ay instanceof an){return ay}else{if(ay instanceof aj){return new an(ay,false)}else{return new I(ay,true)}}};w=(function(){function ay(aB,az,aA){this.context=aB;this.method=az;this.args=aA}ay.prototype.deps=function(){return this.cached||(this.cached=b([this.context].concat(this.args)))};ay.prototype.toString=function(){return H.toString(this.context)+"."+H.toString(this.method)+"("+H.map(H.toString,this.args)+")"};return ay})();e=function(){var ay,az,aA;az=arguments[0],aA=arguments[1],ay=3<=arguments.length?l.call(arguments,2):[];if((az||aA) instanceof w){return az||aA}else{return new w(az,aA,ay)}};W=function(ay,az){az.desc=ay;return az};b=function(ay){if(a(ay)){return H.flatMap(b,ay)}else{if(ac(ay)){return[ay]}else{if(ay instanceof an){return[ay.obs]}else{return[]}}}};t.Desc=w;t.Desc.empty=new t.Desc("","",[]);i=function(ay){return function(){var aA,aB,aC,az;aC=arguments[0],aA=2<=arguments.length?l.call(arguments,1):[];if(typeof aC==="object"&&aA.length){aB=aC;az=aA[0];aC=function(){return aB[az].apply(aB,arguments)};aA=aA.slice(1)}return ay.apply(null,[aC].concat(l.call(aA)))}};G=function(ay){ay=Array.prototype.slice.call(ay);return d.apply(null,ay)};Y=function(az,ay){return function(){var aA;aA=1<=arguments.length?l.call(arguments,0):[];return az.apply(null,ay.concat(aA))}};M=function(ay){return function(az){return function(aB){var aA;if(aB==null){return void 0}else{aA=aB[az];if(H.isFunction(aA)){return aA.apply(aB,ay)}else{return aA}}}}};P=function(aA,ay){var az,aB;aB=aA.slice(1).split(".");az=H.map(M(ay),aB);return function(aE){var aD,aC;for(aD=0,aC=az.length;aD<aC;aD++){aA=az[aD];aE=aA(aE)}return aE}};av=function(ay){return(typeof ay==="string")&&ay.length>1&&ay.charAt(0)==="."};d=i(function(){var ay,az;az=arguments[0],ay=2<=arguments.length?l.call(arguments,1):[];if(H.isFunction(az)){if(ay.length){return Y(az,ay)}else{return az}}else{if(av(az)){return P(az,ay)}else{return H.always(az)}}});V=function(az,ay){return d.apply(null,[az].concat(l.call(ay)))};D=function(aC,aA,ay,aB){var az;if(aA instanceof aj){az=aA.sampledBy(aC,function(aE,aD){return[aE,aD]});return aB.call(az,function(aD){var aF,aE;aF=aD[0],aE=aD[1];return aF}).map(function(aD){var aF,aE;aF=aD[0],aE=aD[1];return aE})}else{aA=V(aA,ay);return aB.call(aC,aA)}};s=function(az){var ay;if(H.isFunction(az)){return az}else{if(av(az)){ay=au(az);return function(aB,aA){return aB[ay](aA)}}else{throw new E("not a function or a field key: "+az)}}};au=function(ay){return ay.slice(1)};C=(function(){function ay(az){this.value=az}ay.prototype.getOrElse=function(){return this.value};ay.prototype.get=function(){return this.value};ay.prototype.filter=function(az){if(az(this.value)){return new ay(this.value)}else{return h}};ay.prototype.map=function(az){return new ay(az(this.value))};ay.prototype.forEach=function(az){return az(this.value)};ay.prototype.isDefined=true;ay.prototype.toArray=function(){return[this.value]};ay.prototype.inspect=function(){return"Some("+this.value+")"};ay.prototype.toString=function(){return this.inspect()};return ay})();h={getOrElse:function(ay){return ay},filter:function(){return h},map:function(){return h},forEach:function(){},isDefined:false,toArray:function(){return[]},inspect:function(){return"None"},toString:function(){return this.inspect()}};S=function(ay){if(ay instanceof C||ay===h){return ay}else{return new C(ay)}};t.noMore=["<no-more>"];t.more=["<more>"];m=0;y=(function(){function ay(){this.id=++m}ay.prototype.isEvent=function(){return true};ay.prototype.isEnd=function(){return false};ay.prototype.isInitial=function(){return false};ay.prototype.isNext=function(){return false};ay.prototype.isError=function(){return false};ay.prototype.hasValue=function(){return false};ay.prototype.filter=function(){return true};ay.prototype.inspect=function(){return this.toString()};ay.prototype.log=function(){return this.toString()};return ay})();ad=(function(az){O(ay,az);function ay(aB,aA){ay.__super__.constructor.call(this);if(!aA&&H.isFunction(aB)||aB instanceof ay){this.valueF=aB;this.valueInternal=void 0}else{this.valueF=void 0;this.valueInternal=aB}}ay.prototype.isNext=function(){return true};ay.prototype.hasValue=function(){return true};ay.prototype.value=function(){if(this.valueF instanceof ay){this.valueInternal=this.valueF.value();this.valueF=void 0}else{if(this.valueF){this.valueInternal=this.valueF();this.valueF=void 0}}return this.valueInternal};ay.prototype.fmap=function(aC){var aA,aB;if(this.valueInternal){aB=this.valueInternal;return this.apply(function(){return aC(aB)})}else{aA=this;return this.apply(function(){return aC(aA.value())})}};ay.prototype.apply=function(aA){return new ay(aA)};ay.prototype.filter=function(aA){return aA(this.value())};ay.prototype.toString=function(){return H.toString(this.value())};ay.prototype.log=function(){return this.value()};return ay})(y);ag=(function(az){O(ay,az);function ay(){return ay.__super__.constructor.apply(this,arguments)}ay.prototype.isInitial=function(){return true};ay.prototype.isNext=function(){return false};ay.prototype.apply=function(aA){return new ay(aA)};ay.prototype.toNext=function(){return new ad(this)};return ay})(ad);A=(function(ay){O(az,ay);function az(){return az.__super__.constructor.apply(this,arguments)}az.prototype.isEnd=function(){return true};az.prototype.fmap=function(){return this};az.prototype.apply=function(){return this};az.prototype.toString=function(){return"<end>"};return az})(y);ae=(function(ay){O(az,ay);function az(aA){this.error=aA}az.prototype.isError=function(){return true};az.prototype.fmap=function(){return this};az.prototype.apply=function(){return this};az.prototype.toString=function(){return"<error> "+H.toString(this.error)};return az})(y);t.Event=y;t.Initial=ag;t.Next=ad;t.End=A;t.Error=ae;B=function(ay){return new ag(ay,true)};ak=function(ay){return new ad(ay,true)};N=function(){return new A()};c=function(ay){if(ay instanceof y){return ay}else{return ak(ay)}};q=0;f=function(){};p=(function(){function ay(az){this.desc=az;this.id=++q;this.initialDesc=this.desc}ay.prototype.subscribe=function(az){return ai.wrappedSubscribe(this,az)};ay.prototype.subscribeInternal=function(az){return this.dispatcher.subscribe(az)};ay.prototype.onValue=function(){var az;az=G(arguments);return this.subscribe(function(aA){if(aA.hasValue()){return az(aA.value())}})};ay.prototype.onValues=function(az){return this.onValue(function(aA){return az.apply(null,aA)})};ay.prototype.onError=function(){var az;az=G(arguments);return this.subscribe(function(aA){if(aA.isError()){return az(aA.error)}})};ay.prototype.onEnd=function(){var az;az=G(arguments);return this.subscribe(function(aA){if(aA.isEnd()){return az()}})};ay.prototype.name=function(az){this._name=az;return this};ay.prototype.withDescription=function(){this.desc=e.apply(null,arguments);return this};ay.prototype.toString=function(){if(this._name){return this._name}else{return this.desc.toString()}};ay.prototype.internalDeps=function(){return this.initialDesc.deps()};return ay})();p.prototype.assign=p.prototype.onValue;p.prototype.forEach=p.prototype.onValue;p.prototype.inspect=p.prototype.toString;t.Observable=p;aq=(function(){function ay(aB){var aA,az,aC;if(aB==null){aB=[]}this.unsubscribe=ao(this.unsubscribe,this);this.unsubscribed=false;this.subscriptions=[];this.starting=[];for(aA=0,az=aB.length;aA<az;aA++){aC=aB[aA];this.add(aC)}}ay.prototype.add=function(aB){var aC,aA,az;if(this.unsubscribed){return}aC=false;aA=ar;this.starting.push(aB);az=(function(aD){return function(){if(aD.unsubscribed){return}aC=true;aD.remove(aA);return H.remove(aB,aD.starting)}})(this);aA=aB(this.unsubscribe,az);if(!(this.unsubscribed||aC)){this.subscriptions.push(aA)}else{aA()}H.remove(aB,this.starting);return aA};ay.prototype.remove=function(az){if(this.unsubscribed){return}if((H.remove(az,this.subscriptions))!==void 0){return az()}};ay.prototype.unsubscribe=function(){var aA,az,aC,aB;if(this.unsubscribed){return}this.unsubscribed=true;aC=this.subscriptions;for(aA=0,az=aC.length;aA<az;aA++){aB=aC[aA];aB()}this.subscriptions=[];return this.starting=[]};ay.prototype.count=function(){if(this.unsubscribed){return 0}return this.subscriptions.length+this.starting.length};ay.prototype.empty=function(){return this.count()===0};return ay})();t.CompositeUnsubscribe=aq;x=(function(){ay.prototype.pushing=false;ay.prototype.ended=false;ay.prototype.prevError=void 0;ay.prototype.unsubSrc=void 0;function ay(az,aA){this._subscribe=az;this._handleEvent=aA;this.subscribe=ao(this.subscribe,this);this.handleEvent=ao(this.handleEvent,this);this.subscriptions=[];this.queue=[]}ay.prototype.hasSubscribers=function(){return this.subscriptions.length>0};ay.prototype.removeSub=function(az){return this.subscriptions=H.without(az,this.subscriptions)};ay.prototype.push=function(az){if(az.isEnd()){this.ended=true}return ai.inTransaction(az,this,this.pushIt,[az])};ay.prototype.pushToSubscriptions=function(aE){var aF,aA,az,aD,aC,aB;try{aB=this.subscriptions;for(aA=0,az=aB.length;aA<az;aA++){aC=aB[aA];aD=aC.sink(aE);if(aD===t.noMore||aE.isEnd()){this.removeSub(aC)}}return true}catch(aG){aF=aG;this.pushing=false;this.queue=[];throw aF}};ay.prototype.pushIt=function(az){if(!this.pushing){if(az===this.prevError){return}if(az.isError()){this.prevError=az}this.pushing=true;this.pushToSubscriptions(az);this.pushing=false;while(this.queue.length){az=this.queue.shift();this.push(az)}if(this.hasSubscribers()){return t.more}else{this.unsubscribeFromSource();return t.noMore}}else{this.queue.push(az);return t.more}};ay.prototype.handleEvent=function(az){if(this._handleEvent){return this._handleEvent(az)}else{return this.push(az)}};ay.prototype.unsubscribeFromSource=function(){if(this.unsubSrc){this.unsubSrc()}return this.unsubSrc=void 0};ay.prototype.subscribe=function(aA){var az;if(this.ended){aA(N());return ar}else{am(aA);az={sink:aA};this.subscriptions.push(az);if(this.subscriptions.length===1){this.unsubSrc=this._subscribe(this.handleEvent);am(this.unsubSrc)}return(function(aB){return function(){aB.removeSub(az);if(!aB.hasSubscribers()){return aB.unsubscribeFromSource()}}})(this)}};return ay})();t.Dispatcher=x;j=(function(az){O(ay,az);function ay(aC,aA,aB){if(H.isFunction(aC)){aB=aA;aA=aC;aC=w.empty}ay.__super__.constructor.call(this,aC);am(aA);this.dispatcher=new x(aA,aB);f(this)}ay.prototype.toProperty=function(aA){var aB,aC;aC=arguments.length===0?h:S(function(){return aA});aB=this.dispatcher;return new aj(new t.Desc(this,"toProperty",[aA]),function(aH){var aG,aF,aE,aD;aG=false;aD=ar;aF=t.more;aE=function(){if(!aG){return aC.forEach(function(aI){aG=true;aF=aH(new ag(aI));if(aF===t.noMore){aD();return aD=ar}})}};aD=aB.subscribe(function(aI){if(aI.hasValue()){if(aG&&aI.isInitial()){return t.more}else{if(!aI.isInitial()){aE()}aG=true;aC=new C(aI);return aH(aI)}}else{if(aI.isEnd()){aF=aE()}if(aF!==t.noMore){return aH(aI)}}});aE();return aD})};ay.prototype.toEventStream=function(){return this};ay.prototype.withHandler=function(aA){return new ay(new t.Desc(this,"withHandler",[aA]),this.dispatcher.subscribe,aA)};return ay})(p);t.EventStream=j;t.never=function(){return new j(e(t,"never"),function(ay){ay(N());return ar})};t.when=function(){var aO,aM,aD,aB,aL,aK,aN,aF,aE,aA,aI,aH,aG,az,aC,aR,aJ,ay,aP,aQ;if(arguments.length===0){return t.never()}aN=arguments.length;aQ="when: expecting arguments in the form (Observable+,function)+";g(aQ,aN%2===0);ay=[];aG=[];aM=0;az=[];while(aM<aN){az[aM]=arguments[aM];az[aM+1]=arguments[aM+1];aH=H.toArray(arguments[aM]);aO=ab(arguments[aM+1]);aI={f:aO,ixs:[]};aP=false;for(aL=0,aF=aH.length;aL<aF;aL++){aJ=aH[aL];aD=H.indexOf(ay,aJ);if(!aP){aP=an.isTrigger(aJ)}if(aD<0){ay.push(aJ);aD=ay.length-1}aC=aI.ixs;for(aK=0,aE=aC.length;aK<aE;aK++){aB=aC[aK];if(aB.index===aD){aB.count++}}aI.ixs.push({index:aD,count:1})}g("At least one EventStream required",aP||(!aH.length));if(aH.length>0){aG.push(aI)}aM=aM+2}if(!ay.length){return t.never()}ay=H.map(an.fromObservable,ay);aA=(H.any(ay,function(aS){return aS.flatten}))&&(ah(H.map((function(aS){return aS.obs}),ay)));return aR=new j(new t.Desc(t,"when",az),function(aZ){var aY,aX,aS,aU,aW,aT,aV;aV=[];aS=false;aU=function(a3){var a1,a0,a2;a2=a3.ixs;for(a1=0,a0=a2.length;a1<a0;a1++){aM=a2[a1];if(!ay[aM.index].hasAtLeast(aM.count)){return false}}return true};aX=function(a0){return !a0.sync||a0.ended};aY=function(a3){var a1,a0,a2;a2=a3.ixs;for(a1=0,a0=a2.length;a1<a0;a1++){aM=a2[a1];if(!ay[aM.index].mayHave(aM.count)){return true}}};aW=function(a0){return !a0.source.flatten};aT=function(a0){return function(a2){var a1,a4,a3;a4=function(){return ai.whenDoneWith(aR,a1)};a3=function(){var a8,a6,a5,ba,a9,a7;if(aV.length>0){a9=t.more;a7=aV.pop();for(a6=0,a5=aG.length;a6<a5;a6++){ba=aG[a6];if(aU(ba)){a8=(function(){var bc,bb,bd,be;bd=ba.ixs;be=[];for(bb=0,bc=bd.length;bb<bc;bb++){aM=bd[bb];be.push(ay[aM.index].consume())}return be})();a9=aZ(a7.e.apply(function(){var bc,bb;bb=(function(){var be,bd,bf;bf=[];for(bd=0,be=a8.length;bd<be;bd++){bc=a8[bd];bf.push(bc.value())}return bf})();return ba.f.apply(ba,bb)}));if(aV.length){aV=H.filter(aW,aV)}if(a9===t.noMore){return a9}else{return a3()}}}}else{return t.more}};a1=function(){var a5;a5=a3();if(aS){if(H.all(ay,aX)||H.all(aG,aY)){a5=t.noMore;aZ(N())}}if(a5===t.noMore){a2()}return a5};return a0.subscribe(function(a6){var a5;if(a6.isEnd()){aS=true;a0.markEnded();a4()}else{if(a6.isError()){a5=aZ(a6)}else{a0.push(a6);if(a0.sync){aV.push({source:a0,e:a6});if(aA||ai.hasWaiters()){a4()}else{a1()}}}}if(a5===t.noMore){a2()}return a5||t.more})}};return new t.CompositeUnsubscribe((function(){var a1,a0,a2;a2=[];for(a1=0,a0=ay.length;a1<a0;a1++){aJ=ay[a1];a2.push(aT(aJ))}return a2})()).unsubscribe})};ah=function(aA,az){var ay;if(az==null){az=[]}ay=function(aC){var aB;if(H.contains(az,aC)){return true}else{aB=aC.internalDeps();if(aB.length){az.push(aC);return H.any(aB,ay)}else{az.push(aC);return false}}};return H.any(aA,ay)};ab=function(ay){if(H.isFunction(ay)){return ay}else{return H.always(ay)}};t.groupSimultaneous=function(){var az,ay,aA;aA=1<=arguments.length?l.call(arguments,0):[];if(aA.length===1&&a(aA[0])){aA=aA[0]}ay=(function(){var aC,aB,aD;aD=[];for(aC=0,aB=aA.length;aC<aB;aC++){az=aA[aC];aD.push(new al(az))}return aD})();return W(new t.Desc(t,"groupSimultaneous",aA),t.when(ay,(function(){var aB;aB=1<=arguments.length?l.call(arguments,0):[];return aB})))};v=(function(ay){O(az,ay);function az(aC,aA,aB){this.property=aC;this.subscribe=ao(this.subscribe,this);az.__super__.constructor.call(this,aA,aB);this.current=h;this.currentValueRootId=void 0;this.propertyEnded=false}az.prototype.push=function(aA){if(aA.isEnd()){this.propertyEnded=true}if(aA.hasValue()){this.current=new C(aA);this.currentValueRootId=ai.currentEventId()}return az.__super__.push.call(this,aA)};az.prototype.maybeSubSource=function(aB,aA){if(aA===t.noMore){return ar}else{if(this.propertyEnded){aB(N());return ar}else{return x.prototype.subscribe.call(this,aB)}}};az.prototype.subscribe=function(aC){var aE,aB,aA,aD;aB=false;aA=t.more;if(this.current.isDefined&&(this.hasSubscribers()||this.propertyEnded)){aE=ai.currentEventId();aD=this.currentValueRootId;if(!this.propertyEnded&&aD&&aE&&aE!==aD){ai.whenDoneWith(this.property,(function(aF){return function(){if(aF.currentValueRootId===aD){return aC(B(aF.current.get().value()))}}})(this));return this.maybeSubSource(aC,aA)}else{ai.inTransaction(void 0,this,(function(){return aA=aC(B(this.current.get().value()))}),[]);return this.maybeSubSource(aC,aA)}}else{return this.maybeSubSource(aC,aA)}};return az})(x);aj=(function(ay){O(az,ay);function az(aC,aA,aB){az.__super__.constructor.call(this,aC);am(aA);this.dispatcher=new v(this,aA,aB);f(this)}az.prototype.changes=function(){return new j(new t.Desc(this,"changes",[]),(function(aA){return function(aB){return aA.dispatcher.subscribe(function(aC){if(!aC.isInitial()){return aB(aC)}})}})(this))};az.prototype.withHandler=function(aA){return new az(new t.Desc(this,"withHandler",[aA]),this.dispatcher.subscribe,aA)};az.prototype.toProperty=function(){Z(arguments);return this};az.prototype.toEventStream=function(){return new j(new t.Desc(this,"toEventStream",[]),(function(aA){return function(aB){return aA.dispatcher.subscribe(function(aC){if(aC.isInitial()){aC=aC.toNext()}return aB(aC)})}})(this))};return az})(p);t.Property=aj;t.constant=function(ay){return new aj(new t.Desc(t,"constant",[ay]),function(az){az(B(ay));az(N());return ar})};t.fromBinder=function(ay,az){if(az==null){az=H.id}return new j(new t.Desc(t,"fromBinder",[ay,az]),function(aD){var aE,aB,aA,aC;aC=false;aE=false;aB=function(){if(!aC){if(typeof aA!=="undefined"&&aA!==null){aA();return aC=true}else{return aE=true}}};aA=ay(function(){var aH,aJ,aG,aF,aI,aK;aH=1<=arguments.length?l.call(arguments,0):[];aK=az.apply(this,aH);if(!(a(aK)&&H.last(aK) instanceof y)){aK=[aK]}aI=t.more;for(aG=0,aF=aK.length;aG<aF;aG++){aJ=aK[aG];aI=aD(aJ=c(aJ));if(aI===t.noMore||aJ.isEnd()){aB();return aI}}return aI});if(aE){aB()}return aB})};z=[["addEventListener","removeEventListener"],["addListener","removeListener"],["on","off"],["bind","unbind"]];o=function(aB){var az,ay,aA,aC;for(az=0,ay=z.length;az<ay;az++){aC=z[az];aA=[aB[aC[0]],aB[aC[1]]];if(aA[0]&&aA[1]){return aA}}throw new ae("No suitable event methods in "+aB)};t.fromEventTarget=function(aD,ay,aB){var aC,aA,az;aC=o(aD),aA=aC[0],az=aC[1];return W(new t.Desc(t,"fromEvent",[aD,ay]),t.fromBinder(function(aE){aA.call(aD,ay,aE);return function(){return az.call(aD,ay,aE)}},aB))};t.fromEvent=t.fromEventTarget;t.Observable.prototype.map=function(){var ay,az;az=arguments[0],ay=2<=arguments.length?l.call(arguments,1):[];return D(this,az,ay,function(aA){return W(new t.Desc(this,"map",[aA]),this.withHandler(function(aB){return this.push(aB.fmap(aA))}))})};t.combineAsArray=function(){var aB,aA,az,aC,ay,aD,aE;aE=1<=arguments.length?l.call(arguments,0):[];if(aE.length===1&&a(aE[0])){aE=aE[0]}for(aB=aA=0,az=aE.length;aA<az;aB=++aA){aD=aE[aB];if(!(ac(aD))){aE[aB]=t.constant(aD)}}if(aE.length){ay=(function(){var aG,aF,aH;aH=[];for(aG=0,aF=aE.length;aG<aF;aG++){aC=aE[aG];aH.push(new an(aC,true))}return aH})();return W(new t.Desc(t,"combineAsArray",aE),t.when(ay,(function(){var aF;aF=1<=arguments.length?l.call(arguments,0):[];return aF})).toProperty())}else{return t.constant([])}};t.onValues=function(){var az,ay,aA;aA=2<=arguments.length?l.call(arguments,0,ay=arguments.length-1):(ay=0,[]),az=arguments[ay++];return t.combineAsArray(aA).onValues(az)};t.combineWith=function(){var ay,az;ay=arguments[0],az=2<=arguments.length?l.call(arguments,1):[];return W(new t.Desc(t,"combineWith",[ay].concat(l.call(az))),t.combineAsArray(az).map(function(aA){return ay.apply(null,aA)}))};t.Observable.prototype.combine=function(ay,aA){var az;az=s(aA);return W(new t.Desc(this,"combine",[ay,aA]),t.combineAsArray(this,ay).map(function(aB){return az(aB[0],aB[1])}))};t.Observable.prototype.withStateMachine=function(ay,aA){var az;az=ay;return W(new t.Desc(this,"withStateMachine",[ay,aA]),this.withHandler(function(aG){var aF,aD,aC,aH,aB,aI,aE;aF=aA(az,aG);aH=aF[0],aI=aF[1];az=aH;aE=t.more;for(aD=0,aC=aI.length;aD<aC;aD++){aB=aI[aD];aE=this.push(aB);if(aE===t.noMore){return aE}}return aE}))};t.Observable.prototype.skipDuplicates=function(ay){if(ay==null){ay=function(aA,az){return aA===az}}return W(new t.Desc(this,"skipDuplicates",[]),this.withStateMachine(h,function(aA,az){if(!az.hasValue()){return[aA,[az]]}else{if(az.isInitial()||aA===h||!ay(aA.get(),az.value())){return[new C(az.value()),[az]]}else{return[aA,[]]}}}))};t.Observable.prototype.awaiting=function(ay){return W(new t.Desc(this,"awaiting",[ay]),t.groupSimultaneous(this,ay).map(function(az){var aA,aB;aA=az[0],aB=az[1];return aB.length===0}).toProperty(false).skipDuplicates())};t.Observable.prototype.not=function(){return W(new t.Desc(this,"not",[]),this.map(function(ay){return !ay}))};t.Property.prototype.and=function(ay){return W(new t.Desc(this,"and",[ay]),this.combine(ay,function(az,aA){return az&&aA}))};t.Property.prototype.or=function(ay){return W(new t.Desc(this,"or",[ay]),this.combine(ay,function(az,aA){return az||aA}))};t.scheduler={setTimeout:function(ay,az){return setTimeout(ay,az)},setInterval:function(az,ay){return setInterval(az,ay)},clearInterval:function(ay){return clearInterval(ay)},clearTimeout:function(ay){return clearTimeout(ay)},now:function(){return new Date().getTime()}};t.EventStream.prototype.bufferWithTime=function(ay){return W(new t.Desc(this,"bufferWithTime",[ay]),this.bufferWithTimeOrCount(ay,Number.MAX_VALUE))};t.EventStream.prototype.bufferWithCount=function(ay){return W(new t.Desc(this,"bufferWithCount",[ay]),this.bufferWithTimeOrCount(void 0,ay))};t.EventStream.prototype.bufferWithTimeOrCount=function(ay,az){var aA;aA=function(aB){if(aB.values.length===az){return aB.flush()}else{if(ay!==void 0){return aB.schedule()}}};return W(new t.Desc(this,"bufferWithTimeOrCount",[ay,az]),this.buffer(ay,aA,aA))};t.EventStream.prototype.buffer=function(aA,aC,az){var ay,aD,aB;if(aC==null){aC=ar}if(az==null){az=ar}ay={scheduled:null,end:void 0,values:[],flush:function(){var aF,aE;if(this.scheduled){t.scheduler.clearTimeout(this.scheduled);this.scheduled=null}if(this.values.length>0){aE=this.values;this.values=[];aF=this.push(ak(aE));if(this.end!=null){return this.push(this.end)}else{if(aF!==t.noMore){return az(this)}}}else{if(this.end!=null){return this.push(this.end)}}},schedule:function(){if(!this.scheduled){return this.scheduled=aA((function(aE){return function(){return aE.flush()}})(this))}}};aB=t.more;if(!H.isFunction(aA)){aD=aA;aA=function(aE){return t.scheduler.setTimeout(aE,aD)}}return W(new t.Desc(this,"buffer",[]),this.withHandler(function(aE){ay.push=(function(aF){return function(aG){return aF.push(aG)}})(this);if(aE.isError()){aB=this.push(aE)}else{if(aE.isEnd()){ay.end=aE;if(!ay.scheduled){ay.flush()}}else{ay.values.push(aE.value());aC(ay)}}return aB}))};t.Observable.prototype.filter=function(){var ay,az;az=arguments[0],ay=2<=arguments.length?l.call(arguments,1):[];J(az);return D(this,az,ay,function(aA){return W(new t.Desc(this,"filter",[aA]),this.withHandler(function(aB){if(aB.filter(aA)){return this.push(aB)}else{return t.more}}))})};t.once=function(ay){return new j(new w(t,"once",[ay]),function(az){az(c(ay));az(N());return ar})};t.EventStream.prototype.concat=function(ay){var az;az=this;return new j(new t.Desc(az,"concat",[ay]),function(aB){var aC,aA;aA=ar;aC=az.dispatcher.subscribe(function(aD){if(aD.isEnd()){return aA=ay.dispatcher.subscribe(aB)}else{return aB(aD)}});return function(){aC();return aA()}})};t.Observable.prototype.flatMap=function(){return ap(this,U(arguments))};t.Observable.prototype.flatMapFirst=function(){return ap(this,U(arguments),true)};ap=function(aA,aE,aB,az){var aD,ay,aC;aC=[aA];aD=[];ay=new j(new t.Desc(aA,"flatMap"+(aB?"First":""),[aE]),function(aH){var aJ,aI,aK,aF,aG;aK=new aq();aF=[];aG=function(aL){var aM;aM=Q(aE(aL.value()));aD.push(aM);return aK.add(function(aO,aN){return aM.dispatcher.subscribe(function(aQ){var aP;if(aQ.isEnd()){H.remove(aM,aD);aI();aJ(aN);return t.noMore}else{if(aQ instanceof ag){aQ=aQ.toNext()}aP=aH(aQ);if(aP===t.noMore){aO()}return aP}})})};aI=function(){var aL;aL=aF.shift();if(aL){return aG(aL)}};aJ=function(aL){aL();if(aK.empty()){return aH(N())}};aK.add(function(aM,aL){return aA.dispatcher.subscribe(function(aN){if(aN.isEnd()){return aJ(aL)}else{if(aN.isError()){return aH(aN)}else{if(aB&&aK.count()>1){return t.more}else{if(aK.unsubscribed){return t.noMore}if(az&&aK.count()>az){return aF.push(aN)}else{return aG(aN)}}}}})});return aK.unsubscribe});ay.internalDeps=function(){if(aD.length){return aC.concat(aD)}else{return aC}};return ay};U=function(ay){if(ay.length===1&&ac(ay[0])){return H.always(ay[0])}else{return G(ay)}};Q=function(ay){if(ac(ay)){return ay}else{return t.once(ay)}};t.Observable.prototype.flatMapWithConcurrencyLimit=function(){var az,ay;ay=arguments[0],az=2<=arguments.length?l.call(arguments,1):[];return W(new t.Desc(this,"flatMapWithConcurrencyLimit",[ay].concat(l.call(az))),ap(this,U(az),false,ay))};t.Observable.prototype.flatMapConcat=function(){return W(new t.Desc(this,"flatMapConcat",Array.prototype.slice.call(arguments,0)),this.flatMapWithConcurrencyLimit.apply(this,[1].concat(l.call(arguments))))};t.later=function(ay,az){return W(new t.Desc(t,"later",[ay,az]),t.fromBinder(function(aB){var aC,aA;aA=function(){return aB([az,N()])};aC=t.scheduler.setTimeout(aA,ay);return function(){return t.scheduler.clearTimeout(aC)}}))};t.Observable.prototype.bufferingThrottle=function(ay){return W(new t.Desc(this,"bufferingThrottle",[ay]),this.flatMapConcat(function(az){return t.once(az).concat(t.later(ay).filter(false))}))};t.Property.prototype.bufferingThrottle=function(){return t.Observable.prototype.bufferingThrottle.apply(this,arguments).toProperty()};n=(function(ay){O(az,ay);function az(){this.guardedSink=ao(this.guardedSink,this);this.subscribeAll=ao(this.subscribeAll,this);this.unsubAll=ao(this.unsubAll,this);this.sink=void 0;this.subscriptions=[];this.ended=false;az.__super__.constructor.call(this,new t.Desc(t,"Bus",[]),this.subscribeAll)}az.prototype.unsubAll=function(){var aB,aA,aD,aC;aD=this.subscriptions;for(aB=0,aA=aD.length;aB<aA;aB++){aC=aD[aB];if(typeof aC.unsub==="function"){aC.unsub()}}return void 0};az.prototype.subscribeAll=function(aC){var aB,aA,aE,aD;if(this.ended){aC(N())}else{this.sink=aC;aE=aa(this.subscriptions);for(aB=0,aA=aE.length;aB<aA;aB++){aD=aE[aB];this.subscribeInput(aD)}}return this.unsubAll};az.prototype.guardedSink=function(aA){return(function(aB){return function(aC){if(aC.isEnd()){aB.unsubscribeInput(aA);return t.noMore}else{return aB.sink(aC)}}})(this)};az.prototype.subscribeInput=function(aA){return aA.unsub=aA.input.dispatcher.subscribe(this.guardedSink(aA.input))};az.prototype.unsubscribeInput=function(aA){var aD,aC,aB,aF,aE;aF=this.subscriptions;for(aD=aC=0,aB=aF.length;aC<aB;aD=++aC){aE=aF[aD];if(aE.input===aA){if(typeof aE.unsub==="function"){aE.unsub()}this.subscriptions.splice(aD,1);return}}};az.prototype.plug=function(aA){var aB;r(aA);if(this.ended){return}aB={input:aA};this.subscriptions.push(aB);if((this.sink!=null)){this.subscribeInput(aB)}return(function(aC){return function(){return aC.unsubscribeInput(aA)}})(this)};az.prototype.end=function(){this.ended=true;this.unsubAll();return typeof this.sink==="function"?this.sink(N()):void 0};az.prototype.push=function(aA){if(!this.ended){return typeof this.sink==="function"?this.sink(ak(aA)):void 0}};az.prototype.error=function(aA){return typeof this.sink==="function"?this.sink(new ae(aA)):void 0};return az})(j);t.Bus=n;at=function(az,ay){return i(function(){var aA,aB,aC;aB=arguments[0],aA=2<=arguments.length?l.call(arguments,1):[];aC=Y(ay,[function(aD,aE){return aB.apply(null,l.call(aD).concat([aE]))}]);return W(new t.Desc(t,az,[aB].concat(l.call(aA))),t.combineAsArray(aA).flatMap(aC))})};t.fromCallback=at("fromCallback",function(){var ay,az;az=arguments[0],ay=2<=arguments.length?l.call(arguments,1):[];return t.fromBinder(function(aA){V(az,ay)(aA);return ar},(function(aA){return[aA,N()]}))});t.fromNodeCallback=at("fromNodeCallback",function(){var ay,az;az=arguments[0],ay=2<=arguments.length?l.call(arguments,1):[];return t.fromBinder(function(aA){V(az,ay)(aA);return ar},function(aA,aB){if(aA){return[new ae(aA),N()]}return[aB,N()]})});t.combineTemplate=function(aG){var aA,aB,aI,aH,az,aE,ay,aF,aD,aC,aJ;ay=[];aJ=[];aE=function(aK){return aK[aK.length-1]};aC=function(aK,aL,aM){return aE(aK)[aL]=aM};aA=function(aL,aK){return function(aN,aM){return aC(aN,aL,aM[aK])}};az=function(aK,aL){return function(aM){return aC(aM,aK,aL)}};aF=function(aK){if(a(aK)){return[]}else{return{}}};aD=function(aK,aL){return function(aM){var aN;aN=aF(aL);aC(aM,aK,aN);return aM.push(aN)}};aI=function(aK,aL){var aM;if(ac(aL)){aJ.push(aL);return ay.push(aA(aK,aJ.length-1))}else{if(aL===Object(aL)&&typeof aL!=="function"&&!(aL instanceof RegExp)&&!(aL instanceof Date)){aM=function(aN){return aN.pop()};ay.push(aD(aK,aL));aH(aL);return ay.push(aM)}else{return ay.push(az(aK,aL))}}};aH=function(aK){return H.each(aK,aI)};aH(aG);aB=function(aM){var aL,aP,aO,aN,aK;aK=aF(aG);aL=[aK];for(aO=0,aN=ay.length;aO<aN;aO++){aP=ay[aO];aP(aL,aM)}return aK};return W(new t.Desc(t,"combineTemplate",[aG]),t.combineAsArray(aJ).map(aB))};u=function(az,aA){var ay;ay=new j(e(az,"justInitValue"),function(aD){var aB,aC;aC=void 0;aB=az.dispatcher.subscribe(function(aE){if(!aE.isEnd()){aC=aE}return t.noMore});ai.whenDoneWith(ay,function(){if(aC!=null){aD(aC)}return aD(N())});return aB});return ay.concat(aA).toProperty()};t.Observable.prototype.mapEnd=function(){var ay;ay=G(arguments);return W(new t.Desc(this,"mapEnd",[ay]),this.withHandler(function(az){if(az.isEnd()){this.push(ak(ay(az)));this.push(N());return t.noMore}else{return this.push(az)}}))};t.Observable.prototype.skipErrors=function(){return W(new t.Desc(this,"skipErrors",[]),this.withHandler(function(ay){if(ay.isError()){return t.more}else{return this.push(ay)}}))};t.EventStream.prototype.takeUntil=function(ay){var az;az={};return W(new t.Desc(this,"takeUntil",[ay]),t.groupSimultaneous(this.mapEnd(az),ay.skipErrors()).withHandler(function(aE){var aG,aB,aA,aD,aC,aF;if(!aE.hasValue()){return this.push(aE)}else{aD=aE.value(),aG=aD[0],ay=aD[1];if(ay.length){return this.push(N())}else{aC=t.more;for(aB=0,aA=aG.length;aB<aA;aB++){aF=aG[aB];if(aF===az){aC=this.push(N())}else{aC=this.push(ak(aF))}}return aC}}}))};t.Property.prototype.takeUntil=function(az){var ay;ay=this.changes().takeUntil(az);return W(new t.Desc(this,"takeUntil",[az]),u(this,ay))};t.Observable.prototype.flatMapLatest=function(){var ay,az;ay=U(arguments);az=this.toEventStream();return W(new t.Desc(this,"flatMapLatest",[ay]),az.flatMap(function(aA){return Q(ay(aA)).takeUntil(az)}))};t.Property.prototype.delayChanges=function(az,ay){return W(az,u(this,ay(this.changes())))};t.EventStream.prototype.delay=function(ay){return W(new t.Desc(this,"delay",[ay]),this.flatMap(function(az){return t.later(ay,az)}))};t.Property.prototype.delay=function(ay){return this.delayChanges(new t.Desc(this,"delay",[ay]),function(az){return az.delay(ay)})};t.EventStream.prototype.debounce=function(ay){return W(new t.Desc(this,"debounce",[ay]),this.flatMapLatest(function(az){return t.later(ay,az)}))};t.Property.prototype.debounce=function(ay){return this.delayChanges(new t.Desc(this,"debounce",[ay]),function(az){return az.debounce(ay)})};t.EventStream.prototype.debounceImmediate=function(ay){return W(new t.Desc(this,"debounceImmediate",[ay]),this.flatMapFirst(function(az){return t.once(az).concat(t.later(ay).filter(false))}))};t.Observable.prototype.decode=function(ay){return W(new t.Desc(this,"decode",[ay]),this.combine(t.combineTemplate(ay),function(aA,az){return az[aA]}))};t.Observable.prototype.scan=function(az,aB){var aA,aC,aD,ay;aB=s(aB);aA=S(az);aC=false;ay=(function(aE){return function(aJ){var aI,aH,aG,aF;aI=false;aF=ar;aH=t.more;aG=function(){if(!aI){return aA.forEach(function(aK){aI=aC=true;aH=aJ(new ag(function(){return aK}));if(aH===t.noMore){aF();return aF=ar}})}};aF=aE.dispatcher.subscribe(function(aM){var aK,aL;if(aM.hasValue()){if(aC&&aM.isInitial()){return t.more}else{if(!aM.isInitial()){aG()}aI=aC=true;aL=aA.getOrElse(void 0);aK=aB(aL,aM.value());aA=new C(aK);return aJ(aM.apply(function(){return aK}))}}else{if(aM.isEnd()){aH=aG()}if(aH!==t.noMore){return aJ(aM)}}});ai.whenDoneWith(aD,aG);return aF}})(this);return aD=new aj(new t.Desc(this,"scan",[az,aB]),ay)};t.Observable.prototype.diff=function(az,ay){ay=s(ay);return W(new t.Desc(this,"diff",[az,ay]),this.scan([az],function(aA,aB){return[aB,ay(aA[0],aB)]}).filter(function(aA){return aA.length===2}).map(function(aA){return aA[1]}))};t.Observable.prototype.doAction=function(){var ay;ay=G(arguments);return W(new t.Desc(this,"doAction",[ay]),this.withHandler(function(az){if(az.hasValue()){ay(az.value())}return this.push(az)}))};t.Observable.prototype.doError=function(){var ay;ay=G(arguments);return W(new t.Desc(this,"doError",[ay]),this.withHandler(function(az){if(az.isError()){ay(az.error)}return this.push(az)}))};t.Observable.prototype.doLog=function(){var ay;ay=1<=arguments.length?l.call(arguments,0):[];return W(new t.Desc(this,"doLog",ay),this.withHandler(function(az){if(typeof console!=="undefined"&&console!==null){if(typeof console.log==="function"){console.log.apply(console,l.call(ay).concat([az.log()]))}}return this.push(az)}))};t.Observable.prototype.endOnError=function(){var ay,az;az=arguments[0],ay=2<=arguments.length?l.call(arguments,1):[];if(az==null){az=true}return D(this,az,ay,function(aA){return W(new t.Desc(this,"endOnError",[]),this.withHandler(function(aB){if(aB.isError()&&aA(aB.error)){this.push(aB);return this.push(N())}else{return this.push(aB)}}))})};p.prototype.errors=function(){return W(new t.Desc(this,"errors",[]),this.filter(function(){return false}))};K=(function(ay){return[ay,N()]});t.fromPromise=function(az,aA,ay){if(ay==null){ay=K}return W(new t.Desc(t,"fromPromise",[az]),t.fromBinder(function(aB){var aC;if((aC=az.then(aB,function(aD){return aB(new ae(aD))}))!=null){if(typeof aC.done==="function"){aC.done()}}return function(){if(aA){return typeof az.abort==="function"?az.abort():void 0}}},ay))};t.Observable.prototype.mapError=function(){var ay;ay=G(arguments);return W(new t.Desc(this,"mapError",[ay]),this.withHandler(function(az){if(az.isError()){return this.push(ak(ay(az.error)))}else{return this.push(az)}}))};t.Observable.prototype.flatMapError=function(ay){return W(new t.Desc(this,"flatMapError",[ay]),this.mapError(function(az){return new ae(az)}).flatMap(function(az){if(az instanceof ae){return ay(az.error)}else{return t.once(az)}}))};t.EventStream.prototype.sampledBy=function(ay,az){return W(new t.Desc(this,"sampledBy",[ay,az]),this.toProperty().sampledBy(ay,az))};t.Property.prototype.sampledBy=function(aA,aD){var az,ay,aB,aE,aC;if(aD!=null){aD=s(aD)}else{az=true;aD=function(aF){return aF.value()}}aC=new an(this,false,az);aB=new an(aA,true,az);aE=t.when([aC,aB],aD);ay=aA instanceof aj?aE.toProperty():aE;return W(new t.Desc(this,"sampledBy",[aA,aD]),ay)};t.Property.prototype.sample=function(ay){return W(new t.Desc(this,"sample",[ay]),this.sampledBy(t.interval(ay,{})))};t.Observable.prototype.map=function(){var ay,az;az=arguments[0],ay=2<=arguments.length?l.call(arguments,1):[];if(az instanceof aj){return az.sampledBy(this,L)}else{return D(this,az,ay,function(aA){return W(new t.Desc(this,"map",[aA]),this.withHandler(function(aB){return this.push(aB.fmap(aA))}))})}};t.Observable.prototype.fold=function(ay,az){return W(new t.Desc(this,"fold",[ay,az]),this.scan(ay,az).sampledBy(this.filter(false).mapEnd().toProperty()))};p.prototype.reduce=p.prototype.fold;t.fromPoll=function(ay,az){return W(new t.Desc(t,"fromPoll",[ay,az]),t.fromBinder((function(aA){var aB;aB=t.scheduler.setInterval(aA,ay);return function(){return t.scheduler.clearInterval(aB)}}),az))};t.Observable.prototype.groupBy=function(az,ay){var aA,aB;if(ay==null){ay=t._.id}aB={};aA=this;return aA.filter(function(aC){return !aB[az(aC)]}).map(function(aC){var aF,aE,aD,aG;aE=az(aC);aG=aA.filter(function(aH){return az(aH)===aE});aF=t.once(aC).concat(aG);aD=ay(aF,aC).withHandler(function(aH){this.push(aH);if(aH.isEnd()){return delete aB[aE]}});return aB[aE]=aD})};t.fromArray=function(ay){var az;R(ay);if(!ay.length){return W(new t.Desc(t,"fromArray",ay),t.never())}else{az=0;return new j(new t.Desc(t,"fromArray",[ay]),function(aF){var aD,aB,aA,aE,aC;aC=false;aE=t.more;aA=false;aB=false;aD=function(){var aG;aB=true;if(aA){return}aA=true;while(aB){aB=false;if((aE!==t.noMore)&&!aC){aG=ay[az++];aE=aF(c(aG));if(aE!==t.noMore){if(az===ay.length){aF(N())}else{ai.afterTransaction(aD)}}}}return aA=false};aD();return function(){return aC=true}})}};t.EventStream.prototype.holdWhen=function(aB){var ay,az,aA;az=false;ay=[];aA=this;return new j(new t.Desc(this,"holdWhen",[aB]),function(aD){var aF,aC,aE;aF=new aq();aE=false;aC=function(aG){if(typeof aG==="function"){aG()}if(aF.empty()&&aE){return aD(N())}};aF.add(function(aH,aG){return aB.subscribeInternal(function(aL){var aJ,aI,aK,aN,aM;if(aL.hasValue()){az=aL.value();if(!az){aN=ay;ay=[];aK=[];for(aJ=0,aI=aN.length;aJ<aI;aJ++){aM=aN[aJ];aK.push(aD(ak(aM)))}return aK}}else{if(aL.isEnd()){return aC(aG)}else{return aD(aL)}}})});aF.add(function(aH,aG){return aA.subscribeInternal(function(aI){if(az&&aI.hasValue()){return ay.push(aI.value())}else{if(aI.isEnd()&&ay.length){return aC(aG)}else{return aD(aI)}}})});aE=true;aC();return aF.unsubscribe})};t.interval=function(ay,az){if(az==null){az={}}return W(new t.Desc(t,"interval",[ay,az]),t.fromPoll(ay,function(){return ak(az)}))};t.$={};t.$.asEventStream=function(az,ay,aA){var aB;if(H.isFunction(ay)){aB=[ay,void 0],aA=aB[0],ay=aB[1]}return W(new t.Desc(this.selector||this,"asEventStream",[az]),t.fromBinder((function(aC){return function(aD){aC.on(az,ay,aD);return function(){return aC.off(az,ay,aD)}}})(this),aA))};if((F=typeof jQuery!=="undefined"&&jQuery!==null?jQuery:typeof Zepto!=="undefined"&&Zepto!==null?Zepto:void 0)!=null){F.fn.asEventStream=t.$.asEventStream}t.Observable.prototype.log=function(){var ay;ay=1<=arguments.length?l.call(arguments,0):[];this.subscribe(function(az){return typeof console!=="undefined"&&console!==null?typeof console.log==="function"?console.log.apply(console,l.call(ay).concat([az.log()])):void 0:void 0});return this};t.EventStream.prototype.merge=function(ay){var az;X(ay);az=this;return W(new t.Desc(az,"merge",[ay]),t.mergeAll(this,ay))};t.mergeAll=function(){var ay;ay=1<=arguments.length?l.call(arguments,0):[];if(a(ay[0])){ay=ay[0]}if(ay.length){return new j(new t.Desc(t,"mergeAll",ay),function(aC){var aA,az,aB;aA=0;aB=function(aD){return function(aE){return aD.dispatcher.subscribe(function(aG){var aF;if(aG.isEnd()){aA++;if(aA===ay.length){return aC(N())}else{return t.more}}else{aF=aC(aG);if(aF===t.noMore){aE()}return aF}})}};az=H.map(aB,ay);return new t.CompositeUnsubscribe(az).unsubscribe})}else{return t.never()}};t.repeatedly=function(aA,ay){var az;az=0;return W(new t.Desc(t,"repeatedly",[aA,ay]),t.fromPoll(aA,function(){return ay[az++%ay.length]}))};t.repeat=function(az){var ay;ay=0;return t.fromBinder(function(aE){var aA,aB,aD,aF,aC;aA=false;aD=t.more;aC=function(){};aB=function(aG){if(aG.isEnd()){if(!aA){return aA=true}else{return aF()}}else{return aD=aE(aG)}};aF=function(){var aG;aA=true;while(aA&&aD!==t.noMore){aG=az(ay++);aA=false;if(aG){aC=aG.subscribeInternal(aB)}else{aE(N())}}return aA=true};aF();return function(){return aC()}})};t.retry=function(aB){var aA,az,aF,aD,aE,ay,aC;if(!H.isFunction(aB.source)){throw new E("'source' option has to be a function")}aC=aB.source;ay=aB.retries||0;aE=aB.maxRetries||ay;aA=aB.delay||function(){return 0};aD=aB.isRetryable||function(){return true};aF=false;az=null;return W(new t.Desc(t,"retry",[aB]),t.repeat(function(){var aG,aH,aI;if(aF){return null}else{aI=function(){return aC().endOnError().withHandler(function(aJ){if(aJ.isError()){az=aJ;if(aD(az.error)&&ay>0){}else{aF=true;return this.push(aJ)}}else{if(aJ.hasValue()){az=null;aF=true}return this.push(aJ)}})};if(az){aG={error:az.error,retriesDone:aE-ay};aH=t.later(aA(aG)).filter(false);ay=ay-1;return aH.concat(t.once().flatMap(aI))}else{return aI()}}}))};t.sequentially=function(aA,ay){var az;az=0;return W(new t.Desc(t,"sequentially",[aA,ay]),t.fromPoll(aA,function(){var aB;aB=ay[az++];if(az<ay.length){return aB}else{if(az===ay.length){return[aB,N()]}else{return N()}}}))};t.Observable.prototype.skip=function(ay){return W(new t.Desc(this,"skip",[ay]),this.withHandler(function(az){if(!az.hasValue()){return this.push(az)}else{if(ay>0){ay--;return t.more}else{return this.push(az)}}}))};t.Observable.prototype.take=function(ay){if(ay<=0){return t.never()}return W(new t.Desc(this,"take",[ay]),this.withHandler(function(az){if(!az.hasValue()){return this.push(az)}else{ay--;if(ay>0){return this.push(az)}else{if(ay===0){this.push(az)}this.push(N());return t.noMore}}}))};t.EventStream.prototype.skipUntil=function(az){var ay;ay=az.take(1).map(true).toProperty(false);return W(new t.Desc(this,"skipUntil",[az]),this.filter(ay))};t.EventStream.prototype.skipWhile=function(){var ay,aA,az;aA=arguments[0],ay=2<=arguments.length?l.call(arguments,1):[];J(aA);az=false;return D(this,aA,ay,function(aB){return W(new t.Desc(this,"skipWhile",[aB]),this.withHandler(function(aC){if(az||!aC.hasValue()||!aB(aC.value())){if(aC.hasValue()){az=true}return this.push(aC)}else{return t.more}}))})};t.Observable.prototype.slidingWindow=function(az,ay){if(ay==null){ay=0}return W(new t.Desc(this,"slidingWindow",[az,ay]),this.scan([],(function(aA,aB){return aA.concat([aB]).slice(-az)})).filter((function(aA){return aA.length>=ay})))};t.spy=function(ay){return k.push(ay)};k=[];f=function(aB){var az,ay,aA;if(k.length){if(!f.running){try{f.running=true;for(az=0,ay=k.length;az<ay;az++){aA=k[az];aA(aB)}}finally{delete f.running}}}return void 0};t.Property.prototype.startWith=function(ay){return W(new t.Desc(this,"startWith",[ay]),this.scan(ay,function(aA,az){return az}))};t.EventStream.prototype.startWith=function(ay){return W(new t.Desc(this,"startWith",[ay]),t.once(ay).concat(this))};t.Observable.prototype.takeWhile=function(){var ay,az;az=arguments[0],ay=2<=arguments.length?l.call(arguments,1):[];J(az);return D(this,az,ay,function(aA){return W(new t.Desc(this,"takeWhile",[aA]),this.withHandler(function(aB){if(aB.filter(aA)){return this.push(aB)}else{this.push(N());return t.noMore}}))})};t.update=function(){var aA,az,ay,aB;az=arguments[0],aB=2<=arguments.length?l.call(arguments,1):[];ay=function(aC){return function(){var aD;aD=1<=arguments.length?l.call(arguments,0):[];return function(aE){return aC.apply(null,[aE].concat(aD))}}};aA=aB.length-1;while(aA>0){if(!(aB[aA] instanceof Function)){aB[aA]=(function(aC){return function(){return aC}})(aB[aA])}aB[aA]=ay(aB[aA]);aA=aA-2}return W(new t.Desc(t,"update",[az].concat(l.call(aB))),t.when.apply(t,aB).scan(az,(function(aC,aD){return aD(aC)})))};t.zipAsArray=function(){var ay;ay=1<=arguments.length?l.call(arguments,0):[];if(a(ay[0])){ay=ay[0]}return W(new t.Desc(t,"zipAsArray",ay),t.zipWith(ay,function(){var az;az=1<=arguments.length?l.call(arguments,0):[];return az}))};t.zipWith=function(){var az,ay,aA;az=arguments[0],aA=2<=arguments.length?l.call(arguments,1):[];if(!H.isFunction(az)){ay=[az,aA[0]],aA=ay[0],az=ay[1]}aA=H.map((function(aB){return aB.toEventStream()}),aA);return W(new t.Desc(t,"zipWith",[az].concat(l.call(aA))),t.when(aA,az))};t.Observable.prototype.zip=function(ay,az){if(az==null){az=Array}return W(new t.Desc(this,"zip",[ay]),t.zipWith([this,ay],az))};t.Observable.prototype.first=function(){return W(new t.Desc(this,"first",[]),this.take(1))};t.Observable.prototype.last=function(){var ay;return W(new t.Desc(this,"last",[]),this.withHandler(function(az){if(az.isEnd()){if(ay){this.push(ay)}this.push(N());return t.noMore}else{ay=az}}))};t.EventStream.prototype.throttle=function(ay){return W(new t.Desc(this,"throttle",[ay]),this.bufferWithTime(ay).map(function(az){return az[az.length-1]}))};t.Property.prototype.throttle=function(ay){return this.delayChanges(new t.Desc(this,"throttle",[ay]),function(az){return az.throttle(ay)})};p.prototype.firstToPromise=function(ay){var az=this;if(typeof ay!=="function"){if(typeof Promise==="function"){ay=Promise}else{throw new E("There isn't default Promise, use shim or parameter")}}return new ay(function(aB,aA){return az.subscribe(function(aC){if(aC.hasValue()){aB(aC.value())}if(aC.isError()){aA(aC.error)}return t.noMore})})};p.prototype.toPromise=function(ay){return this.last().firstToPromise(ay)};return t});
}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.atlassian.confluence.plugins.confluence-onboarding:common-flow-resources', location = 'flow/analytics/onboarding-analytics.js' */
define("confluence/ob/flow/analytics/onboarding-analytics",function(){var a=function(b,c){this.flowKey=b;this.sequenceKey=c};a.prototype.pushEvent=function(b,d){if(this.canPushEvent()){var e=(this.sequenceKey!==undefined)?("."+this.sequenceKey):"";var c=a.ONBOARDING_EVENT_KEY+"."+this.flowKey+e+"."+b;d=d||{};AJS.trigger("analyticsEvent",{name:c,data:d})}};a.prototype.canPushEvent=function(){return(AJS.trigger&&this.flowKey)};a.ONBOARDING_EVENT_KEY="onboarding";a.EVENTS={STARTED_SEQUENCE:"started"};return a});
}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.atlassian.confluence.plugins.confluence-onboarding:common-flow-resources', location = 'common/storage/server-storage.js' */
define("confluence/ob/common/storage/server-storage",["jquery","ajs"],function(c,b){var a={};a.get=function(d){return c.ajax({url:b.contextPath()+"/rest/onboarding/1/store",type:"GET",contentType:"application/json",data:{key:d}}).pipe(function(e){return e.value})};a.set=function(e,d){return c.ajax({url:b.contextPath()+"/rest/onboarding/1/store",type:"PUT",contentType:"application/json",data:JSON.stringify({key:e,value:d})})};a.setTeam=function(d){return c.ajax({url:b.contextPath()+"/rest/onboarding/1/store/team?id="+d,type:"PUT",contentType:"application/json"})};a.remove=function(d){return c.ajax({url:b.contextPath()+"/rest/onboarding/1/store",type:"DELETE",contentType:"application/json",data:{key:d}})};a.setGlobal=function(e,d){return c.ajax({url:b.contextPath()+"/rest/onboarding/1/store/global",type:"PUT",contentType:"application/json",data:JSON.stringify({key:e,value:d})})};a.getGlobal=function(d){return c.ajax({url:b.contextPath()+"/rest/onboarding/1/store/global",type:"GET",contentType:"application/json",data:{key:d}})};a.removeGlobal=function(d){return c.ajax({url:b.contextPath+"/rest/onboarding/1/store/global",type:"DELETE",contentType:"application/json",data:{key:d}})};return a});
}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.atlassian.confluence.plugins.confluence-onboarding:common-flow-resources', location = 'flow/controller/flow-progress-tracker.js' */
define("confluence/ob/flow/controller/flow-progress-tracker",["jquery","underscore","confluence/ob/common/storage/server-storage"],function(d,b,a){function c(e){return"onboarding-state:"+e}return{completeFlow:function(e){return a.set(c(e),"__complete__")},setCurrentFlowSequence:function(e,f){return a.set(c(e),f)},getCurrentFlowSequence:function(e){return a.get(c(e))}}});
}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.atlassian.confluence.plugins.confluence-onboarding:common-flow-resources', location = 'flow/controller/sequence-controller.js' */
define("confluence/ob/flow/controller/sequence-controller",["jquery","underscore","confluence/ob/flow/analytics/onboarding-analytics","confluence/ob/flow/controller/flow-progress-tracker","confluence/ob/common/promise"],function(e,c,f,b,d){var a=function(g){g=g||{};if(!g.container){throw new Error("Should have passed a container to put the sequence content")}else{var h=g.container instanceof e;var i=g.container instanceof HTMLElement;if(h){g.container=g.container.get(0)}if(!h&&!i){throw new Error("Container must be a DOM node")}}if(!g.flow){throw new Error("Should have flow information for controller")}if(typeof g.flow!=="function"){throw new Error("First use flow should be a function")}this.container=g.container;this.flow=g.flow(c.bind(this.complete,this));this.currentFlowKey=g.flowKey;this.progressTracker=g.progressTracker||b;if(!this.flow.sequences){throw new Error("Should have sequences in the controller")}if(!this.flow.start){throw new Error("Should have a start point for the flow")}if(!this.flow.sequences[this.flow.start]){throw new Error("Start point should actually be a sequence")}};a.prototype.start=function(g){if(!g||!this.hasSequence(g)){g=this.flow.start}this._executeSequence(g)};a.prototype._executeSequence=function(j){var g=this;var k=this.flow.sequences[j];var i=document.createElement("div");e(this.container).html(i);var h=new f(this.flow.key,j);h.pushEvent(f.EVENTS.STARTED_SEQUENCE);k.instance.init(i,h).then(function(){g._completeSequence(k,"resolve",arguments)},function(){g._completeSequence(k,"reject",arguments)})};a.prototype._completeSequence=function(j,g,h){var i;if(typeof j[g]==="string"){i=j[g]}else{if(typeof j[g]==="function"){i=j[g].apply(this,h)}}if(!i||!this.hasSequence(i)){return false}this._updateCurrentSequence(i);this._executeSequence(i)};a.prototype.hasSequence=function(g){return(this.flow.sequences[g]!==undefined)};a.prototype._updateCurrentSequence=function(g){if(this.currentFlowKey){this.progressTracker.setCurrentFlowSequence(this.currentFlowKey,g)}};a.prototype.complete=function(){return d(c.bind(function(g){if(this.currentFlowKey){this.progressTracker.completeFlow(this.currentFlowKey).always(g)}else{g()}},this))};return a});
}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.atlassian.confluence.plugins.confluence-user-profile:avatar-picker', location = 'avatar-picker/js/exif.js' */
(function(){var k=false;var m=this;var d=function(v){if(v instanceof d){return v}if(!(this instanceof d)){return new d(v)}this.EXIFwrapped=v};if(typeof exports!=="undefined"){if(typeof module!=="undefined"&&module.exports){exports=module.exports=d}exports.EXIF=d}else{m.EXIF=d}var r=d.Tags={36864:"ExifVersion",40960:"FlashpixVersion",40961:"ColorSpace",40962:"PixelXDimension",40963:"PixelYDimension",37121:"ComponentsConfiguration",37122:"CompressedBitsPerPixel",37500:"MakerNote",37510:"UserComment",40964:"RelatedSoundFile",36867:"DateTimeOriginal",36868:"DateTimeDigitized",37520:"SubsecTime",37521:"SubsecTimeOriginal",37522:"SubsecTimeDigitized",33434:"ExposureTime",33437:"FNumber",34850:"ExposureProgram",34852:"SpectralSensitivity",34855:"ISOSpeedRatings",34856:"OECF",37377:"ShutterSpeedValue",37378:"ApertureValue",37379:"BrightnessValue",37380:"ExposureBias",37381:"MaxApertureValue",37382:"SubjectDistance",37383:"MeteringMode",37384:"LightSource",37385:"Flash",37396:"SubjectArea",37386:"FocalLength",41483:"FlashEnergy",41484:"SpatialFrequencyResponse",41486:"FocalPlaneXResolution",41487:"FocalPlaneYResolution",41488:"FocalPlaneResolutionUnit",41492:"SubjectLocation",41493:"ExposureIndex",41495:"SensingMethod",41728:"FileSource",41729:"SceneType",41730:"CFAPattern",41985:"CustomRendered",41986:"ExposureMode",41987:"WhiteBalance",41988:"DigitalZoomRation",41989:"FocalLengthIn35mmFilm",41990:"SceneCaptureType",41991:"GainControl",41992:"Contrast",41993:"Saturation",41994:"Sharpness",41995:"DeviceSettingDescription",41996:"SubjectDistanceRange",40965:"InteroperabilityIFDPointer",42016:"ImageUniqueID"};var u=d.TiffTags={256:"ImageWidth",257:"ImageHeight",34665:"ExifIFDPointer",34853:"GPSInfoIFDPointer",40965:"InteroperabilityIFDPointer",258:"BitsPerSample",259:"Compression",262:"PhotometricInterpretation",274:"Orientation",277:"SamplesPerPixel",284:"PlanarConfiguration",530:"YCbCrSubSampling",531:"YCbCrPositioning",282:"XResolution",283:"YResolution",296:"ResolutionUnit",273:"StripOffsets",278:"RowsPerStrip",279:"StripByteCounts",513:"JPEGInterchangeFormat",514:"JPEGInterchangeFormatLength",301:"TransferFunction",318:"WhitePoint",319:"PrimaryChromaticities",529:"YCbCrCoefficients",532:"ReferenceBlackWhite",306:"DateTime",270:"ImageDescription",271:"Make",272:"Model",305:"Software",315:"Artist",33432:"Copyright"};var j=d.GPSTags={0:"GPSVersionID",1:"GPSLatitudeRef",2:"GPSLatitude",3:"GPSLongitudeRef",4:"GPSLongitude",5:"GPSAltitudeRef",6:"GPSAltitude",7:"GPSTimeStamp",8:"GPSSatellites",9:"GPSStatus",10:"GPSMeasureMode",11:"GPSDOP",12:"GPSSpeedRef",13:"GPSSpeed",14:"GPSTrackRef",15:"GPSTrack",16:"GPSImgDirectionRef",17:"GPSImgDirection",18:"GPSMapDatum",19:"GPSDestLatitudeRef",20:"GPSDestLatitude",21:"GPSDestLongitudeRef",22:"GPSDestLongitude",23:"GPSDestBearingRef",24:"GPSDestBearing",25:"GPSDestDistanceRef",26:"GPSDestDistance",27:"GPSProcessingMethod",28:"GPSAreaInformation",29:"GPSDateStamp",30:"GPSDifferential"};var h=d.StringValues={ExposureProgram:{0:"Not defined",1:"Manual",2:"Normal program",3:"Aperture priority",4:"Shutter priority",5:"Creative program",6:"Action program",7:"Portrait mode",8:"Landscape mode"},MeteringMode:{0:"Unknown",1:"Average",2:"CenterWeightedAverage",3:"Spot",4:"MultiSpot",5:"Pattern",6:"Partial",255:"Other"},LightSource:{0:"Unknown",1:"Daylight",2:"Fluorescent",3:"Tungsten (incandescent light)",4:"Flash",9:"Fine weather",10:"Cloudy weather",11:"Shade",12:"Daylight fluorescent (D 5700 - 7100K)",13:"Day white fluorescent (N 4600 - 5400K)",14:"Cool white fluorescent (W 3900 - 4500K)",15:"White fluorescent (WW 3200 - 3700K)",17:"Standard light A",18:"Standard light B",19:"Standard light C",20:"D55",21:"D65",22:"D75",23:"D50",24:"ISO studio tungsten",255:"Other"},Flash:{0:"Flash did not fire",1:"Flash fired",5:"Strobe return light not detected",7:"Strobe return light detected",9:"Flash fired, compulsory flash mode",13:"Flash fired, compulsory flash mode, return light not detected",15:"Flash fired, compulsory flash mode, return light detected",16:"Flash did not fire, compulsory flash mode",24:"Flash did not fire, auto mode",25:"Flash fired, auto mode",29:"Flash fired, auto mode, return light not detected",31:"Flash fired, auto mode, return light detected",32:"No flash function",65:"Flash fired, red-eye reduction mode",69:"Flash fired, red-eye reduction mode, return light not detected",71:"Flash fired, red-eye reduction mode, return light detected",73:"Flash fired, compulsory flash mode, red-eye reduction mode",77:"Flash fired, compulsory flash mode, red-eye reduction mode, return light not detected",79:"Flash fired, compulsory flash mode, red-eye reduction mode, return light detected",89:"Flash fired, auto mode, red-eye reduction mode",93:"Flash fired, auto mode, return light not detected, red-eye reduction mode",95:"Flash fired, auto mode, return light detected, red-eye reduction mode"},SensingMethod:{1:"Not defined",2:"One-chip color area sensor",3:"Two-chip color area sensor",4:"Three-chip color area sensor",5:"Color sequential area sensor",7:"Trilinear sensor",8:"Color sequential linear sensor"},SceneCaptureType:{0:"Standard",1:"Landscape",2:"Portrait",3:"Night scene"},SceneType:{1:"Directly photographed"},CustomRendered:{0:"Normal process",1:"Custom process"},WhiteBalance:{0:"Auto white balance",1:"Manual white balance"},GainControl:{0:"None",1:"Low gain up",2:"High gain up",3:"Low gain down",4:"High gain down"},Contrast:{0:"Normal",1:"Soft",2:"Hard"},Saturation:{0:"Normal",1:"Low saturation",2:"High saturation"},Sharpness:{0:"Normal",1:"Soft",2:"Hard"},SubjectDistanceRange:{0:"Unknown",1:"Macro",2:"Close view",3:"Distant view"},FileSource:{3:"DSC"},Components:{0:"",1:"Y",2:"Cb",3:"Cr",4:"R",5:"G",6:"B"}};function o(v,x,w){if(v.addEventListener){v.addEventListener(x,w,false)}else{if(v.attachEvent){v.attachEvent("on"+x,w)}}}function g(v){return !!(v.exifdata)}function c(y,B){B=B||y.match(/^data\:([^\;]+)\;base64,/mi)[1]||"";y=y.replace(/^data\:([^\;]+)\;base64,/gmi,"");var A=atob(y);var v=A.length;var x=new ArrayBuffer(v);var w=new Uint8Array(x);for(var z=0;z<v;z++){w[z]=A.charCodeAt(z)}return x}function s(w,x){var v=new XMLHttpRequest();v.open("GET",w,true);v.responseType="blob";v.onload=function(y){if(this.status==200||this.status===0){x(this.response)}};v.send()}function b(w,A){function y(D){var C=f(D);var B=e(D);w.exifdata=C||{};w.iptcdata=B||{};if(A){A.call(w)}}if(w.src){if(/^data\:/i.test(w.src)){var z=c(w.src);y(z)}else{if(/^blob\:/i.test(w.src)){var v=new FileReader();v.onload=function(B){y(B.target.result)};s(w.src,function(B){v.readAsArrayBuffer(B)})}else{var x=new XMLHttpRequest();x.onload=function(){if(this.status==200||this.status===0){y(x.response)}else{throw"Could not load image"}x=null};x.open("GET",w.src,true);x.responseType="arraybuffer";x.send(null)}}}else{if(window.FileReader&&(w instanceof window.Blob||w instanceof window.File)){var v=new FileReader();v.onload=function(B){if(k){console.log("Got file of length "+B.target.result.byteLength)}y(B.target.result)};v.readAsArrayBuffer(w)}}}function f(w){var z=new DataView(w);if(k){console.log("Got file of length "+w.byteLength)}if((z.getUint8(0)!=255)||(z.getUint8(1)!=216)){if(k){console.log("Not a valid JPEG")}return false}var y=2,x=w.byteLength,v;while(y<x){if(z.getUint8(y)!=255){if(k){console.log("Not a valid marker at offset "+y+", found: "+z.getUint8(y))}return false}v=z.getUint8(y+1);if(k){console.log(v)}if(v==225){if(k){console.log("Found 0xFFE1 marker")}return q(z,y+4,z.getUint16(y+2)-2)}else{y+=2+z.getUint16(y+2)}}}function e(z){var C=new DataView(z);if(k){console.log("Got file of length "+z.byteLength)}if((C.getUint8(0)!=255)||(C.getUint8(1)!=216)){if(k){console.log("Not a valid JPEG")}return false}var B=2,A=z.byteLength;var w=function(E,D){return(E.getUint8(D)===56&&E.getUint8(D+1)===66&&E.getUint8(D+2)===73&&E.getUint8(D+3)===77&&E.getUint8(D+4)===4&&E.getUint8(D+5)===4)};while(B<A){if(w(C,B)){var y=C.getUint8(B+7);if(y%2!==0){y+=1}if(y===0){y=4}var v=B+8+y;var x=C.getUint16(B+6+y);return t(z,v,x);break}B++}}var a={120:"caption",110:"credit",25:"keywords",55:"dateCreated",80:"byline",85:"bylineTitle",122:"captionWriter",105:"headline",116:"copyright",15:"category"};function t(z,C,B){var D=new DataView(z);var A={};var w,F,v,E,x;var y=C;while(y<C+B){if(D.getUint8(y)===28&&D.getUint8(y+1)===2){E=D.getUint8(y+2);if(E in a){v=D.getInt16(y+3);x=v+5;F=a[E];w=l(D,y+5,v);if(A.hasOwnProperty(F)){if(A[F] instanceof Array){A[F].push(w)}else{A[F]=[A[F],w]}}else{A[F]=w}}}y++}return A}function p(v,B,D,A,x){var y=v.getUint16(D,!x),E={},z,C,w;for(w=0;w<y;w++){z=D+w*12+2;C=A[v.getUint16(z,!x)];if(!C&&k){console.log("Unknown tag: "+v.getUint16(z,!x))}E[C]=i(v,z,B,D,x)}return E}function i(A,E,H,I,C){var D=A.getUint16(E+2,!C),G=A.getUint32(E+4,!C),w=A.getUint32(E+8,!C)+H,B,F,z,y,v,x;switch(D){case 1:case 7:if(G==1){return A.getUint8(E+8,!C)}else{B=G>4?w:(E+8);F=[];for(y=0;y<G;y++){F[y]=A.getUint8(B+y)}return F}case 2:B=G>4?w:(E+8);return l(A,B,G-1);case 3:if(G==1){return A.getUint16(E+8,!C)}else{B=G>2?w:(E+8);F=[];for(y=0;y<G;y++){F[y]=A.getUint16(B+2*y,!C)}return F}case 4:if(G==1){return A.getUint32(E+8,!C)}else{F=[];for(y=0;y<G;y++){F[y]=A.getUint32(w+4*y,!C)}return F}case 5:if(G==1){v=A.getUint32(w,!C);x=A.getUint32(w+4,!C);z=new Number(v/x);z.numerator=v;z.denominator=x;return z}else{F=[];for(y=0;y<G;y++){v=A.getUint32(w+8*y,!C);x=A.getUint32(w+4+8*y,!C);F[y]=new Number(v/x);F[y].numerator=v;F[y].denominator=x}return F}case 9:if(G==1){return A.getInt32(E+8,!C)}else{F=[];for(y=0;y<G;y++){F[y]=A.getInt32(w+4*y,!C)}return F}case 10:if(G==1){return A.getInt32(w,!C)/A.getInt32(w+4,!C)}else{F=[];for(y=0;y<G;y++){F[y]=A.getInt32(w+8*y,!C)/A.getInt32(w+4+8*y,!C)}return F}}}function l(w,y,x){var v="";for(n=y;n<y+x;n++){v+=String.fromCharCode(w.getUint8(n))}return v}function q(z,w){if(l(z,w,4)!="Exif"){if(k){console.log("Not valid EXIF data! "+l(z,w,4))}return false}var A,C,D,y,x,B=w+6;if(z.getUint16(B)==18761){A=false}else{if(z.getUint16(B)==19789){A=true}else{if(k){console.log("Not valid TIFF data! (no 0x4949 or 0x4D4D)")}return false}}if(z.getUint16(B+2,!A)!=42){if(k){console.log("Not valid TIFF data! (no 0x002A)")}return false}var v=z.getUint32(B+4,!A);if(v<8){if(k){console.log("Not valid TIFF data! (First offset less than 8)",z.getUint32(B+4,!A))}return false}C=p(z,B,B+v,u,A);if(C.ExifIFDPointer){y=p(z,B,B+C.ExifIFDPointer,r,A);for(D in y){switch(D){case"LightSource":case"Flash":case"MeteringMode":case"ExposureProgram":case"SensingMethod":case"SceneCaptureType":case"SceneType":case"CustomRendered":case"WhiteBalance":case"GainControl":case"Contrast":case"Saturation":case"Sharpness":case"SubjectDistanceRange":case"FileSource":y[D]=h[D][y[D]];break;case"ExifVersion":case"FlashpixVersion":y[D]=String.fromCharCode(y[D][0],y[D][1],y[D][2],y[D][3]);break;case"ComponentsConfiguration":y[D]=h.Components[y[D][0]]+h.Components[y[D][1]]+h.Components[y[D][2]]+h.Components[y[D][3]];break}C[D]=y[D]}}if(C.GPSInfoIFDPointer){x=p(z,B,B+C.GPSInfoIFDPointer,j,A);for(D in x){switch(D){case"GPSVersionID":x[D]=x[D][0]+"."+x[D][1]+"."+x[D][2]+"."+x[D][3];break}C[D]=x[D]}}return C}d.getData=function(v,w){if((v instanceof Image||v instanceof HTMLImageElement)&&!v.complete){return false}if(!g(v)){b(v,w)}else{if(w){w.call(v)}}return true};d.getTag=function(w,v){if(!g(w)){return}return w.exifdata[v]};d.getIptcTag=function(w,v){if(!g(w)){return}return w.iptcdata[v]};d.getAllTags=function(w){if(!g(w)){return{}}var v,y=w.exifdata,x={};for(v in y){if(y.hasOwnProperty(v)){x[v]=y[v]}}return x};d.getAllIptcTags=function(w){if(!g(w)){return{}}var v,y=w.iptcdata,x={};for(v in y){if(y.hasOwnProperty(v)){x[v]=y[v]}}return x};d.pretty=function(w){if(!g(w)){return""}var v,y=w.exifdata,x="";for(v in y){if(y.hasOwnProperty(v)){if(typeof y[v]=="object"){if(y[v] instanceof Number){x+=v+" : "+y[v]+" ["+y[v].numerator+"/"+y[v].denominator+"]\r\n"}else{x+=v+" : ["+y[v].length+" values]\r\n"}}else{x+=v+" : "+y[v]+"\r\n"}}}return x};d.readFromBinaryFile=function(v){return f(v)};if(typeof define==="function"&&define.amd){define("exif-js",[],function(){return d})}}.call(this));
}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.atlassian.confluence.plugins.confluence-user-profile:avatar-picker', location = 'avatar-picker/templates/image-explorer.soy' */
// This file was automatically generated from image-explorer.soy.
// Please don't edit this file by hand.

/**
 * @fileoverview Templates in namespace Confluence.Templates.User.Avatar.Picker.
 */

if (typeof Confluence == 'undefined') { var Confluence = {}; }
if (typeof Confluence.Templates == 'undefined') { Confluence.Templates = {}; }
if (typeof Confluence.Templates.User == 'undefined') { Confluence.Templates.User = {}; }
if (typeof Confluence.Templates.User.Avatar == 'undefined') { Confluence.Templates.User.Avatar = {}; }
if (typeof Confluence.Templates.User.Avatar.Picker == 'undefined') { Confluence.Templates.User.Avatar.Picker = {}; }


Confluence.Templates.User.Avatar.Picker.imageExplorer = function(opt_data, opt_ignored) {
  opt_data = opt_data || {};
  return '<div class="profile-pic-explorer-container ' + ((! opt_data.imageSrc) ? 'empty' : '') + '"><div class="image-explorer-image-view" tabindex="0"><img class="image-explorer-source" ' + ((opt_data.imageSrc) ? 'src="' + soy.$$escapeHtml(opt_data.imageSrc) + '"' : '') + '/><div class="image-explorer-mask rounded-square-mask"></div><div class="image-explorer-drag-delegate"></div></div><div class="image-explorer-scale-slider-wrapper"><input class="image-explorer-scale-slider ' + ((! opt_data.imageSrc) ? 'disabled' : '') + '" type="range" min="0" max="100" step="1" value="0" ' + ((! opt_data.imageSrc) ? 'disabled' : '') + '/></div></div>';
};
if (goog.DEBUG) {
  Confluence.Templates.User.Avatar.Picker.imageExplorer.soyTemplateName = 'Confluence.Templates.User.Avatar.Picker.imageExplorer';
}


Confluence.Templates.User.Avatar.Picker.iframeResponse = function(opt_data, opt_ignored) {
  return '<html><body><div id="json-response">' + soy.$$filterNoAutoescape(opt_data.json) + '</div></body></html>';
};
if (goog.DEBUG) {
  Confluence.Templates.User.Avatar.Picker.iframeResponse.soyTemplateName = 'Confluence.Templates.User.Avatar.Picker.iframeResponse';
}

}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.atlassian.confluence.plugins.confluence-user-profile:avatar-picker', location = 'avatar-picker/templates/image-upload-and-crop.soy' */
// This file was automatically generated from image-upload-and-crop.soy.
// Please don't edit this file by hand.

/**
 * @fileoverview Templates in namespace Confluence.Templates.User.Avatar.Picker.
 */

if (typeof Confluence == 'undefined') { var Confluence = {}; }
if (typeof Confluence.Templates == 'undefined') { Confluence.Templates = {}; }
if (typeof Confluence.Templates.User == 'undefined') { Confluence.Templates.User = {}; }
if (typeof Confluence.Templates.User.Avatar == 'undefined') { Confluence.Templates.User.Avatar = {}; }
if (typeof Confluence.Templates.User.Avatar.Picker == 'undefined') { Confluence.Templates.User.Avatar.Picker = {}; }


Confluence.Templates.User.Avatar.Picker.imageUploadAndCrop = function(opt_data, opt_ignored) {
  return '<div class="image-upload-and-crop-message"></div><div class="profile-pic-upload-and-crop-container disable-attachment-uploader"><div class="input-fields"><form class="aui" onsubmit="return false;">' + Confluence.Templates.User.Avatar.Picker.imageExplorer(opt_data) + '</form></div><form class="aui"><div class="image-upload-and-crop-field-container aui-buttons input-buttons"><input type="file" id="image-upload-and-crop-upload-field" class="image-upload-field" accept="image/jpeg, image/gif, image/png"/><label for="image-upload-and-crop-upload-field" class="image-upload-field-replacement aui-button">' + soy.$$escapeHtml('\u0417\u0430\u0433\u0440\u0443\u0437\u0438\u0442\u044c \u0438\u0437\u043e\u0431\u0440\u0430\u0436\u0435\u043d\u0438\u0435') + '</label></div></form></div>';
};
if (goog.DEBUG) {
  Confluence.Templates.User.Avatar.Picker.imageUploadAndCrop.soyTemplateName = 'Confluence.Templates.User.Avatar.Picker.imageUploadAndCrop';
}

}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.atlassian.confluence.plugins.confluence-user-profile:avatar-picker', location = 'avatar-picker/js/canvas-cropper.js' */
define("confluence-user-profile/avatar-picker/canvas-cropper",["jquery"],function(c){function b(e,d){if(!b.isSupported()){AJS.messages.error({body:"This browser doesn't support CanvasCropper."})}return this.init.apply(this,arguments)}var a=(function(){var d=document.createElement("canvas");return !!(d.getContext&&d.getContext("2d"))}());b.isSupported=function(){return a};b.prototype.defaults={outputFormat:"image/jpeg",outputQuality:0.9,backgroundFillColor:"white"};b.prototype.init=function(e,d,f){this.width=e;this.height=d||e;this.options=_.extend({},this.defaults,f);this.canvas=c("<canvas/>").attr("width",this.width).attr("height",this.height)[0];return this};b.prototype.cropToDataURI=function(h,g,f,e,d){return this.crop(h,g,f,e,d).getDataURI(this.options.outputFormat,this.options.outputQuality)};b.prototype.crop=function(g,f,e,n,o){var d=this.canvas.getContext("2d"),l=0,j=0,k=this.width,h=this.height;d.clearRect(l,j,k,h);if(this.options.backgroundFillColor){d.fillStyle=this.options.backgroundFillColor;d.fillRect(l,j,k,h)}if(f<0){l=Math.round((Math.abs(f)/n)*k);f=0}if(e<0){j=Math.round((Math.abs(e)/o)*h);e=0}if(f+n>g.naturalWidth){var m=g.naturalWidth-f;k*=m/n;n=m}if(e+o>g.naturalHeight){var i=g.naturalHeight-e;h*=i/o;o=i}d.drawImage(g,f,e,n,o,l,j,k,h);return this};b.prototype.getDataURI=function(e,d){if(e){return this.canvas.toDataURL(e,d)}else{return null}};return b});
}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.atlassian.confluence.plugins.confluence-user-profile:avatar-picker', location = 'avatar-picker/js/client-file-handler.js' */
define("confluence-user-profile/avatar-picker/client-file-handler",["jquery","underscore"],function(c,b){function a(d){return this.init(d)}a.typeFilters={all:/.*/,application:/^application\/.*/,audio:/^audio\/.*/,image:/^image\/.*/,imageWeb:/^image\/(jpeg|png|gif)$/,text:/^text\/.*/,video:/^video\/.*/};a.prototype.defaults={fileTypeFilter:a.typeFilters.all,fileCountLimit:Infinity,fileSizeLimit:10*1024*1024,onSuccess:function(){},onError:function(){}};a.prototype.init=function(d){this.options=b.extend({},this.defaults,d);b.bindAll(this,"handleFiles","filterFiles");return this};a.prototype.handleFiles=function(f,e){var d=this.filterFiles(f);if(d.valid.length>0){b.isFunction(this.options.onSuccess)&&this.options.onSuccess(d.valid)}else{b.isFunction(this.options.onError)&&this.options.onError(d.invalid)}};a.prototype.filterFiles=function(e){var h=b.isRegExp(this.options.fileTypeFilter)?this.options.fileTypeFilter:this.defaults.fileTypeFilter,d=this.options.fileSizeLimit,g={byType:[],bySize:[],byCount:[]},f=b.filter(e,function(i){if(!h.test(i.type)){g.byType.push(i);return false}if(i.size>d){g.bySize.push(i);return false}return true});if(f.length>this.options.fileCountLimit){g.byCount=f.slice(this.options.fileCountLimit);f=f.slice(0,this.options.fileCountLimit)}return{valid:f,invalid:g}};return a});
}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.atlassian.confluence.plugins.confluence-user-profile:avatar-picker', location = 'avatar-picker/js/client-file-iframe-uploader.js' */
define("confluence-user-profile/avatar-picker/client-file-iframe-uploader",["jquery","underscore","confluence-user-profile/avatar-picker/client-file-handler"],function(d,b,a){function c(e){return this.init(e)}d.extend(c.prototype,a.prototype);c.prototype.defaults=d.extend({},a.prototype.defaults,{uploadURL:AJS.Meta.get("context-path")+"/rest/user-profile/1.0/avatar/default",uploadFieldName:"file",onUpload:d.noop,responseHandler:function(g,h){var f;try{f=JSON.parse(d(g).html())}catch(i){h.reject()}if(f){h.resolve(f)}else{h.reject()}}});c.prototype.states={IN_PROGRESS:"IN_PROGRESS",IDLE:"IDLE"};c.prototype.init=function(e){b.bindAll(this,"createHiddenIframe","onIframeLoad","handleFiles","setStateInProgress","setStateIdle","cancelUpload");this.options=d.extend({},this.defaults,e);this.$uploadIframe=this.createHiddenIframe();if(this.options.cancelTrigger){this.$cancelTrigger=d(this.options.cancelTrigger);this.$cancelTrigger.click(b.bind(function(){this.cancelUpload()},this))}this.state=this.states.IDLE;return this};c.prototype.createHiddenIframe=function(){return d("<iframe>").attr("name","hidden-upload-iframe").hide().appendTo(document.body).on("load",this.onIframeLoad)};c.prototype.onIframeLoad=function(f){if(this.state===this.states.IN_PROGRESS){this.requestPromise.done(this.options.onUpload).fail(this.options.onError);this.options.responseHandler(f.target.contentDocument.body,this.requestPromise)}};c.prototype.handleFiles=function(f,e){if(this.state===this.states.IN_PROGRESS){this.cancelUpload()}if(!this.$fileSourceElem){this.$fileSourceElem=d(e);this.$fileSourceElem.attr("name",this.options.uploadFieldName);if(!this.$fileSourceElem.prop("form")){this.$fileSourceElem.wrap("<form>")}var g=d(this.$fileSourceElem.prop("form"));g.addClass("hidden-upload-form").attr("action",this.options.uploadURL).attr("method","post").attr("enctype","multipart/form-data").attr("encoding","multipart/form-data").attr("target",this.$uploadIframe.attr("name"));this.$spinner=d('<div class="spinner"></div>').insertBefore(this.$fileSourceElem);if(d.isPlainObject(this.options.extraData)){b.each(this.options.extraData,function(i,h){d('<input type="hidden">').attr("name",h).val(i).appendTo(g)})}}this.$fileSourceElem.prop("form").submit();this.requestPromise=d.Deferred();this.requestPromise.always(this.setStateIdle);this.setStateInProgress()};c.prototype.setStateInProgress=function(){this.state=this.states.IN_PROGRESS;if(this.$spinner){this.$spinner.spin()}if(this.$fileSourceElem){this.$fileSourceElem.attr("disabled","disabled")}};c.prototype.setStateIdle=function(){this.state=this.states.IDLE;if(this.$spinner){this.$spinner.spinStop()}if(this.$fileSourceElem){this.$fileSourceElem.removeAttr("disabled")}this.requestPromise=null};c.prototype.cancelUpload=function(){this.$uploadIframe.remove();this.setStateIdle();this.$uploadIframe=this.createHiddenIframe()};return c});
}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.atlassian.confluence.plugins.confluence-user-profile:avatar-picker', location = 'avatar-picker/js/client-file-reader.js' */
define("confluence-user-profile/avatar-picker/client-file-reader",["jquery","underscore","confluence-user-profile/avatar-picker/client-file-handler"],function(e,d,b){var f=!!(window.File&&window.FileList&&window.FileReader);var c={ArrayBuffer:"readAsArrayBuffer",BinaryString:"readAsBinaryString",DataURL:"readAsDataURL",Text:"readAsText"};function a(g){if(!a.isSupported()){throw new Error("ClientFileReader requires FileReaderAPI support")}return this.init(g)}a.isSupported=function(){return f};d.extend(a.prototype,b.prototype);a.readMethods={ArrayBuffer:"ArrayBuffer",BinaryString:"BinaryString",DataURL:"DataURL",Text:"Text"};a.typeFilters=b.typeFilters;a.prototype.defaults=d.extend({},b.prototype.defaults,{readMethod:a.readMethods.DataURL,onRead:function(){}});a.prototype.init=function(g){b.prototype.init.call(this,g);d.bindAll(this,"onSuccess","readFile");this.options.onSuccess=this.onSuccess;return this};a.prototype.onSuccess=function(h){var g=d.has(c,this.options.readMethod)?c[this.options.readMethod]:undefined;if(g){d.each(h,d.bind(function(j){var i=new FileReader();i.onload=d.bind(this.readFile,this,j);i[g](j)},this))}};a.prototype.readFile=function(g,h){d.isFunction(this.options.onRead)&&this.options.onRead(h.target.result,g)};return a});
}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.atlassian.confluence.plugins.confluence-user-profile:avatar-picker', location = 'avatar-picker/js/drag-drop-file-target.js' */
define("confluence-user-profile/avatar-picker/drag-drop-file-target",["jquery","underscore"],function(c,a){function b(d,e){return this.init.apply(this,arguments)}b.prototype.getDefaults=function(){return{activeDropTargetClass:"active-drop-target",uploadPrompt:"\u041f\u0435\u0440\u0435\u0442\u0430\u0449\u0438\u0442\u0435 \u0441\u044e\u0434\u0430 \u0438\u0437\u043e\u0431\u0440\u0430\u0436\u0435\u043d\u0438\u0435",clientFileHandler:null}};b.prototype.init=function(d,e){a.bindAll(this,"onDragOver","onDragEnd","onDrop");this._$target=c(d);this.options=a.extend({},this.getDefaults(),e);this._$target.attr("data-upload-prompt",this.options.uploadPrompt);this._$target.on("dragover",this.onDragOver);this._$target.on("dragleave",this.onDragEnd);this._$target.on("dragend",this.onDragEnd);this._$target.on("drop",this.onDrop)};b.prototype.onDragOver=function(d){d.preventDefault();this._$target.addClass(this.options.activeDropTargetClass)};b.prototype.onDragEnd=function(d){d.preventDefault();this._$target.removeClass(this.options.activeDropTargetClass)};b.prototype.onDrop=function(d){d.preventDefault();d.originalEvent.preventDefault();this._$target.removeClass(this.options.activeDropTargetClass);if(this.options.clientFileHandler){this.options.clientFileHandler.handleFiles(d.originalEvent.dataTransfer.files,d.originalEvent.target)}};return b});
}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.atlassian.confluence.plugins.confluence-user-profile:avatar-picker', location = 'avatar-picker/js/image-explorer.js' */
define("confluence-user-profile/avatar-picker/image-explorer",["jquery","underscore"],function(b,a){function c(e,d){this.init.apply(this,arguments)}c.scaleModes={fill:"fill",contain:"contain",containAndFill:"containAndFill"};c.zoomModes={localZoom:"localZoom",imageZoom:"imageZoom"};c.prototype.defaults={initialScaleMode:c.scaleModes.containAndFill,zoomMode:c.zoomModes.localZoom,emptyClass:"empty",scaleMax:1};c.prototype.init=function(e,d){this.$container=e;this._$imageView=this.$container.find(".image-explorer-image-view");this._$sourceImage=this.$container.find(".image-explorer-source");this._$mask=this.$container.find(".image-explorer-mask");this._$dragDelegate=this.$container.find(".image-explorer-drag-delegate");this.$scaleSlider=this.$container.find(".image-explorer-scale-slider");this.options=a.extend({},this.defaults,d);this.imageProperties={};a.bindAll(this,"getImageSrc","setImageSrc","initImage","initDragDelegate","initScaleSlider","setInitialScale","getFillScale","getContainedScale","getCircularContainedScale","sliderValToScale","scaleToSliderVal","updateImageScale","resetImagePosition","resetScaleSlider","toggleEmpty","get$ImageView","get$SourceImage","get$Mask","get$DragDelegate","getMaskedImageProperties","showError","clearError","hasValidImage","_resetFromError","_removeError");this.toggleEmpty(true);if(this._$sourceImage[0].naturalWidth){this.toggleEmpty(false);this.initImage({target:this._$sourceImage[0]})}this._$sourceImage.on("load",this.initImage);this.initDragDelegate();this.initScaleSlider()};c.prototype.getImageSrc=function(){return(this._$sourceImage)?this._$sourceImage.attr("src"):undefined};c.prototype.setImageSrc=function(d){if(this._$sourceImage){this._$sourceImage.attr("src","").attr("src",d)}};c.prototype.initImage=function(f){var d=f.target;this.imageProperties.naturalWidth=d.naturalWidth;this.imageProperties.naturalHeight=d.naturalHeight;this._removeError();this.toggleEmpty(false);this.setInitialScale()};c.prototype.initDragDelegate=function(){var d;this._$dragDelegate.draggable({start:a.bind(function(){d=this._$sourceImage.offset()},this),drag:a.bind(function(g,f){this._$sourceImage.offset({top:d.top+f.position.top-f.originalPosition.top,left:d.left+f.position.left-f.originalPosition.left})},this),revert:true,revertDuration:0})};c.prototype.initScaleSlider=function(){this.$scaleSlider.on("change",a.bind(function(d){this.updateImageScale(this.sliderValToScale(d.target.value))},this))};c.prototype.setInitialScale=function(){var h=this._$mask.width(),f=this._$mask.height(),e=this.imageProperties.naturalWidth,g=this.imageProperties.naturalHeight,d=1;this.minScale=1;switch(this.options.initialScaleMode){case c.scaleModes.fill:this.minScale=d=this.getFillScale(e,g,h,f);break;case c.scaleModes.contain:if(this._$mask.hasClass("circle-mask")){this.minScale=d=this.getCircularContainedScale(e,g,h/2)}else{this.minScale=d=this.getContainedScale(e,g,h,f)}break;case c.scaleModes.containAndFill:if(this._$mask.hasClass("circle-mask")){this.minScale=this.getCircularContainedScale(e,g,h/2)}else{this.minScale=this.getContainedScale(e,g,h,f)}d=this.getFillScale(e,g,h,f);break}this.maxScale=Math.max(d,this.options.scaleMax);this.resetScaleSlider(this.scaleToSliderVal(d));this.updateImageScale(d,c.zoomModes.imageZoom);this.resetImagePosition()};c.prototype.getFillScale=function(f,d,e,i){var h=e/f,g=i/d;return Math.max(h,g)};c.prototype.getContainedScale=function(f,d,e,i){var h=e/f,g=i/d;return Math.min(h,g)};c.prototype.getCircularContainedScale=function(e,d,h){var g=Math.atan(d/e),f=Math.cos(g)*h*2;return f/e};c.prototype.sliderValToScale=function(e){var d=e/(this.$scaleSlider.attr("max")-this.$scaleSlider.attr("min"));return this.minScale+(d*(this.maxScale-this.minScale))};c.prototype.scaleToSliderVal=function(e){var d=(e-this.minScale)/(this.maxScale-this.minScale);return d*(this.$scaleSlider.attr("max")-this.$scaleSlider.attr("min"))};c.prototype.updateImageScale=function(j,l){var i=Math.round(j*this.imageProperties.naturalWidth),d=Math.round(j*this.imageProperties.naturalHeight),f,e;l=l||this.options.zoomMode;switch(l){case c.zoomModes.imageZoom:f=-1*i/2;e=-1*d/2;break;case c.zoomModes.localZoom:var h=this._$sourceImage.width(),r=this._$sourceImage.height(),n=parseInt(this._$sourceImage.css("margin-left"),10),g=parseInt(this._$sourceImage.css("margin-top"),10),q=this._$sourceImage.position(),p=this._$imageView.width()/2,o=this._$imageView.height()/2,m=p-q.left-n,k=o-q.top-g,t=(m/h)*i,s=(k/r)*d;f=p-q.left-t;e=o-q.top-s;break}this._$sourceImage.width(i).height(d).css({"margin-left":Math.round(f)+"px","margin-top":Math.round(e)+"px"})};c.prototype.resetImagePosition=function(){this._$sourceImage.css({top:"50%",left:"50%"})};c.prototype.resetScaleSlider=function(d){this.$scaleSlider.val(d).removeClass("disabled").removeAttr("disabled")};c.prototype.toggleEmpty=function(d){this.$container.toggleClass(this.options.emptyClass,d)};c.prototype.get$ImageView=function(){return this._$imageView};c.prototype.get$SourceImage=function(){return this._$sourceImage};c.prototype.get$Mask=function(){return this._$mask};c.prototype.get$DragDelegate=function(){return this._$dragDelegate};c.prototype.getMaskedImageProperties=function(){var f=this._$sourceImage.width()/this.imageProperties.naturalWidth,e=this._$sourceImage.height()/this.imageProperties.naturalHeight,d=this._$mask.position(),g=this._$sourceImage.position();d.top+=parseInt(this._$mask.css("margin-top"),10);d.left+=parseInt(this._$mask.css("margin-left"),10);g.top+=parseInt(this._$sourceImage.css("margin-top"),10);g.left+=parseInt(this._$sourceImage.css("margin-left"),10);return{maskedAreaImageX:Math.round((d.left-g.left)/f),maskedAreaImageY:Math.round((d.top-g.top)/e),maskedAreaWidth:Math.round(this._$mask.width()/f),maskedAreaHeight:Math.round(this._$mask.height()/e)}};c.prototype.showError=function(f,e){this._removeError();this.toggleEmpty(true);this.$container.addClass("error");var d=b(aui.message.error({titleContent:f,content:e||"",closeable:true}));d.appendTo(this._$imageView).css({"margin-top":-1*d.outerHeight()/2}).attr("id","upload-error-message");d.on("messageClose",this._resetFromError);AJS.messages.setup()};c.prototype.clearError=function(){this._removeError();this._resetFromError()};c.prototype.hasValidImage=function(){return !!(this.getImageSrc()&&this._$sourceImage.prop("naturalWidth"))};c.prototype._resetFromError=function(){var d=this.hasValidImage();this.toggleEmpty(!d);this.$container.removeClass("error");a.isFunction(this.options.onErrorReset)&&this.options.onErrorReset(d?this.getImageSrc():undefined)};c.prototype._removeError=function(){this._$imageView.find(".aui-message.error").remove()};return c});
}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.atlassian.confluence.plugins.confluence-user-profile:avatar-picker', location = 'avatar-picker/js/image-upload-and-crop.js' */
define("confluence-user-profile/avatar-picker/image-upload-and-crop",["jquery","underscore","confluence-user-profile/avatar-picker/canvas-cropper","confluence-user-profile/avatar-picker/client-file-iframe-uploader","confluence-user-profile/avatar-picker/client-file-reader","confluence-user-profile/avatar-picker/drag-drop-file-target","confluence-user-profile/avatar-picker/image-explorer","confluence-user-profile/avatar-picker/text-util","confluence-user-profile/avatar-picker/upload-interceptor"],function(e,h,b,i,f,g,j,d,a){function c(l,k){if(!c.isSupported()){AJS.messages.error({body:"This browser doesn't support ImageUploadAndCrop."})}this.init.apply(this,arguments)}c.isSupported=function(){return b.isSupported()};c.prototype.defaults={HiDPIMultiplier:2,dragDropUploadPrompt:"\u041f\u0435\u0440\u0435\u0442\u0430\u0449\u0438\u0442\u0435 \u0441\u044e\u0434\u0430 \u0438\u0437\u043e\u0431\u0440\u0430\u0436\u0435\u043d\u0438\u0435",onImageUpload:function(){},onImageUploadError:function(){},onCrop:function(){},outputFormat:"image/jpeg",outputQuality:0.9,fallbackUploadOptions:{},initialScaleMode:j.scaleModes.containAndFill,scaleMax:1,fileSizeLimit:10*1024*1024,maxImageDimension:4000};c.prototype.init=function(n,m){this.options=h.extend({},this.defaults,m);this.$container=n;h.bindAll(this,"crop","resetState","_onFileProcessed","setImageSrc","validateImageResolution","_onFilesError","_onFileError","_resetFileUploadField","_onErrorReset","_rotateImage");this.imageExplorer=new j(this.$container.find(".profile-pic-explorer-container"),{initialScaleMode:this.options.initialScaleMode,scaleMax:this.options.scaleMax,onErrorReset:this._onErrorReset});if(f.isSupported()){this.clientFileReader=new f({onRead:this._onFileProcessed,onError:this._onFilesError,fileTypeFilter:f.typeFilters.imageWeb,fileCountLimit:1,fileSizeLimit:this.options.fileSizeLimit});this.dragDropFileTarget=new g(this.imageExplorer.get$ImageView(),{uploadPrompt:this.options.dragDropUploadPrompt,clientFileHandler:this.clientFileReader})}else{this.$container.addClass("filereader-unsupported");var l=h.extend({onUpload:this._onFileProcessed,onError:this._onFileError},this.options.fallbackUploadOptions);this.clientFileReader=new i(l)}this.uploadIntercepter=new a(this.$container.find(".image-upload-field"),{replacementEl:this.$container.find(".image-upload-field-replacement"),clientFileHandler:this.clientFileReader});var k=this.imageExplorer.get$Mask();this.canvasCroppper=new b(k.width()*this.options.HiDPIMultiplier,k.height()*this.options.HiDPIMultiplier,{outputFormat:this.options.outputFormat,outputQuality:this.options.outputQuality});this.options.cropButton&&e(this.options.cropButton).click(this.crop)};c.prototype.crop=function(){var k="";if(!this.imageExplorer.$container.hasClass("empty")){var l=this.imageExplorer.getMaskedImageProperties();k=this.canvasCroppper.cropToDataURI(this.imageExplorer.get$SourceImage()[0],l.maskedAreaImageX,l.maskedAreaImageY,l.maskedAreaWidth,l.maskedAreaHeight)}h.isFunction(this.options.onCrop)&&this.options.onCrop(k)};c.prototype.resetState=function(){this.imageExplorer.clearError();this._resetFileUploadField()};c.prototype.saveState=function(){if(this.imageExplorer.$container.hasClass("empty")){return}var k=this.imageExplorer.get$SourceImage();if(k.length){this.imageState={top:k.css("top"),left:k.css("left"),marginTop:k.css("margin-top"),marginLeft:k.css("margin-left"),zoom:e(".image-explorer-scale-slider").val()}}};c.prototype.restoreState=function(){if(this.imageExplorer.$container.hasClass("empty")||!this.imageState){return}var k=this.imageExplorer.get$SourceImage();if(k.length){this.imageExplorer.$scaleSlider.val(this.imageState.zoom).trigger("change");k.css({top:this.imageState.top,left:this.imageState.left,"margin-top":this.imageState.marginTop,"margin-left":this.imageState.marginLeft})}};c.prototype._onFileProcessed=function(m){if(m){var l=this.validateImage(m);var k=this;l.done(function(){if(!isNaN(k.options.maxImageDimension)){var n=k.validateImageResolution(m);n.done(function(p,o){k.setImageSrc(m)}).fail(function(p,o){k._onFileError(AJS.format("\u0412\u044b\u0431\u0440\u0430\u043d\u043d\u043e\u0435 \u0438\u0437\u043e\u0431\u0440\u0430\u0436\u0435\u043d\u0438\u0435 \u0438\u043c\u0435\u0435\u0442 \u0440\u0430\u0437\u043c\u0435\u0440 {0}px * {1}px. \u041c\u0430\u043a\u0441\u0438\u043c\u0430\u043b\u044c\u043d\u044b\u0439 \u0440\u0430\u0437\u043c\u0435\u0440 \u0434\u043e\u043b\u0436\u0435\u043d \u0431\u044b\u0442\u044c {2}px * {2}px",p,o,k.options.maxImageDimension))})}else{k.setImageSrc(m)}}).fail(function(){k._onFileError("\u0423\u0431\u0435\u0434\u0438\u0442\u0435\u0441\u044c, \u0447\u0442\u043e \u0432\u0430\u0448 \u0444\u0430\u0439\u043b \u044f\u0432\u043b\u044f\u0435\u0442\u0441\u044f \u0434\u0435\u0439\u0441\u0442\u0432\u0438\u0442\u0435\u043b\u044c\u043d\u044b\u043c \u0438\u0437\u043e\u0431\u0440\u0430\u0436\u0435\u043d\u0438\u0435\u043c \u0432 \u0444\u043e\u0440\u043c\u0430\u0442\u0435 JPEG, GIF \u0438\u043b\u0438 PNG \u0438 \u043f\u043e\u043f\u0440\u043e\u0431\u0443\u0439\u0442\u0435 \u0441\u043d\u043e\u0432\u0430.")})}else{this._onFileError()}};c.prototype.validateImage=function(m){var k=e.Deferred(),l=new Image();l.onerror=function(){k.reject()};l.onload=function(){k.resolve()};l.src=m;return k};c.prototype.setImageSrc=function(k){this._rotateImage(k,h.bind(function(l){this.imageExplorer.setImageSrc(l);h.isFunction(this.options.onImageUpload)&&this.options.onImageUpload(l);this._resetFileUploadField()},this))};c.prototype._rotateImage=function(l,m){if(!h.isObject(window.EXIF)){m(l);return}var k=new Image();k.onload=function(){window.EXIF.getData(k);var r=window.EXIF.getTag(k,"Orientation");if(h.isUndefined(r)){m(l);return}var q=k.width,n=k.height,p=document.createElement("canvas"),o=p.getContext("2d");if([5,6,7,8].indexOf(r)>-1){p.width=n;p.height=q}else{p.width=q;p.height=n}switch(r){case 2:o.transform(-1,0,0,1,q,0);break;case 3:o.transform(-1,0,0,-1,q,n);break;case 4:o.transform(1,0,0,-1,0,n);break;case 5:o.transform(0,1,1,0,0,0);break;case 6:o.transform(0,1,-1,0,n,0);break;case 7:o.transform(0,-1,-1,0,n,q);break;case 8:o.transform(0,-1,1,0,0,q);break;default:o.transform(1,0,0,1,0,0)}o.drawImage(k,0,0);m(p.toDataURL())};k.src=l};c.prototype.validateImageResolution=function(n){var k=e.Deferred(),m=new Image(),l=this;m.onload=function(){if(this.naturalWidth>l.options.maxImageDimension||this.naturalHeight>l.options.maxImageDimension){k.reject(this.naturalWidth,this.naturalHeight)}else{k.resolve(this.naturalWidth,this.naturalHeight)}};m.src=n;return k};c.prototype._onFilesError=function(l){if(l&&l.bySize&&l.bySize.length){var k=h.first(l.bySize);this._onFileError(AJS.format("\u0424\u0430\u0439\u043b \u00ab{0}\u00bb \u044f\u0432\u043b\u044f\u0435\u0442\u0441\u044f {1} \u0438 \u043f\u0440\u0435\u0432\u044b\u0448\u0430\u0435\u0442 \u043c\u0430\u043a\u0441\u0438\u043c\u0430\u043b\u044c\u043d\u043e \u0434\u043e\u043f\u0443\u0441\u0442\u0438\u043c\u044b\u0439 \u0440\u0430\u0437\u043c\u0435\u0440 {2}",d.abbreviateText(k.name,50),d.formatSizeInBytes(k.size),d.formatSizeInBytes(this.options.fileSizeLimit)))}else{this._onFileError()}};c.prototype._onFileError=function(k){AJS.log("onFileError",k);var m="\u041f\u0440\u0438 \u0437\u0430\u0433\u0440\u0443\u0437\u043a\u0435 \u0438\u0437\u043e\u0431\u0440\u0430\u0436\u0435\u043d\u0438\u044f \u043f\u0440\u043e\u0438\u0437\u043e\u0448\u043b\u0430 \u043e\u0448\u0438\u0431\u043a\u0430",l=k||"\u0423\u0431\u0435\u0434\u0438\u0442\u0435\u0441\u044c, \u0447\u0442\u043e \u0432\u0430\u0448 \u0444\u0430\u0439\u043b \u044f\u0432\u043b\u044f\u0435\u0442\u0441\u044f \u0434\u0435\u0439\u0441\u0442\u0432\u0438\u0442\u0435\u043b\u044c\u043d\u044b\u043c \u0438\u0437\u043e\u0431\u0440\u0430\u0436\u0435\u043d\u0438\u0435\u043c \u0432 \u0444\u043e\u0440\u043c\u0430\u0442\u0435 JPEG, GIF \u0438\u043b\u0438 PNG \u0438 \u043f\u043e\u043f\u0440\u043e\u0431\u0443\u0439\u0442\u0435 \u0441\u043d\u043e\u0432\u0430.";this.imageExplorer.showError(m,l);this._resetFileUploadField();h.isFunction(this.options.onImageUploadError)&&this.options.onImageUploadError(k)};c.prototype._resetFileUploadField=function(){var k=this.$container.find("#image-upload-and-crop-upload-field").prop("form");k&&k.reset()};c.prototype._onErrorReset=function(k){if(k){h.isFunction(this.options.onImageUpload)&&this.options.onImageUpload(k)}};return c});
}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.atlassian.confluence.plugins.confluence-user-profile:avatar-picker', location = 'avatar-picker/js/text-util.js' */
define("confluence-user-profile/avatar-picker/text-util",[],function(){return{formatSizeInBytes:function(d){var b=[" bytes","KB","MB","GB","TB","PB"],c=1024,a=0,e=b.length-1;d=(typeof d==="number")?d:parseInt(d,10);if(isNaN(d)){return""}while(d>=c&&a<e){d/=c;a++}d=Math.floor((d*10))/10;return d+b[a]},abbreviateText:function(f,a,e){if(typeof f!=="string"){return undefined}if(isNaN(a)||a<0||f.length<=a){return f}var c=(typeof e==="string")?e:"",b=f.length-a+c.length,d=Math.round(f.length/2);return f.substring(0,d-Math.ceil(b/2))+c+f.substring(d+Math.floor(b/2),f.length)}}});
}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.atlassian.confluence.plugins.confluence-user-profile:avatar-picker', location = 'avatar-picker/js/upload-interceptor.js' */
define("confluence-user-profile/avatar-picker/upload-interceptor",["jquery","underscore"],function(c,a){function b(d,e){return this.init.apply(this,arguments)}b.prototype.defaults={replacementEl:undefined,clientFileHandler:null};b.prototype.init=function(d,e){a.bindAll(this,"onSelectFile","onReplacementClick");this._$el=c(d);this.options=a.extend({},this.defaults,e);this._$el.on("change",this.onSelectFile);if(this.options.replacementEl){this._$replacement=c(this.options.replacementEl);this._$el.hide();if(c.browser&&c.browser.msie){if(!this._$replacement.is("label")){this._$replacement.hide();this._$el.show()}}else{this._$replacement.on("click",this.onReplacementClick)}}};b.prototype.onSelectFile=function(d){if(c(d.target).val()&&this.options.clientFileHandler){this.options.clientFileHandler.handleFiles(d.target.files,this._$el)}};b.prototype.onReplacementClick=function(d){d.preventDefault();this._$el.click()};b.prototype.destroy=function(){this._$el.off("change",this.onSelectFile);this._$replacement.off("click",this.onReplacementClick)};return b});
}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.atlassian.confluence.plugins.confluence-user-profile:avatar-picker', location = 'avatar-picker/js/avatar-picker-panel.js' */
define("confluence-user-profile/avatar-picker/avatar-picker-panel",["jquery","underscore","ajs","confluence-user-profile/avatar-picker/image-upload-and-crop"],function(c,b,a,e){function d(f){if(!e.isSupported()){a.messages.error({body:"This browser doesn't support AvatarPickerPanel."})}return this.init(f)}d.prototype.defaults={panel:null,saveButton:null,cancelButton:null,onCrop:function(){},onExpanded:function(){}};d.prototype.init=function(f){b.bindAll(this,"initPanelContent","_onImageUpload","_onImageUploadError","_toggleSaveButtonEnabled","_onUpdateDetails");this.options=c.extend(true,{},this.defaults,f);this._$panel=this.options.panel;this._$saveButton=this.options.saveButton;this.initPanelContent();this._toggleSaveButtonEnabled(false);this.imageUploadAndCrop=new e(this._$panel.find(".profile-pic-upload-and-crop-container"),{HiDPIMultiplier:1,onCrop:this._onUpdateDetails,onImageUpload:this._onImageUpload,onImageUploadError:this._onImageUploadError,fallbackUploadOptions:{uploadURL:a.Meta.get("context-path")+"/rest/user-profile/1.0/avatar/uploadFallback",uploadFieldName:"upload-logo-input",responseHandler:function(k,l){var j=c(k),i=j.find("#json-response");if(i.length){var h;try{h=JSON.parse(i.html())}catch(m){l.reject()}if(h&&h.src){l.resolve(a.Meta.get("context-path")+h.src)}else{l.reject(h&&h.errorMessages&&h.errorMessages[0])}}else{var g=j.find(".error-image + h2").text();g=g.replace(/; nested exception.*$/,".").replace(/(\d+) bytes/,function(n,o){return TextUtil.formatSizeInBytes(o)});l.reject(g)}},cancelTrigger:this._$saveButton.add(this.options.cancelButton)}});this._$saveButton.click(function(){this.imageUploadAndCrop.crop()}.bind(this));return this};d.prototype.initPanelContent=function(){this._$panel.append(Confluence.Templates.User.Avatar.Picker.imageUploadAndCrop({description:"JPG, GIF \u0438\u043b\u0438 PNG \u0444\u0430\u0439\u043b",fallbackDescription:"JPG, GIF \u0438\u043b\u0438 PNG \u0444\u0430\u0439\u043b"}));this._$message=this._$panel.find(".image-upload-and-crop-message")};d.prototype._onUpdateDetails=function(f){this.options.onCrop(f)};d.prototype._onImageUpload=function(){this._toggleExpanded(true);this._toggleSaveButtonEnabled(true)};d.prototype._onImageUploadError=function(){this._toggleExpanded(false);this._toggleSaveButtonEnabled(false)};d.prototype._toggleSaveButtonEnabled=function(f){if(f===null){f=this._$saveButton.attr("disabled")!==null}if(f){this._$saveButton.removeAttr("disabled")}else{this._$saveButton.attr("disabled","disabled")}};d.prototype.setMessage=function(f){this._$message.html(aui.message.error({content:f,closeable:false})).show()};d.prototype.hideMessage=function(){this._$message.hide()};d.prototype.getImageCropper=function(){return this.imageUploadAndCrop};d.prototype._toggleExpanded=function(f){this.options.onExpanded(f)};return d});
}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.atlassian.confluence.plugins.confluence-user-profile:avatar-picker', location = 'avatar-picker/js/avatar-picker-dialog.js' */
define("confluence-user-profile/avatar-picker/avatar-picker-dialog",["jquery","underscore","confluence-user-profile/avatar-picker/avatar-picker-panel"],function(b,a,d){function c(e){return this.init(e)}c.prototype.defaults={dialogTitle:"\u0417\u0430\u0433\u0440\u0443\u0437\u0438\u0442\u044c \u0438\u0437\u043e\u0431\u0440\u0430\u0436\u0435\u043d\u0438\u0435 \u043f\u0440\u043e\u0444\u0438\u043b\u044f",dialogOptions:{width:400,height:518,id:"personal-avatar-picker-dialog",closeOnOutsideClick:false},onCrop:function(){},trigger:null};c.prototype.init=function(e){a.bindAll(this,"initDialogContent","hide","show","cancel");this.options=b.extend(true,{},this.defaults,e);this._$dialog=new AJS.Dialog(this.options.dialogOptions);this.initDialogContent();if(this.options.trigger){this._$trigger=b(this.options.trigger);this._$trigger.click(a.bind(function(f){f.preventDefault();this.show()},this))}return this};c.prototype.initDialogContent=function(){this._$dialog.addHeader(this.options.dialogTitle).addPanel().addSubmit("\u0421\u043e\u0445\u0440\u0430\u043d\u0438\u0442\u044c").addCancel("\u041e\u0442\u043c\u0435\u043d\u0430",this.cancel);this._$saveButton=this._$dialog.getCurrentPanel().page.buttonpanel.find(".button-panel-submit-button");this._$cancelButton=this._$dialog.getCurrentPanel().page.buttonpanel.find(".button-panel-cancel-link");this.panel=new d({panel:this._$dialog.getCurrentPanel().body,saveButton:this._$saveButton,cancelButton:this._$cancelButton,onCrop:this.options.onCrop,onExpanded:function(e){b("#personal-avatar-picker-dialog").toggleClass("expanded",e)}})};c.prototype.hide=function(){this.panel.hideMessage();this._$dialog.hide();this.panel.getImageCropper().resetState()};c.prototype.cancel=function(){this.panel.getImageCropper().restoreState();this.hide()};c.prototype.setMessage=function(e){this.panel.setMessage(e)};c.prototype.show=function(){this.panel.getImageCropper().saveState();this._$dialog.show();b("#personal-avatar-picker-dialog .button-panel-submit-button").removeClass("button-panel-button").addClass("aui-button aui-button-primary")};return c});
}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.atlassian.confluence.plugins.confluence-onboarding:onboarding-flow-resources', location = 'modules/intro/intro-sequence-utils.js' */
define("confluence/ob/modules/intro/intro-sequence-utils",["jquery","underscore","confluence/ob/modules/intro-container/intro-container","confluence/ob/modules/intro-progress/intro-progress","confluence/ob/common/user","confluence/ob/common/test-evaluator"],function(c,i,k,a,f,h){h.resetTestingEvaluator();var d="#grow-ic-nav-container";var j="#grow-ic-content";var e=[{name:"video",title:"\u0414\u043e\u0431\u0440\u043e \u043f\u043e\u0436\u0430\u043b\u043e\u0432\u0430\u0442\u044c"},{name:"upload-avatar",title:"\u0417\u0430\u0433\u0440\u0443\u0437\u0438\u0442\u0435 \u0444\u043e\u0442\u043e\u0433\u0440\u0430\u0444\u0438\u044e"},{name:"create-space",title:"\u0421\u043e\u0437\u0434\u0430\u0442\u044c \u043f\u0440\u043e\u0441\u0442\u0440\u0430\u043d\u0441\u0442\u0432\u043e"},{name:"find-spaces",title:"\u041f\u043e\u0438\u0441\u043a \u0441\u043e\u0434\u0435\u0440\u0436\u0438\u043c\u043e\u0433\u043e"}];function b(){if(h.isTestingEvaluator()&&!f.hasCreateSpacePermission()){console.log("WARN: ignore testing evaluator flow because current user does not have create space permission")}var n=f.hasCreateSpacePermission()&&(h.isTestingEvaluator()||f.isAdmin()&&f.hasCreateSpacePermission()&&!f.isFirstSpaceCreated());var l=AJS.Meta.get("available-spaces-count");var m=false;if(l&&(parseInt(l)>0)){m=true}return i.filter(e,function(o){switch(o.name){case"create-space":return n;case"find-spaces":return !n&&m;default:return true}})}var g={};g.createProgressTracker=function(m){k.createIntroContainer({currentState:m});var l=a.createProgressTracker(b(),m);c(d).empty().append(l);return c(j).empty()};g.hasStep=function(l){return !!i.findWhere(b(),{name:l})};return g});
}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.atlassian.confluence.plugins.confluence-onboarding:onboarding-flow-resources', location = 'modules/intro/intro-find-spaces-sequence.js' */
define("confluence/ob/modules/intro/intro-find-spaces-sequence",["jquery","underscore","confluence/ob/common/promise","confluence/ob/modules/intro/intro-sequence-utils","confluence/ob/common/common-core","confluence/ob/common/bacon"],function(h,c,g,e,b,f){var d={getRelevant:function(){return h.get(AJS.contextPath()+"/rest/onboarding/1/space/relevant")},search:function(i){return h.get(AJS.contextPath()+"/rest/onboarding/1/space?query="+i)},followSpaces:function(i){return h.ajax({url:AJS.contextPath()+"/rest/onboarding/1/space/relevant",type:"PUT",data:JSON.stringify(i),contentType:"application/json"})}};var a=function(i){this.options=c.extend({},i);this.getRelevantSpacesPromise=e.hasStep("find-spaces")?d.getRelevant():h.Deferred().reject("No spaces found. Might be due to all pages being restricted.")};a.prototype.init=function(j,l){if(!e.hasStep("find-spaces")){return h.Deferred().reject()}var m=this;return g(function(H,N){var P=m.options.searchInputDebounceWaitMs||500;var L=1;var B=AJS.Meta.get("available-spaces-count");var V=!!B&&B>10;var u=V?6:8;var C=[];var x=h.Deferred();var ak=e.createProgressTracker("find-spaces");var o=h(Confluence.Templates.OB.findSpaces());var M=o.find(".intro-find-spaces-button-continue");var R=o.find("#find-spaces-search");var ah=o.find(".intro-find-spaces-search");var ae=o.find(".intro-find-spaces-search span.aui-iconfont-close-dialog");var ab=o.find(".selected-header");var X=o.find(".selected-header .arrow");var q=o.find(".selected-count");var n=o.find(".selected-spaces");var aj=o.find(".intro-find-spaces-relevant-spaces");var aa=o.find(".intro-find-spaces-button-spinner");var K=f.fromPromise(m.getRelevantSpacesPromise).toProperty();var r=aj.asEventStream("change",'input[type="checkbox"]',function(){return{key:this.name,selected:h(this).is(":checked")}});var I=n.asEventStream("click",".selected-space",function(){return h(this).attr("data-space-key")}).map(function(an){return{key:an,selected:false}});var D=r.merge(I).scan([],function(ao,an){return an.selected?ao.concat(an.key):c.without(ao,an.key)});var z=D.map(function(an){return an.length});var ai=R.asEventStream("input",function(){return h(this).val()});var w=ai.debounce(P).filter(Z);var S=f.combineWith(c.isEqual,ai,w).not();S.onValue(h.noop);var J=ai.map(function(an){return h.trim(an).length===0}).toProperty(true);var F=w.flatMapLatest(function(an){return f.fromPromise(d.search(an)).skipWhile(S)});var p=f.combineWith(al,F,D).sampledBy(F);var af=z.map(function(an){return an>=L});var t=M.asEventStream("click",function(){return true}).toProperty(false);var s=af.and(t.not());var O=ab.asEventStream("click",function(){return !n.is(":visible")});var ac=F.scan([],A);var U=f.combineWith(A,K,ac);var y=f.combineWith(am,U,D);var T=D.sampledBy(t).skip(1);var Y=f.combineWith(al,K,D);var E=J.skip(1).flatMap(function(an){return an?true:f.never()});var v=Y.sampledBy(E);var W=ae.asEventStream("click");var ad=f.mergeAll(r,I,W).map(true);s.not().assign(M,"prop","disabled");af.onValue(function(an){if(an){M.text("\u0417\u0430\u0432\u0435\u0440\u0448\u0438\u0442\u044c")}else{M.text("\u0412\u044b\u0431\u0440\u0430\u0442\u044c \u043f\u0440\u043e\u0441\u0442\u0440\u0430\u043d\u0441\u0442\u0432\u043e")}});W.onValue(function(){R.val("").trigger("input")});ad.onValue(function(){R.focus()});J.onValue(function(an){if(!an){aj.html("").spin()}ae.toggle(!an)});p.onValue(function(an){aj.spinStop();if(an.length>0){Q(aj,an)}else{aj.text("\u041d\u0435\u0442 \u0440\u0435\u0437\u0443\u043b\u044c\u0442\u0430\u0442\u043e\u0432.")}});z.onValue(function(an){q.text("("+an+")")});y.onValue(function(ao){var an=h(Confluence.Templates.OB.selectedSpaces({spaces:ao}));n.html(an)});O.assign(n,"toggle");O.not().assign(X,"toggleClass","arrow-down");O.assign(X,"toggleClass","arrow-up");I.onValue(function(an){h('div[data-space-key="'+an.key+'"] input').attr("checked",false)});K.onValue(function(an){if(!an||an.length===0){N()}else{C=c.take(an,u).map(function(ao){return ao.key});Q(aj,an)}});K.onError(N);F.onError(function(){aj.text("\u041d\u0435\u0442 \u0440\u0435\u0437\u0443\u043b\u044c\u0442\u0430\u0442\u043e\u0432.")});v.onValue(function(an){Q(aj,an)});T.onValue(function(ap){aa.spin();var ao=ap.length;var an=c.difference(ap,C).length;d.followSpaces(ap).done(function(){x.resolve({numberOfSpacesFollowed:ao,spacesPickedFromSearches:an})}).fail(function(aq){x.reject(aq)}).always(function(){H()})});ag();function ag(){ak.empty().append(o);aj.spin();m.getRelevantSpacesPromise.always(function(){aj.spinStop()});ah.add(ab).toggle(V);if(V){aj.css("min-height","330px")}G();k(F,V,O,x.promise(),K)}function G(){var an=13;h(document).on("keypress","input",function(ao){return ao.keyCode!==an})}function Z(an){return h.trim(an).length>0}function Q(an,aq){var ap=c.map(aq,function(at){var ar=at;ar.name=i(at.name);return ar});var ao=h(Confluence.Templates.OB.findSpaceItems({spaces:c.take(ap,u)}));an.html(ao)}function al(ao,an){return c.map(ao,function(ap){return c.extend(ap,{selected:c.contains(an,ap.key)})})}function am(ao,an){return c.filter(ao,function(ap){return c.contains(an,ap.key)})}function A(an,ao){return c.uniq(c.union(an,ao),false,function(ap){return ap.key})}});function i(n){var o=document.createElement("textarea");o.innerHTML=n;return o.value}function k(p,n,r,o,q){if(n){l.pushEvent(a.EVENTS.SEARCH_BAR_SHOWN)}else{l.pushEvent(a.EVENTS.SEARCH_BAR_HIDDEN)}p.onValue(function(t){var s=t.length;if(s<5){l.pushEvent(a.EVENTS.SEARCH_FOUND+"."+s)}else{l.pushEvent(a.EVENTS.SEARCH_FOUND_5_OR_MORE)}});p.onError(function(s){l.pushEvent(a.EVENTS.ERROR_SEARCH_FAILED,s)});r.onValue(function(s){if(s){l.pushEvent(a.EVENTS.SELECTED_OPEN)}else{l.pushEvent(a.EVENTS.SELECTED_CLOSE)}});o.done(function(s){if(s.numberOfSpacesFollowed<5){l.pushEvent(a.EVENTS.FOLLOWED_SPACES+"."+s.numberOfSpacesFollowed)}else{l.pushEvent(a.EVENTS.FOLLOWED_SPACES_5_OR_MORE)}if(n&&s.spacesPickedFromSearches<5){l.pushEvent(a.EVENTS.FOLLOWED_SEARCHED_SPACES+"."+s.spacesPickedFromSearches)}else{if(n){l.pushEvent(a.EVENTS.FOLLOWED_SEARCHED_SPACES_5_OR_MORE)}}}).fail(function(s){l.pushEvent(a.EVENTS.ERROR_SERVER_SAVE_FAILED,s)});q.onValue(function(s){if(!s||s.length===0){l.pushEvent(a.EVENTS.ERROR_LOAD_RELEVANT_SPACES_FAILED_NO_DATA)}else{l.pushEvent(a.EVENTS.RELEVANT_SPACES_LOADED,{spacesLoaded:s.length})}});q.onError(function(s){l.pushEvent(a.EVENTS.ERROR_LOAD_RELEVANT_SPACES_FAILED,s)})}};a.EVENTS={SEARCH_BAR_SHOWN:"search.shown",SEARCH_BAR_HIDDEN:"search.hidden",SEARCH_FOUND:"search.found",SEARCH_FOUND_5_OR_MORE:"search.found.5.or.more",FOLLOWED_SPACES:"followed.spaces",FOLLOWED_SPACES_5_OR_MORE:"followed.spaces.5.or.more",FOLLOWED_SEARCHED_SPACES:"followed.searched.spaces",FOLLOWED_SEARCHED_SPACES_5_OR_MORE:"followed.searched.spaces.5.or.more",RELEVANT_SPACES_LOADED:"relevant.spaces.loaded",SELECTED_OPEN:"selected.open",SELECTED_CLOSE:"selected.close",ERROR_SEARCH_FAILED:"error.search.failed",ERROR_SERVER_SAVE_FAILED:"error.server.save.failed",ERROR_LOAD_RELEVANT_SPACES_FAILED:"error.load.relevant.spaces.failed",ERROR_LOAD_RELEVANT_SPACES_FAILED_NO_DATA:"error.load.relevant.spaces.failed.no.data"};return a});
}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.atlassian.confluence.plugins.confluence-onboarding:onboarding-flow-resources', location = 'modules/intro/intro-video-sequence.js' */
define("confluence/ob/modules/intro/intro-video-sequence",["jquery","confluence/ob/common/promise","confluence/ob/common/youtube-player","confluence/ob/modules/intro/intro-sequence-utils","confluence/ob/common/user"],function(d,c,a,b,f){var e=function(g){};e.prototype.init=function(g,i){var h=this;return c(function(n,m){var k=b.createProgressTracker("video");function o(){i.pushEvent(e.EVENTS.VIDEO_FINISHED);l.find("#grow-intro-video-continue-button").removeClass("grow-intro-collapsed");l.find("#grow-intro-video-skip-button").addClass("grow-intro-collapsed")}function j(p,q){i.pushEvent(e.EVENTS.VIDEO_CLICKED+q.clickType)}var l=d(Confluence.Templates.OB.video({name:f.getFullName()}));l.find("#grow-intro-video-skip-button").click(function(){i.pushEvent(e.EVENTS.VIDEO_SKIP_BUTTON_CLICKED);h._sendVideoPlayedPercent(i);n("skip")});l.find("#grow-intro-video-continue-button").click(function(){i.pushEvent(e.EVENTS.VIDEO_CONTINUE_BUTTON_CLICKED);h._sendVideoPlayedPercent(i);n("watched")});k.empty().append(l);d(a).off(a.EVENT_FINISH).on(a.EVENT_FINISH,o).off(a.EVENT_CLICK).on(a.EVENT_CLICK,j);a.embedVideo("grow-intro-video-placeholder","09CuRQoJzB8",{width:560,height:315,autoplay:0,hl:f.getUserLocale()})})};e.prototype._sendVideoPlayedPercent=function(g){var i=a.getCurrentTime();var k=a.getDuration();if(k<0){g.pushEvent(e.EVENTS.VIDEO_NOT_SUPPORTED);return}var h=i/k*100;var j=e.EVENTS.VIDEO_PLAYED_TO;if(h<=20){j+="0.to.20"}else{if(h<=40){j+="21.to.40"}else{if(h<=60){j+="41.to.60"}else{if(h<=80){j+="61.to.80"}else{j+="81.to.100"}}}}j+=".percent";g.pushEvent(j,{currentTime:i,totalTime:k})};e.EVENTS={VIDEO_NOT_SUPPORTED:"intro.video.not.supported",VIDEO_CLICKED:"intro.video.clicked.",VIDEO_FINISHED:"intro.video.finished",VIDEO_PLAYED_TO:"intro.video.played.to.",VIDEO_CONTINUE_BUTTON_CLICKED:"intro.video.continue.button.clicked",VIDEO_SKIP_BUTTON_CLICKED:"intro.video.skip.button.clicked"};return e});
}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.atlassian.confluence.plugins.confluence-onboarding:onboarding-flow-resources', location = 'modules/intro/intro-create-space-sequence.js' */
define("confluence/ob/modules/intro/intro-create-space-sequence",["jquery","confluence/ob/common/promise","confluence/ob/common/page-utils","confluence/ob/modules/intro/space-creation","confluence/ob/common/storage/server-storage","confluence/ob/modules/intro/intro-sequence-utils"],function(f,e,g,b,a,c){var d=function(h){};d.prototype.init=function(h,i){return e(function(o,n){if(!c.hasStep("create-space")){n();return}function l(q){m.prop("disabled",q);p.prop("disabled",q)}var j=c.createProgressTracker("create-space");var k=f(Confluence.Templates.OB.createSpace());var m=k.find("#grow-intro-create-space");var p=k.find("#grow-intro-space-name");m.prop("disabled",true);p.on("keyup paste input",function(){var q=this.value;var r=f("#grow-intro-space-error");if(f.trim(q)===""){r.hide();m.prop("disabled",true);return}m.prop("disabled",false)});m.click(function(q){q.preventDefault();l(true);g.showLoadingIndicator();b.createSpace(p.val()).done(function(s){var r=s[0].key;a.setGlobal("is-first-space-created","true");g.createPageDraft(r).then(function(t){o({spaceKey:r,draftId:t})},function(t){i.pushEvent(d.EVENTS.CREATE_DRAFT_FAILED);n(t)})}).fail(function(r){i.pushEvent(d.EVENTS.CREATE_SPACES_FAILED);n(r)})});j.empty().append(k);p.focus()})};d.EVENTS={CREATE_SPACES_FAILED:"create.space.failed",CREATE_DRAFT_FAILED:"create.draft.failed"};return d});
}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.atlassian.confluence.plugins.confluence-onboarding:onboarding-flow-resources', location = 'modules/intro/intro-upload-avatar-sequence.js' */
define("confluence/ob/modules/intro/intro-upload-avatar-sequence",["jquery","confluence/ob/common/promise","confluence/ob/modules/intro/intro-sequence-utils","confluence-user-profile/avatar-picker/avatar-picker-panel"],function(d,c,b,f){var e=function(g){};e.prototype.init=function(g,h){return c(function(l,k){var j=b.createProgressTracker("upload-avatar");j.append(Confluence.Templates.OB.avatarUploadHolder());d(".uploader-buttons-container button").click(function(m){m.preventDefault()});j.find("button[data-action=skip]").click(function(){h.pushEvent(a.SKIP_CLICKED);k("skip")});var i=new f({panel:j.find(".avatar-cropper-container"),saveButton:j.find("button[data-action=save]"),onCrop:function(m){d("button[data-action=save]").prop("disabled",true);d(".grow-intro-avatar-button-spinner").spin();d.ajax({type:"POST",dataType:"json",contentType:"application/json",data:JSON.stringify({avatarDataURI:m}),url:AJS.Meta.get("context-path")+"/rest/user-profile/1.0/"+AJS.Meta.get("remote-user-key")+"/avatar/upload",success:function(n){h.pushEvent(a.SAVE_SUCCESS);l("uploaded")},error:function(n){d("button[data-action=save]").prop("disabled",false);h.pushEvent(a.SAVE_FAILED);i.setMessage("\u0412\u043e\u0437\u043d\u0438\u043a\u043b\u0430 \u043e\u0448\u0438\u0431\u043a\u0430 \u043f\u0440\u0438 \u043e\u0431\u043d\u043e\u0432\u043b\u0435\u043d\u0438\u0438 \u043f\u043e\u0434\u0440\u043e\u0431\u043d\u044b\u0445 \u0434\u0430\u043d\u043d\u044b\u0445 \u0430\u0432\u0430\u0442\u0430\u0440\u0430")}}).always(function(){d(".grow-intro-avatar-button-spinner").spinStop()})},onExpanded:function(){h.pushEvent(a.CHOOSE_FILE)}})})};var a={SAVE_FAILED:"intro.avatar.save.failed",SAVE_SUCCESS:"intro.avatar.save.success",CHOOSE_FILE:"intro.avatar.choose.file",SKIP_CLICKED:"intro.avatar.skip.clicked"};return e});
}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.atlassian.confluence.plugins.confluence-onboarding:onboarding-flow-resources', location = 'modules/intro/warm-editor-resources.js' */
define("confluence/ob/modules/intro/warm-editor-resources",["ajs","jquery"],function(a,d){var b=function(){var e=d.Deferred();var f=30000;setTimeout(function(){e.reject()},f);setTimeout(function(){c().fail(function(){e.reject()}).done(function(){var h,g;h=document.createElement("iframe");d.cookie("load-tutorial-flow","true",{path:"/"});h.src=a.contextPath()+"/pages/createpage.action?spaceKey=ds";h.width=0;h.height=0;h.style.visibility="hidden";d("body").append(h);g=h.contentWindow||h;d(g).load(function(){var i=g.AJS.Meta.get("content-id");g.Confluence.Editor.Drafts.discardDraft(i).always(function(){h.src="";setTimeout(function(){h.parentNode.removeChild(h)},0);d.cookie("load-tutorial-flow",null,{path:"/"});e.resolve()})})})},50);return e.promise()};function c(){var e=d.Deferred();d.ajax({url:a.contextPath()+"/rest/api/space?spaceKey=ds",success:function(f){if(f&&f.results&&f.results.length){e.resolve()}else{e.reject()}},error:function(){e.reject()}});return e.promise()}return b});
}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.atlassian.confluence.plugins.confluence-onboarding:onboarding-flow-resources', location = 'modules/intro-progress/intro-progress.js' */
define("confluence/ob/modules/intro-progress/intro-progress",["jquery"],function(b,a){var c={};c.createProgressTracker=function(d,e){var f=b(Confluence.Templates.OB.introProgress({steps:d}));f.find('li[data-step="'+e+'"]').addClass("grow-aui-progress-tracker-step-current");return f};return c});
}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.atlassian.confluence.plugins.confluence-onboarding:onboarding-flow-resources', location = 'modules/intro/space-creation.js' */
define("confluence/ob/modules/intro/space-creation",["jquery","confluence/ob/common/common-core","confluence/ob/common/space-utils"],function(d,b,a){var c={};c.createSpace=function(f){var e=d.Deferred();var g=a.generateSpaceKey(f);a.generateUniqueSpaceKey(g).done(function(h){a.createSpace(f,h).done(function(i){if(!d.isArray(i)){i=[i]}e.resolve(i)}).fail(function(i){e.reject(i)})}).fail(function(h){e.reject(h)});return e.promise()};return c});
}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.atlassian.confluence.plugins.confluence-onboarding:onboarding-flow-resources', location = 'modules/intro-container/intro-container.js' */
define("confluence/ob/modules/intro-container/intro-container",["jquery","confluence/ob/modules/intro-container/page-control"],function(c,b){var a={};a.createIntroContainer=function(e){if(c("#grow-main-old").length===0){b.hideAllElements();c("html").addClass("grow-html");c("#page").addClass("grow-page");c("body").addClass("aui-page-focused aui-page-focused-large");var d=Confluence.Templates.OB.introContainer(e);c("#main").attr("id","grow-main-old").hide().after(c(d))}else{c("#grow-nav-right").empty();c("#grow-nav-center").empty();c("#grow-question-text-txt").show();c("#main.grow-main").attr("currentstate",e.currentState)}};return a});
}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.atlassian.confluence.plugins.confluence-onboarding:onboarding-flow-resources', location = 'modules/intro-container/page-control.js' */
define("confluence/ob/modules/intro-container/page-control",["jquery"],function(b){var a={};a.hideAllElements=function(){b(".aui-header-primary .aui-nav").remove();b(".aui-header-secondary .aui-nav").remove()};return a});
}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.atlassian.confluence.plugins.confluence-onboarding:onboarding-flow-resources', location = 'modules/templates.soy' */
// This file was automatically generated from templates.soy.
// Please don't edit this file by hand.

/**
 * @fileoverview Templates in namespace Confluence.Templates.OB.
 */

if (typeof Confluence == 'undefined') { var Confluence = {}; }
if (typeof Confluence.Templates == 'undefined') { Confluence.Templates = {}; }
if (typeof Confluence.Templates.OB == 'undefined') { Confluence.Templates.OB = {}; }


Confluence.Templates.OB.welcomeScreen = function(opt_data, opt_ignored) {
  return '<h1>Welcome EFI</h1>';
};
if (goog.DEBUG) {
  Confluence.Templates.OB.welcomeScreen.soyTemplateName = 'Confluence.Templates.OB.welcomeScreen';
}


Confluence.Templates.OB.introContainer = function(opt_data, opt_ignored) {
  return '<div id="main" class="grow-main" currentState="' + soy.$$escapeHtml(opt_data.currentState) + '"><div class="aui-page-panel-content"><div><div id="grow-ic-nav-container"></div></div><div><div id="grow-ic-content"></div></div></div></div>';
};
if (goog.DEBUG) {
  Confluence.Templates.OB.introContainer.soyTemplateName = 'Confluence.Templates.OB.introContainer';
}


Confluence.Templates.OB.introProgress = function(opt_data, opt_ignored) {
  var output = '<ol class="grow-aui-progress-tracker">';
  var sList10 = opt_data.steps;
  var sListLen10 = sList10.length;
  for (var sIndex10 = 0; sIndex10 < sListLen10; sIndex10++) {
    var sData10 = sList10[sIndex10];
    output += '<li class="grow-aui-progress-tracker-step" data-step="' + soy.$$escapeHtml(sData10.name) + '"><span>' + soy.$$escapeHtml(sData10.title) + '</span></li>';
  }
  output += '</ol>';
  return output;
};
if (goog.DEBUG) {
  Confluence.Templates.OB.introProgress.soyTemplateName = 'Confluence.Templates.OB.introProgress';
}


Confluence.Templates.OB.video = function(opt_data, opt_ignored) {
  return '<div><h2>' + soy.$$escapeHtml(AJS.format('\u041f\u0440\u0438\u0432\u0435\u0442\u0441\u0442\u0432\u0443\u0435\u043c, {0}, \u0434\u043e\u0431\u0440\u043e \u043f\u043e\u0436\u0430\u043b\u043e\u0432\u0430\u0442\u044c \u0432 Confluence!',opt_data.name)) + '</h2><p class="grow-intro-gray-text">' + soy.$$escapeHtml('\u041e\u0442\u043a\u0438\u043d\u044c\u0442\u0435\u0441\u044c \u043d\u0430 \u0441\u043f\u0438\u043d\u043a\u0443 \u043a\u0440\u0435\u0441\u043b\u0430, \u0440\u0430\u0441\u0441\u043b\u0430\u0431\u044c\u0442\u0435\u0441\u044c \u0438 \u043f\u043e\u0437\u0432\u043e\u043b\u044c\u0442\u0435 \u043d\u0430\u043c \u043f\u043e\u0437\u043d\u0430\u043a\u043e\u043c\u0438\u0442\u044c \u0432\u0430\u0441 \u0441 \u043e\u0441\u043d\u043e\u0432\u0430\u043c\u0438.') + '</p><div class="grow-intro-video-container"><div id="grow-intro-video-placeholder"></div></div>' + aui.buttons.button({id: 'grow-intro-video-continue-button', type: 'primary', text: '\u041f\u0440\u043e\u0434\u043e\u043b\u0436\u0438\u0442\u044c', extraClasses: 'grow-intro-collapsed'}) + aui.buttons.button({id: 'grow-intro-video-skip-button', type: 'link', text: '\u041d\u0435\u0442 \u043d\u0430\u0443\u0448\u043d\u0438\u043a\u043e\u0432? \u041f\u0440\u043e\u043f\u0443\u0441\u0442\u0438\u0442\u044c'}) + '</div>';
};
if (goog.DEBUG) {
  Confluence.Templates.OB.video.soyTemplateName = 'Confluence.Templates.OB.video';
}


Confluence.Templates.OB.createSpace = function(opt_data, opt_ignored) {
  return '<div><div class="grow-intro-image" id="grow-intro-space-image" /><h2>' + soy.$$escapeHtml('\u0421\u043e\u0437\u0434\u0430\u043d\u0438\u0435 \u043f\u0440\u043e\u0441\u0442\u0440\u0430\u043d\u0441\u0442\u0432\u0430 \u0434\u043b\u044f \u0441\u043e\u0445\u0440\u0430\u043d\u0435\u043d\u0438\u044f \u0440\u0430\u0431\u043e\u0442\u044b') + '</h2><p class="grow-intro-gray-text grow-intro-space-description">' + soy.$$escapeHtml('\u041d\u0430\u0447\u043d\u0438\u0442\u0435 \u0441 \u043f\u0440\u043e\u0441\u0442\u0440\u0430\u043d\u0441\u0442\u0432\u0430 \u0434\u043b\u044f \u0433\u0440\u0443\u043f\u043f\u044b \u0438\u043b\u0438 \u043f\u0440\u043e\u0435\u043a\u0442\u0430. \u0412 \u0434\u0430\u043b\u044c\u043d\u0435\u0439\u0448\u0435\u043c \u043c\u043e\u0436\u043d\u043e \u0431\u0443\u0434\u0435\u0442 \u0441\u043e\u0437\u0434\u0430\u0442\u044c \u0441\u0442\u043e\u043b\u044c\u043a\u043e \u043f\u0440\u043e\u0441\u0442\u0440\u0430\u043d\u0441\u0442\u0432, \u0441\u043a\u043e\u043b\u044c\u043a\u043e \u043f\u043e\u0442\u0440\u0435\u0431\u0443\u0435\u0442\u0441\u044f.') + '</p>' + aui.form.form({action: '#', method: 'post', extraClasses: 'grow-intro-spaces', content: '' + aui.form.textField({id: 'grow-intro-space-name', extraAttributes: 'title="space name"', name: 'space name', descriptionContent: '<div id="grow-intro-space-error" class="error"></div>', labelContent: '\u0418\u043c\u044f \u043f\u0440\u043e\u0441\u0442\u0440\u0430\u043d\u0441\u0442\u0432\u0430', placeholderText: '\u043d\u0430\u043f\u0440\u0438\u043c\u0435\u0440, \xab\u0420\u0430\u0437\u0440\u0430\u0431\u043e\u0442\u043a\u0430 \u043f\u0440\u043e\u0434\u0443\u043a\u0442\u0430\xbb'}) + aui.form.buttons({content: '' + aui.buttons.button({id: 'grow-intro-create-space', type: 'primary', text: '\u041f\u0440\u043e\u0434\u043e\u043b\u0436\u0438\u0442\u044c'})})}) + '</div>';
};
if (goog.DEBUG) {
  Confluence.Templates.OB.createSpace.soyTemplateName = 'Confluence.Templates.OB.createSpace';
}


Confluence.Templates.OB.avatarUploadHolder = function(opt_data, opt_ignored) {
  return '<h2>' + soy.$$escapeHtml('\u0417\u0430\u0433\u0440\u0443\u0437\u0438\u0442\u0435 \u0444\u043e\u0442\u043e\u0433\u0440\u0430\u0444\u0438\u044e, \u0447\u0442\u043e\u0431\u044b \u0434\u0440\u0443\u0433\u0438\u0435 \u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u0435\u043b\u0438 \u043c\u043e\u0433\u043b\u0438 \u0432\u0430\u0441 \u0443\u0437\u043d\u0430\u0442\u044c') + '</h2><div class="avatar-picker-container"><div class="avatar-cropper-container"></div>' + aui.form.form({extraClasses: 'uploader-buttons-container', content: '<div class="grow-intro-avatar-button-spinner"></div>' + aui.buttons.button({type: 'primary', extraAttributes: 'data-action="save"', text: '\u0421\u043e\u0445\u0440\u0430\u043d\u0438\u0442\u044c'}) + aui.buttons.button({type: 'link', extraAttributes: 'data-action="skip"', text: '\u041f\u0440\u043e\u043f\u0443\u0441\u0442\u0438\u0442\u044c'})}) + '</div>';
};
if (goog.DEBUG) {
  Confluence.Templates.OB.avatarUploadHolder.soyTemplateName = 'Confluence.Templates.OB.avatarUploadHolder';
}


Confluence.Templates.OB.findSpaces = function(opt_data, opt_ignored) {
  return '<div id="intro-find-spaces-container"><h2 class="intro-screen-title">' + soy.$$escapeHtml('\u041e\u0442\u0441\u043b\u0435\u0436\u0438\u0432\u0430\u0442\u044c \u043d\u0435\u0441\u043a\u043e\u043b\u044c\u043a\u0438\u0445 \u043f\u0440\u043e\u0441\u0442\u0440\u0430\u043d\u0441\u0442\u0432') + '</h2><div class="find-spaces-image"></div><p class="grow-intro-find-spaces-space-description">' + soy.$$escapeHtml('\u041f\u0440\u0438 \u043e\u0442\u0441\u043b\u0435\u0436\u0438\u0432\u0430\u043d\u0438\u0438 \u043f\u0440\u043e\u0441\u0442\u0440\u0430\u043d\u0441\u0442\u0432 \u0432\u044b \u043f\u043e\u043b\u0443\u0447\u0430\u0435\u0442\u0435 \u0443\u0432\u0435\u0434\u043e\u043c\u043b\u0435\u043d\u0438\u044f \u043e\u0431\u043e \u0432\u0441\u0435\u0445 \u0432\u043d\u0435\u0441\u0435\u043d\u043d\u044b\u0445 \u0438\u0437\u043c\u0435\u043d\u0435\u043d\u0438\u044f\u0445.') + '</p><div class="intro-find-spaces-search"><form class="aui"><input id="find-spaces-search" class="text long-field find-spaces-search" type="text" name="find-spaces-search" autocomplete="off" placeholder="' + soy.$$escapeHtml('\u041f\u043e\u0438\u0441\u043a \u0434\u0440\u0443\u0433\u0438\u0445 \u043f\u0440\u043e\u0441\u0442\u0440\u0430\u043d\u0441\u0442\u0432') + '"><span class="aui-icon aui-icon-small aui-iconfont-search"></span><span class="aui-icon aui-icon-small aui-iconfont-close-dialog"></span></form></div><div class="intro-find-spaces-relevant-spaces"></div><div class="intro-find-spaces-selected"><div class="selected-header"><div class="text"><span class="selected-text">' + soy.$$escapeHtml('\u0412\u044b\u0431\u0440\u0430\u043d\u043e') + '</span><span class="selected-count">(0)</span><hr></div><div class="arrow arrow-down"></div></div><div class="selected-spaces"></div></div><div class="intro-find-spaces-button"><div class="intro-find-spaces-button-spinner"></div>' + aui.buttons.button({type: 'primary', extraAttributes: 'disabled', text: '\u0412\u044b\u0431\u0440\u0430\u0442\u044c \u043f\u0440\u043e\u0441\u0442\u0440\u0430\u043d\u0441\u0442\u0432\u043e', extraClasses: 'intro-find-spaces-button-continue'}) + '</div></div>';
};
if (goog.DEBUG) {
  Confluence.Templates.OB.findSpaces.soyTemplateName = 'Confluence.Templates.OB.findSpaces';
}


Confluence.Templates.OB.selectedSpaces = function(opt_data, opt_ignored) {
  var output = '';
  var spaceList94 = opt_data.spaces;
  var spaceListLen94 = spaceList94.length;
  for (var spaceIndex94 = 0; spaceIndex94 < spaceListLen94; spaceIndex94++) {
    var spaceData94 = spaceList94[spaceIndex94];
    output += '<div class="selected-space" data-space-key="' + soy.$$escapeHtml(spaceData94.key) + '"><div class="space-icon"><img class="space-icon" src="' + soy.$$escapeHtml(spaceData94.icon.path) + '"></div><div class="space-details">' + soy.$$escapeHtml(spaceData94.name) + '</div><div class="aui-icon aui-icon-small aui-iconfont-remove-label"></div></div>';
  }
  return output;
};
if (goog.DEBUG) {
  Confluence.Templates.OB.selectedSpaces.soyTemplateName = 'Confluence.Templates.OB.selectedSpaces';
}


Confluence.Templates.OB.findSpaceItems = function(opt_data, opt_ignored) {
  var output = '';
  var spaceList104 = opt_data.spaces;
  var spaceListLen104 = spaceList104.length;
  for (var spaceIndex104 = 0; spaceIndex104 < spaceListLen104; spaceIndex104++) {
    var spaceData104 = spaceList104[spaceIndex104];
    output += '<label><div class="intro-find-spaces-space" data-space-key="' + soy.$$escapeHtml(spaceData104.key) + '"><div class="space-icon"><img class="space-icon" src="' + soy.$$escapeHtml(spaceData104.icon.path) + '"></div><div class="space-details">' + soy.$$escapeHtml(spaceData104.name) + '</div><div class="space-checkbox">' + aui.form.input({type: 'checkbox', id: spaceData104.key, isChecked: spaceData104.selected}) + '</div></div></label>';
  }
  return output;
};
if (goog.DEBUG) {
  Confluence.Templates.OB.findSpaceItems.soyTemplateName = 'Confluence.Templates.OB.findSpaceItems';
}

}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.atlassian.confluence.plugins.confluence-onboarding:onboarding-flow-resources', location = 'flow/main/intro-flow.js' */
define("confluence/ob/flow/main/intro-flow",["jquery","ajs","confluence/ob/common/common-core","confluence/ob/modules/intro/intro-video-sequence","confluence/ob/modules/intro/intro-create-space-sequence","confluence/ob/modules/intro/intro-upload-avatar-sequence","confluence/ob/modules/intro/intro-find-spaces-sequence","confluence/ob/modules/intro/intro-sequence-utils","confluence/ob/modules/intro/warm-editor-resources","confluence/ob/flow/controller/session-progress-tracker"],function(e,h,d,a,b,g,l,i,k,c){var j=require("confluence/ob/common/test-evaluator");"use strict";return function f(n){var r=q();function q(){try{return k()}catch(t){return e.when()}}function p(t){e.when(n(),r).always(function(){sessionStorage.setItem("created-space-key",t.spaceKey);c.setCurrentFlowSequence("tutorialFlow","editorTour");window.location.href=[window.location.protocol,"//",window.location.host,h.contextPath(),"/pages/resumedraft.action?draftId=",t.draftId].join("")})}function s(){n().then(function(){window.location.href=[window.location.protocol,"//",window.location.host,h.contextPath()+"/dashboard.action"].join("")})}function m(){if(i.hasStep("create-space")){return"createSpace"}else{if(i.hasStep("find-spaces")){return"findSpaces"}else{s()}}}var o={video:{instance:new a(),resolve:"uploadAvatar"},uploadAvatar:{instance:new g(),resolve:m,reject:m},findSpaces:{instance:new l(),resolve:s,reject:s},createSpace:{instance:new b(),resolve:p,reject:s}};return{key:"introWorkflow",start:"video",sequences:o}}});
}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.atlassian.confluence.plugins.confluence-onboarding:onboarding-flow-resources', location = 'flow/controller/session-progress-tracker.js' */
define("confluence/ob/flow/controller/session-progress-tracker",["jquery"],function(c){function b(e){return"onboarding-state:"+e}function d(e,f){var g=c.Deferred();g.resolve(sessionStorage.setItem(e,f));return g.promise()}function a(e){var f=c.Deferred();f.resolve(sessionStorage.getItem(e));return f.promise()}return{completeFlow:function(e){c.cookie("load-tutorial-flow",null,{path:"/"});return d(b(e),"__complete__")},setCurrentFlowSequence:function(e,f){c.cookie("load-tutorial-flow","true",{path:"/"});return d(b(e),f)},getCurrentFlowSequence:function(e){return a(b(e))}}});
}catch(e){WRMCB(e)};