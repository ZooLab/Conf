WRMCB=function(e){var c=console;if(c&&c.log&&c.error){c.log('Error running batched script.');c.error(e);}}
;
try {
/* module-key = 'com.atlassian.confluence.plugins.confluence-user-profile:avatar-picker', location = 'avatar-picker/js/exif.js' */
(function(){var k=false;var m=this;var d=function(v){if(v instanceof d){return v}if(!(this instanceof d)){return new d(v)}this.EXIFwrapped=v};if(typeof exports!=="undefined"){if(typeof module!=="undefined"&&module.exports){exports=module.exports=d}exports.EXIF=d}else{m.EXIF=d}var r=d.Tags={36864:"ExifVersion",40960:"FlashpixVersion",40961:"ColorSpace",40962:"PixelXDimension",40963:"PixelYDimension",37121:"ComponentsConfiguration",37122:"CompressedBitsPerPixel",37500:"MakerNote",37510:"UserComment",40964:"RelatedSoundFile",36867:"DateTimeOriginal",36868:"DateTimeDigitized",37520:"SubsecTime",37521:"SubsecTimeOriginal",37522:"SubsecTimeDigitized",33434:"ExposureTime",33437:"FNumber",34850:"ExposureProgram",34852:"SpectralSensitivity",34855:"ISOSpeedRatings",34856:"OECF",37377:"ShutterSpeedValue",37378:"ApertureValue",37379:"BrightnessValue",37380:"ExposureBias",37381:"MaxApertureValue",37382:"SubjectDistance",37383:"MeteringMode",37384:"LightSource",37385:"Flash",37396:"SubjectArea",37386:"FocalLength",41483:"FlashEnergy",41484:"SpatialFrequencyResponse",41486:"FocalPlaneXResolution",41487:"FocalPlaneYResolution",41488:"FocalPlaneResolutionUnit",41492:"SubjectLocation",41493:"ExposureIndex",41495:"SensingMethod",41728:"FileSource",41729:"SceneType",41730:"CFAPattern",41985:"CustomRendered",41986:"ExposureMode",41987:"WhiteBalance",41988:"DigitalZoomRation",41989:"FocalLengthIn35mmFilm",41990:"SceneCaptureType",41991:"GainControl",41992:"Contrast",41993:"Saturation",41994:"Sharpness",41995:"DeviceSettingDescription",41996:"SubjectDistanceRange",40965:"InteroperabilityIFDPointer",42016:"ImageUniqueID"};var u=d.TiffTags={256:"ImageWidth",257:"ImageHeight",34665:"ExifIFDPointer",34853:"GPSInfoIFDPointer",40965:"InteroperabilityIFDPointer",258:"BitsPerSample",259:"Compression",262:"PhotometricInterpretation",274:"Orientation",277:"SamplesPerPixel",284:"PlanarConfiguration",530:"YCbCrSubSampling",531:"YCbCrPositioning",282:"XResolution",283:"YResolution",296:"ResolutionUnit",273:"StripOffsets",278:"RowsPerStrip",279:"StripByteCounts",513:"JPEGInterchangeFormat",514:"JPEGInterchangeFormatLength",301:"TransferFunction",318:"WhitePoint",319:"PrimaryChromaticities",529:"YCbCrCoefficients",532:"ReferenceBlackWhite",306:"DateTime",270:"ImageDescription",271:"Make",272:"Model",305:"Software",315:"Artist",33432:"Copyright"};var j=d.GPSTags={0:"GPSVersionID",1:"GPSLatitudeRef",2:"GPSLatitude",3:"GPSLongitudeRef",4:"GPSLongitude",5:"GPSAltitudeRef",6:"GPSAltitude",7:"GPSTimeStamp",8:"GPSSatellites",9:"GPSStatus",10:"GPSMeasureMode",11:"GPSDOP",12:"GPSSpeedRef",13:"GPSSpeed",14:"GPSTrackRef",15:"GPSTrack",16:"GPSImgDirectionRef",17:"GPSImgDirection",18:"GPSMapDatum",19:"GPSDestLatitudeRef",20:"GPSDestLatitude",21:"GPSDestLongitudeRef",22:"GPSDestLongitude",23:"GPSDestBearingRef",24:"GPSDestBearing",25:"GPSDestDistanceRef",26:"GPSDestDistance",27:"GPSProcessingMethod",28:"GPSAreaInformation",29:"GPSDateStamp",30:"GPSDifferential"};var h=d.StringValues={ExposureProgram:{0:"Not defined",1:"Manual",2:"Normal program",3:"Aperture priority",4:"Shutter priority",5:"Creative program",6:"Action program",7:"Portrait mode",8:"Landscape mode"},MeteringMode:{0:"Unknown",1:"Average",2:"CenterWeightedAverage",3:"Spot",4:"MultiSpot",5:"Pattern",6:"Partial",255:"Other"},LightSource:{0:"Unknown",1:"Daylight",2:"Fluorescent",3:"Tungsten (incandescent light)",4:"Flash",9:"Fine weather",10:"Cloudy weather",11:"Shade",12:"Daylight fluorescent (D 5700 - 7100K)",13:"Day white fluorescent (N 4600 - 5400K)",14:"Cool white fluorescent (W 3900 - 4500K)",15:"White fluorescent (WW 3200 - 3700K)",17:"Standard light A",18:"Standard light B",19:"Standard light C",20:"D55",21:"D65",22:"D75",23:"D50",24:"ISO studio tungsten",255:"Other"},Flash:{0:"Flash did not fire",1:"Flash fired",5:"Strobe return light not detected",7:"Strobe return light detected",9:"Flash fired, compulsory flash mode",13:"Flash fired, compulsory flash mode, return light not detected",15:"Flash fired, compulsory flash mode, return light detected",16:"Flash did not fire, compulsory flash mode",24:"Flash did not fire, auto mode",25:"Flash fired, auto mode",29:"Flash fired, auto mode, return light not detected",31:"Flash fired, auto mode, return light detected",32:"No flash function",65:"Flash fired, red-eye reduction mode",69:"Flash fired, red-eye reduction mode, return light not detected",71:"Flash fired, red-eye reduction mode, return light detected",73:"Flash fired, compulsory flash mode, red-eye reduction mode",77:"Flash fired, compulsory flash mode, red-eye reduction mode, return light not detected",79:"Flash fired, compulsory flash mode, red-eye reduction mode, return light detected",89:"Flash fired, auto mode, red-eye reduction mode",93:"Flash fired, auto mode, return light not detected, red-eye reduction mode",95:"Flash fired, auto mode, return light detected, red-eye reduction mode"},SensingMethod:{1:"Not defined",2:"One-chip color area sensor",3:"Two-chip color area sensor",4:"Three-chip color area sensor",5:"Color sequential area sensor",7:"Trilinear sensor",8:"Color sequential linear sensor"},SceneCaptureType:{0:"Standard",1:"Landscape",2:"Portrait",3:"Night scene"},SceneType:{1:"Directly photographed"},CustomRendered:{0:"Normal process",1:"Custom process"},WhiteBalance:{0:"Auto white balance",1:"Manual white balance"},GainControl:{0:"None",1:"Low gain up",2:"High gain up",3:"Low gain down",4:"High gain down"},Contrast:{0:"Normal",1:"Soft",2:"Hard"},Saturation:{0:"Normal",1:"Low saturation",2:"High saturation"},Sharpness:{0:"Normal",1:"Soft",2:"Hard"},SubjectDistanceRange:{0:"Unknown",1:"Macro",2:"Close view",3:"Distant view"},FileSource:{3:"DSC"},Components:{0:"",1:"Y",2:"Cb",3:"Cr",4:"R",5:"G",6:"B"}};function o(v,x,w){if(v.addEventListener){v.addEventListener(x,w,false)}else{if(v.attachEvent){v.attachEvent("on"+x,w)}}}function g(v){return !!(v.exifdata)}function c(y,B){B=B||y.match(/^data\:([^\;]+)\;base64,/mi)[1]||"";y=y.replace(/^data\:([^\;]+)\;base64,/gmi,"");var A=atob(y);var v=A.length;var x=new ArrayBuffer(v);var w=new Uint8Array(x);for(var z=0;z<v;z++){w[z]=A.charCodeAt(z)}return x}function s(w,x){var v=new XMLHttpRequest();v.open("GET",w,true);v.responseType="blob";v.onload=function(y){if(this.status==200||this.status===0){x(this.response)}};v.send()}function b(w,A){function y(D){var C=f(D);var B=e(D);w.exifdata=C||{};w.iptcdata=B||{};if(A){A.call(w)}}if(w.src){if(/^data\:/i.test(w.src)){var z=c(w.src);y(z)}else{if(/^blob\:/i.test(w.src)){var v=new FileReader();v.onload=function(B){y(B.target.result)};s(w.src,function(B){v.readAsArrayBuffer(B)})}else{var x=new XMLHttpRequest();x.onload=function(){if(this.status==200||this.status===0){y(x.response)}else{throw"Could not load image"}x=null};x.open("GET",w.src,true);x.responseType="arraybuffer";x.send(null)}}}else{if(window.FileReader&&(w instanceof window.Blob||w instanceof window.File)){var v=new FileReader();v.onload=function(B){if(k){console.log("Got file of length "+B.target.result.byteLength)}y(B.target.result)};v.readAsArrayBuffer(w)}}}function f(w){var z=new DataView(w);if(k){console.log("Got file of length "+w.byteLength)}if((z.getUint8(0)!=255)||(z.getUint8(1)!=216)){if(k){console.log("Not a valid JPEG")}return false}var y=2,x=w.byteLength,v;while(y<x){if(z.getUint8(y)!=255){if(k){console.log("Not a valid marker at offset "+y+", found: "+z.getUint8(y))}return false}v=z.getUint8(y+1);if(k){console.log(v)}if(v==225){if(k){console.log("Found 0xFFE1 marker")}return q(z,y+4,z.getUint16(y+2)-2)}else{y+=2+z.getUint16(y+2)}}}function e(z){var C=new DataView(z);if(k){console.log("Got file of length "+z.byteLength)}if((C.getUint8(0)!=255)||(C.getUint8(1)!=216)){if(k){console.log("Not a valid JPEG")}return false}var B=2,A=z.byteLength;var w=function(E,D){return(E.getUint8(D)===56&&E.getUint8(D+1)===66&&E.getUint8(D+2)===73&&E.getUint8(D+3)===77&&E.getUint8(D+4)===4&&E.getUint8(D+5)===4)};while(B<A){if(w(C,B)){var y=C.getUint8(B+7);if(y%2!==0){y+=1}if(y===0){y=4}var v=B+8+y;var x=C.getUint16(B+6+y);return t(z,v,x);break}B++}}var a={120:"caption",110:"credit",25:"keywords",55:"dateCreated",80:"byline",85:"bylineTitle",122:"captionWriter",105:"headline",116:"copyright",15:"category"};function t(z,C,B){var D=new DataView(z);var A={};var w,F,v,E,x;var y=C;while(y<C+B){if(D.getUint8(y)===28&&D.getUint8(y+1)===2){E=D.getUint8(y+2);if(E in a){v=D.getInt16(y+3);x=v+5;F=a[E];w=l(D,y+5,v);if(A.hasOwnProperty(F)){if(A[F] instanceof Array){A[F].push(w)}else{A[F]=[A[F],w]}}else{A[F]=w}}}y++}return A}function p(v,B,D,A,x){var y=v.getUint16(D,!x),E={},z,C,w;for(w=0;w<y;w++){z=D+w*12+2;C=A[v.getUint16(z,!x)];if(!C&&k){console.log("Unknown tag: "+v.getUint16(z,!x))}E[C]=i(v,z,B,D,x)}return E}function i(A,E,H,I,C){var D=A.getUint16(E+2,!C),G=A.getUint32(E+4,!C),w=A.getUint32(E+8,!C)+H,B,F,z,y,v,x;switch(D){case 1:case 7:if(G==1){return A.getUint8(E+8,!C)}else{B=G>4?w:(E+8);F=[];for(y=0;y<G;y++){F[y]=A.getUint8(B+y)}return F}case 2:B=G>4?w:(E+8);return l(A,B,G-1);case 3:if(G==1){return A.getUint16(E+8,!C)}else{B=G>2?w:(E+8);F=[];for(y=0;y<G;y++){F[y]=A.getUint16(B+2*y,!C)}return F}case 4:if(G==1){return A.getUint32(E+8,!C)}else{F=[];for(y=0;y<G;y++){F[y]=A.getUint32(w+4*y,!C)}return F}case 5:if(G==1){v=A.getUint32(w,!C);x=A.getUint32(w+4,!C);z=new Number(v/x);z.numerator=v;z.denominator=x;return z}else{F=[];for(y=0;y<G;y++){v=A.getUint32(w+8*y,!C);x=A.getUint32(w+4+8*y,!C);F[y]=new Number(v/x);F[y].numerator=v;F[y].denominator=x}return F}case 9:if(G==1){return A.getInt32(E+8,!C)}else{F=[];for(y=0;y<G;y++){F[y]=A.getInt32(w+4*y,!C)}return F}case 10:if(G==1){return A.getInt32(w,!C)/A.getInt32(w+4,!C)}else{F=[];for(y=0;y<G;y++){F[y]=A.getInt32(w+8*y,!C)/A.getInt32(w+4+8*y,!C)}return F}}}function l(w,y,x){var v="";for(n=y;n<y+x;n++){v+=String.fromCharCode(w.getUint8(n))}return v}function q(z,w){if(l(z,w,4)!="Exif"){if(k){console.log("Not valid EXIF data! "+l(z,w,4))}return false}var A,C,D,y,x,B=w+6;if(z.getUint16(B)==18761){A=false}else{if(z.getUint16(B)==19789){A=true}else{if(k){console.log("Not valid TIFF data! (no 0x4949 or 0x4D4D)")}return false}}if(z.getUint16(B+2,!A)!=42){if(k){console.log("Not valid TIFF data! (no 0x002A)")}return false}var v=z.getUint32(B+4,!A);if(v<8){if(k){console.log("Not valid TIFF data! (First offset less than 8)",z.getUint32(B+4,!A))}return false}C=p(z,B,B+v,u,A);if(C.ExifIFDPointer){y=p(z,B,B+C.ExifIFDPointer,r,A);for(D in y){switch(D){case"LightSource":case"Flash":case"MeteringMode":case"ExposureProgram":case"SensingMethod":case"SceneCaptureType":case"SceneType":case"CustomRendered":case"WhiteBalance":case"GainControl":case"Contrast":case"Saturation":case"Sharpness":case"SubjectDistanceRange":case"FileSource":y[D]=h[D][y[D]];break;case"ExifVersion":case"FlashpixVersion":y[D]=String.fromCharCode(y[D][0],y[D][1],y[D][2],y[D][3]);break;case"ComponentsConfiguration":y[D]=h.Components[y[D][0]]+h.Components[y[D][1]]+h.Components[y[D][2]]+h.Components[y[D][3]];break}C[D]=y[D]}}if(C.GPSInfoIFDPointer){x=p(z,B,B+C.GPSInfoIFDPointer,j,A);for(D in x){switch(D){case"GPSVersionID":x[D]=x[D][0]+"."+x[D][1]+"."+x[D][2]+"."+x[D][3];break}C[D]=x[D]}}return C}d.getData=function(v,w){if((v instanceof Image||v instanceof HTMLImageElement)&&!v.complete){return false}if(!g(v)){b(v,w)}else{if(w){w.call(v)}}return true};d.getTag=function(w,v){if(!g(w)){return}return w.exifdata[v]};d.getIptcTag=function(w,v){if(!g(w)){return}return w.iptcdata[v]};d.getAllTags=function(w){if(!g(w)){return{}}var v,y=w.exifdata,x={};for(v in y){if(y.hasOwnProperty(v)){x[v]=y[v]}}return x};d.getAllIptcTags=function(w){if(!g(w)){return{}}var v,y=w.iptcdata,x={};for(v in y){if(y.hasOwnProperty(v)){x[v]=y[v]}}return x};d.pretty=function(w){if(!g(w)){return""}var v,y=w.exifdata,x="";for(v in y){if(y.hasOwnProperty(v)){if(typeof y[v]=="object"){if(y[v] instanceof Number){x+=v+" : "+y[v]+" ["+y[v].numerator+"/"+y[v].denominator+"]\r\n"}else{x+=v+" : ["+y[v].length+" values]\r\n"}}else{x+=v+" : "+y[v]+"\r\n"}}}return x};d.readFromBinaryFile=function(v){return f(v)};if(typeof define==="function"&&define.amd){define("exif-js",[],function(){return d})}}.call(this));
}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.atlassian.confluence.plugins.confluence-user-profile:avatar-picker', location = 'avatar-picker/templates/image-explorer.soy' */
// This file was automatically generated from image-explorer.soy.
// Please don't edit this file by hand.

/**
 * @fileoverview Templates in namespace Confluence.Templates.User.Avatar.Picker.
 */

if (typeof Confluence == 'undefined') { var Confluence = {}; }
if (typeof Confluence.Templates == 'undefined') { Confluence.Templates = {}; }
if (typeof Confluence.Templates.User == 'undefined') { Confluence.Templates.User = {}; }
if (typeof Confluence.Templates.User.Avatar == 'undefined') { Confluence.Templates.User.Avatar = {}; }
if (typeof Confluence.Templates.User.Avatar.Picker == 'undefined') { Confluence.Templates.User.Avatar.Picker = {}; }


Confluence.Templates.User.Avatar.Picker.imageExplorer = function(opt_data, opt_ignored) {
  opt_data = opt_data || {};
  return '<div class="profile-pic-explorer-container ' + ((! opt_data.imageSrc) ? 'empty' : '') + '"><div class="image-explorer-image-view" tabindex="0"><img class="image-explorer-source" ' + ((opt_data.imageSrc) ? 'src="' + soy.$$escapeHtml(opt_data.imageSrc) + '"' : '') + '/><div class="image-explorer-mask rounded-square-mask"></div><div class="image-explorer-drag-delegate"></div></div><div class="image-explorer-scale-slider-wrapper"><input class="image-explorer-scale-slider ' + ((! opt_data.imageSrc) ? 'disabled' : '') + '" type="range" min="0" max="100" step="1" value="0" ' + ((! opt_data.imageSrc) ? 'disabled' : '') + '/></div></div>';
};
if (goog.DEBUG) {
  Confluence.Templates.User.Avatar.Picker.imageExplorer.soyTemplateName = 'Confluence.Templates.User.Avatar.Picker.imageExplorer';
}


Confluence.Templates.User.Avatar.Picker.iframeResponse = function(opt_data, opt_ignored) {
  return '<html><body><div id="json-response">' + soy.$$filterNoAutoescape(opt_data.json) + '</div></body></html>';
};
if (goog.DEBUG) {
  Confluence.Templates.User.Avatar.Picker.iframeResponse.soyTemplateName = 'Confluence.Templates.User.Avatar.Picker.iframeResponse';
}

}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.atlassian.confluence.plugins.confluence-user-profile:avatar-picker', location = 'avatar-picker/templates/image-upload-and-crop.soy' */
// This file was automatically generated from image-upload-and-crop.soy.
// Please don't edit this file by hand.

/**
 * @fileoverview Templates in namespace Confluence.Templates.User.Avatar.Picker.
 */

if (typeof Confluence == 'undefined') { var Confluence = {}; }
if (typeof Confluence.Templates == 'undefined') { Confluence.Templates = {}; }
if (typeof Confluence.Templates.User == 'undefined') { Confluence.Templates.User = {}; }
if (typeof Confluence.Templates.User.Avatar == 'undefined') { Confluence.Templates.User.Avatar = {}; }
if (typeof Confluence.Templates.User.Avatar.Picker == 'undefined') { Confluence.Templates.User.Avatar.Picker = {}; }


Confluence.Templates.User.Avatar.Picker.imageUploadAndCrop = function(opt_data, opt_ignored) {
  return '<div class="image-upload-and-crop-message"></div><div class="profile-pic-upload-and-crop-container disable-attachment-uploader"><div class="input-fields"><form class="aui" onsubmit="return false;">' + Confluence.Templates.User.Avatar.Picker.imageExplorer(opt_data) + '</form></div><form class="aui"><div class="image-upload-and-crop-field-container aui-buttons input-buttons"><input type="file" id="image-upload-and-crop-upload-field" class="image-upload-field" accept="image/jpeg, image/gif, image/png"/><label for="image-upload-and-crop-upload-field" class="image-upload-field-replacement aui-button">' + soy.$$escapeHtml('\u0417\u0430\u0433\u0440\u0443\u0437\u0438\u0442\u044c \u0438\u0437\u043e\u0431\u0440\u0430\u0436\u0435\u043d\u0438\u0435') + '</label></div></form></div>';
};
if (goog.DEBUG) {
  Confluence.Templates.User.Avatar.Picker.imageUploadAndCrop.soyTemplateName = 'Confluence.Templates.User.Avatar.Picker.imageUploadAndCrop';
}

}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.atlassian.confluence.plugins.confluence-user-profile:avatar-picker', location = 'avatar-picker/js/canvas-cropper.js' */
define("confluence-user-profile/avatar-picker/canvas-cropper",["jquery"],function(c){function b(e,d){if(!b.isSupported()){AJS.messages.error({body:"This browser doesn't support CanvasCropper."})}return this.init.apply(this,arguments)}var a=(function(){var d=document.createElement("canvas");return !!(d.getContext&&d.getContext("2d"))}());b.isSupported=function(){return a};b.prototype.defaults={outputFormat:"image/jpeg",outputQuality:0.9,backgroundFillColor:"white"};b.prototype.init=function(e,d,f){this.width=e;this.height=d||e;this.options=_.extend({},this.defaults,f);this.canvas=c("<canvas/>").attr("width",this.width).attr("height",this.height)[0];return this};b.prototype.cropToDataURI=function(h,g,f,e,d){return this.crop(h,g,f,e,d).getDataURI(this.options.outputFormat,this.options.outputQuality)};b.prototype.crop=function(g,f,e,n,o){var d=this.canvas.getContext("2d"),l=0,j=0,k=this.width,h=this.height;d.clearRect(l,j,k,h);if(this.options.backgroundFillColor){d.fillStyle=this.options.backgroundFillColor;d.fillRect(l,j,k,h)}if(f<0){l=Math.round((Math.abs(f)/n)*k);f=0}if(e<0){j=Math.round((Math.abs(e)/o)*h);e=0}if(f+n>g.naturalWidth){var m=g.naturalWidth-f;k*=m/n;n=m}if(e+o>g.naturalHeight){var i=g.naturalHeight-e;h*=i/o;o=i}d.drawImage(g,f,e,n,o,l,j,k,h);return this};b.prototype.getDataURI=function(e,d){if(e){return this.canvas.toDataURL(e,d)}else{return null}};return b});
}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.atlassian.confluence.plugins.confluence-user-profile:avatar-picker', location = 'avatar-picker/js/client-file-handler.js' */
define("confluence-user-profile/avatar-picker/client-file-handler",["jquery","underscore"],function(c,b){function a(d){return this.init(d)}a.typeFilters={all:/.*/,application:/^application\/.*/,audio:/^audio\/.*/,image:/^image\/.*/,imageWeb:/^image\/(jpeg|png|gif)$/,text:/^text\/.*/,video:/^video\/.*/};a.prototype.defaults={fileTypeFilter:a.typeFilters.all,fileCountLimit:Infinity,fileSizeLimit:10*1024*1024,onSuccess:function(){},onError:function(){}};a.prototype.init=function(d){this.options=b.extend({},this.defaults,d);b.bindAll(this,"handleFiles","filterFiles");return this};a.prototype.handleFiles=function(f,e){var d=this.filterFiles(f);if(d.valid.length>0){b.isFunction(this.options.onSuccess)&&this.options.onSuccess(d.valid)}else{b.isFunction(this.options.onError)&&this.options.onError(d.invalid)}};a.prototype.filterFiles=function(e){var h=b.isRegExp(this.options.fileTypeFilter)?this.options.fileTypeFilter:this.defaults.fileTypeFilter,d=this.options.fileSizeLimit,g={byType:[],bySize:[],byCount:[]},f=b.filter(e,function(i){if(!h.test(i.type)){g.byType.push(i);return false}if(i.size>d){g.bySize.push(i);return false}return true});if(f.length>this.options.fileCountLimit){g.byCount=f.slice(this.options.fileCountLimit);f=f.slice(0,this.options.fileCountLimit)}return{valid:f,invalid:g}};return a});
}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.atlassian.confluence.plugins.confluence-user-profile:avatar-picker', location = 'avatar-picker/js/client-file-iframe-uploader.js' */
define("confluence-user-profile/avatar-picker/client-file-iframe-uploader",["jquery","underscore","confluence-user-profile/avatar-picker/client-file-handler"],function(d,b,a){function c(e){return this.init(e)}d.extend(c.prototype,a.prototype);c.prototype.defaults=d.extend({},a.prototype.defaults,{uploadURL:AJS.Meta.get("context-path")+"/rest/user-profile/1.0/avatar/default",uploadFieldName:"file",onUpload:d.noop,responseHandler:function(g,h){var f;try{f=JSON.parse(d(g).html())}catch(i){h.reject()}if(f){h.resolve(f)}else{h.reject()}}});c.prototype.states={IN_PROGRESS:"IN_PROGRESS",IDLE:"IDLE"};c.prototype.init=function(e){b.bindAll(this,"createHiddenIframe","onIframeLoad","handleFiles","setStateInProgress","setStateIdle","cancelUpload");this.options=d.extend({},this.defaults,e);this.$uploadIframe=this.createHiddenIframe();if(this.options.cancelTrigger){this.$cancelTrigger=d(this.options.cancelTrigger);this.$cancelTrigger.click(b.bind(function(){this.cancelUpload()},this))}this.state=this.states.IDLE;return this};c.prototype.createHiddenIframe=function(){return d("<iframe>").attr("name","hidden-upload-iframe").hide().appendTo(document.body).on("load",this.onIframeLoad)};c.prototype.onIframeLoad=function(f){if(this.state===this.states.IN_PROGRESS){this.requestPromise.done(this.options.onUpload).fail(this.options.onError);this.options.responseHandler(f.target.contentDocument.body,this.requestPromise)}};c.prototype.handleFiles=function(f,e){if(this.state===this.states.IN_PROGRESS){this.cancelUpload()}if(!this.$fileSourceElem){this.$fileSourceElem=d(e);this.$fileSourceElem.attr("name",this.options.uploadFieldName);if(!this.$fileSourceElem.prop("form")){this.$fileSourceElem.wrap("<form>")}var g=d(this.$fileSourceElem.prop("form"));g.addClass("hidden-upload-form").attr("action",this.options.uploadURL).attr("method","post").attr("enctype","multipart/form-data").attr("encoding","multipart/form-data").attr("target",this.$uploadIframe.attr("name"));this.$spinner=d('<div class="spinner"></div>').insertBefore(this.$fileSourceElem);if(d.isPlainObject(this.options.extraData)){b.each(this.options.extraData,function(i,h){d('<input type="hidden">').attr("name",h).val(i).appendTo(g)})}}this.$fileSourceElem.prop("form").submit();this.requestPromise=d.Deferred();this.requestPromise.always(this.setStateIdle);this.setStateInProgress()};c.prototype.setStateInProgress=function(){this.state=this.states.IN_PROGRESS;if(this.$spinner){this.$spinner.spin()}if(this.$fileSourceElem){this.$fileSourceElem.attr("disabled","disabled")}};c.prototype.setStateIdle=function(){this.state=this.states.IDLE;if(this.$spinner){this.$spinner.spinStop()}if(this.$fileSourceElem){this.$fileSourceElem.removeAttr("disabled")}this.requestPromise=null};c.prototype.cancelUpload=function(){this.$uploadIframe.remove();this.setStateIdle();this.$uploadIframe=this.createHiddenIframe()};return c});
}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.atlassian.confluence.plugins.confluence-user-profile:avatar-picker', location = 'avatar-picker/js/client-file-reader.js' */
define("confluence-user-profile/avatar-picker/client-file-reader",["jquery","underscore","confluence-user-profile/avatar-picker/client-file-handler"],function(e,d,b){var f=!!(window.File&&window.FileList&&window.FileReader);var c={ArrayBuffer:"readAsArrayBuffer",BinaryString:"readAsBinaryString",DataURL:"readAsDataURL",Text:"readAsText"};function a(g){if(!a.isSupported()){throw new Error("ClientFileReader requires FileReaderAPI support")}return this.init(g)}a.isSupported=function(){return f};d.extend(a.prototype,b.prototype);a.readMethods={ArrayBuffer:"ArrayBuffer",BinaryString:"BinaryString",DataURL:"DataURL",Text:"Text"};a.typeFilters=b.typeFilters;a.prototype.defaults=d.extend({},b.prototype.defaults,{readMethod:a.readMethods.DataURL,onRead:function(){}});a.prototype.init=function(g){b.prototype.init.call(this,g);d.bindAll(this,"onSuccess","readFile");this.options.onSuccess=this.onSuccess;return this};a.prototype.onSuccess=function(h){var g=d.has(c,this.options.readMethod)?c[this.options.readMethod]:undefined;if(g){d.each(h,d.bind(function(j){var i=new FileReader();i.onload=d.bind(this.readFile,this,j);i[g](j)},this))}};a.prototype.readFile=function(g,h){d.isFunction(this.options.onRead)&&this.options.onRead(h.target.result,g)};return a});
}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.atlassian.confluence.plugins.confluence-user-profile:avatar-picker', location = 'avatar-picker/js/drag-drop-file-target.js' */
define("confluence-user-profile/avatar-picker/drag-drop-file-target",["jquery","underscore"],function(c,a){function b(d,e){return this.init.apply(this,arguments)}b.prototype.getDefaults=function(){return{activeDropTargetClass:"active-drop-target",uploadPrompt:"\u041f\u0435\u0440\u0435\u0442\u0430\u0449\u0438\u0442\u0435 \u0441\u044e\u0434\u0430 \u0438\u0437\u043e\u0431\u0440\u0430\u0436\u0435\u043d\u0438\u0435",clientFileHandler:null}};b.prototype.init=function(d,e){a.bindAll(this,"onDragOver","onDragEnd","onDrop");this._$target=c(d);this.options=a.extend({},this.getDefaults(),e);this._$target.attr("data-upload-prompt",this.options.uploadPrompt);this._$target.on("dragover",this.onDragOver);this._$target.on("dragleave",this.onDragEnd);this._$target.on("dragend",this.onDragEnd);this._$target.on("drop",this.onDrop)};b.prototype.onDragOver=function(d){d.preventDefault();this._$target.addClass(this.options.activeDropTargetClass)};b.prototype.onDragEnd=function(d){d.preventDefault();this._$target.removeClass(this.options.activeDropTargetClass)};b.prototype.onDrop=function(d){d.preventDefault();d.originalEvent.preventDefault();this._$target.removeClass(this.options.activeDropTargetClass);if(this.options.clientFileHandler){this.options.clientFileHandler.handleFiles(d.originalEvent.dataTransfer.files,d.originalEvent.target)}};return b});
}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.atlassian.confluence.plugins.confluence-user-profile:avatar-picker', location = 'avatar-picker/js/image-explorer.js' */
define("confluence-user-profile/avatar-picker/image-explorer",["jquery","underscore"],function(b,a){function c(e,d){this.init.apply(this,arguments)}c.scaleModes={fill:"fill",contain:"contain",containAndFill:"containAndFill"};c.zoomModes={localZoom:"localZoom",imageZoom:"imageZoom"};c.prototype.defaults={initialScaleMode:c.scaleModes.containAndFill,zoomMode:c.zoomModes.localZoom,emptyClass:"empty",scaleMax:1};c.prototype.init=function(e,d){this.$container=e;this._$imageView=this.$container.find(".image-explorer-image-view");this._$sourceImage=this.$container.find(".image-explorer-source");this._$mask=this.$container.find(".image-explorer-mask");this._$dragDelegate=this.$container.find(".image-explorer-drag-delegate");this.$scaleSlider=this.$container.find(".image-explorer-scale-slider");this.options=a.extend({},this.defaults,d);this.imageProperties={};a.bindAll(this,"getImageSrc","setImageSrc","initImage","initDragDelegate","initScaleSlider","setInitialScale","getFillScale","getContainedScale","getCircularContainedScale","sliderValToScale","scaleToSliderVal","updateImageScale","resetImagePosition","resetScaleSlider","toggleEmpty","get$ImageView","get$SourceImage","get$Mask","get$DragDelegate","getMaskedImageProperties","showError","clearError","hasValidImage","_resetFromError","_removeError");this.toggleEmpty(true);if(this._$sourceImage[0].naturalWidth){this.toggleEmpty(false);this.initImage({target:this._$sourceImage[0]})}this._$sourceImage.on("load",this.initImage);this.initDragDelegate();this.initScaleSlider()};c.prototype.getImageSrc=function(){return(this._$sourceImage)?this._$sourceImage.attr("src"):undefined};c.prototype.setImageSrc=function(d){if(this._$sourceImage){this._$sourceImage.attr("src","").attr("src",d)}};c.prototype.initImage=function(f){var d=f.target;this.imageProperties.naturalWidth=d.naturalWidth;this.imageProperties.naturalHeight=d.naturalHeight;this._removeError();this.toggleEmpty(false);this.setInitialScale()};c.prototype.initDragDelegate=function(){var d;this._$dragDelegate.draggable({start:a.bind(function(){d=this._$sourceImage.offset()},this),drag:a.bind(function(g,f){this._$sourceImage.offset({top:d.top+f.position.top-f.originalPosition.top,left:d.left+f.position.left-f.originalPosition.left})},this),revert:true,revertDuration:0})};c.prototype.initScaleSlider=function(){this.$scaleSlider.on("change",a.bind(function(d){this.updateImageScale(this.sliderValToScale(d.target.value))},this))};c.prototype.setInitialScale=function(){var h=this._$mask.width(),f=this._$mask.height(),e=this.imageProperties.naturalWidth,g=this.imageProperties.naturalHeight,d=1;this.minScale=1;switch(this.options.initialScaleMode){case c.scaleModes.fill:this.minScale=d=this.getFillScale(e,g,h,f);break;case c.scaleModes.contain:if(this._$mask.hasClass("circle-mask")){this.minScale=d=this.getCircularContainedScale(e,g,h/2)}else{this.minScale=d=this.getContainedScale(e,g,h,f)}break;case c.scaleModes.containAndFill:if(this._$mask.hasClass("circle-mask")){this.minScale=this.getCircularContainedScale(e,g,h/2)}else{this.minScale=this.getContainedScale(e,g,h,f)}d=this.getFillScale(e,g,h,f);break}this.maxScale=Math.max(d,this.options.scaleMax);this.resetScaleSlider(this.scaleToSliderVal(d));this.updateImageScale(d,c.zoomModes.imageZoom);this.resetImagePosition()};c.prototype.getFillScale=function(f,d,e,i){var h=e/f,g=i/d;return Math.max(h,g)};c.prototype.getContainedScale=function(f,d,e,i){var h=e/f,g=i/d;return Math.min(h,g)};c.prototype.getCircularContainedScale=function(e,d,h){var g=Math.atan(d/e),f=Math.cos(g)*h*2;return f/e};c.prototype.sliderValToScale=function(e){var d=e/(this.$scaleSlider.attr("max")-this.$scaleSlider.attr("min"));return this.minScale+(d*(this.maxScale-this.minScale))};c.prototype.scaleToSliderVal=function(e){var d=(e-this.minScale)/(this.maxScale-this.minScale);return d*(this.$scaleSlider.attr("max")-this.$scaleSlider.attr("min"))};c.prototype.updateImageScale=function(j,l){var i=Math.round(j*this.imageProperties.naturalWidth),d=Math.round(j*this.imageProperties.naturalHeight),f,e;l=l||this.options.zoomMode;switch(l){case c.zoomModes.imageZoom:f=-1*i/2;e=-1*d/2;break;case c.zoomModes.localZoom:var h=this._$sourceImage.width(),r=this._$sourceImage.height(),n=parseInt(this._$sourceImage.css("margin-left"),10),g=parseInt(this._$sourceImage.css("margin-top"),10),q=this._$sourceImage.position(),p=this._$imageView.width()/2,o=this._$imageView.height()/2,m=p-q.left-n,k=o-q.top-g,t=(m/h)*i,s=(k/r)*d;f=p-q.left-t;e=o-q.top-s;break}this._$sourceImage.width(i).height(d).css({"margin-left":Math.round(f)+"px","margin-top":Math.round(e)+"px"})};c.prototype.resetImagePosition=function(){this._$sourceImage.css({top:"50%",left:"50%"})};c.prototype.resetScaleSlider=function(d){this.$scaleSlider.val(d).removeClass("disabled").removeAttr("disabled")};c.prototype.toggleEmpty=function(d){this.$container.toggleClass(this.options.emptyClass,d)};c.prototype.get$ImageView=function(){return this._$imageView};c.prototype.get$SourceImage=function(){return this._$sourceImage};c.prototype.get$Mask=function(){return this._$mask};c.prototype.get$DragDelegate=function(){return this._$dragDelegate};c.prototype.getMaskedImageProperties=function(){var f=this._$sourceImage.width()/this.imageProperties.naturalWidth,e=this._$sourceImage.height()/this.imageProperties.naturalHeight,d=this._$mask.position(),g=this._$sourceImage.position();d.top+=parseInt(this._$mask.css("margin-top"),10);d.left+=parseInt(this._$mask.css("margin-left"),10);g.top+=parseInt(this._$sourceImage.css("margin-top"),10);g.left+=parseInt(this._$sourceImage.css("margin-left"),10);return{maskedAreaImageX:Math.round((d.left-g.left)/f),maskedAreaImageY:Math.round((d.top-g.top)/e),maskedAreaWidth:Math.round(this._$mask.width()/f),maskedAreaHeight:Math.round(this._$mask.height()/e)}};c.prototype.showError=function(f,e){this._removeError();this.toggleEmpty(true);this.$container.addClass("error");var d=b(aui.message.error({titleContent:f,content:e||"",closeable:true}));d.appendTo(this._$imageView).css({"margin-top":-1*d.outerHeight()/2}).attr("id","upload-error-message");d.on("messageClose",this._resetFromError);AJS.messages.setup()};c.prototype.clearError=function(){this._removeError();this._resetFromError()};c.prototype.hasValidImage=function(){return !!(this.getImageSrc()&&this._$sourceImage.prop("naturalWidth"))};c.prototype._resetFromError=function(){var d=this.hasValidImage();this.toggleEmpty(!d);this.$container.removeClass("error");a.isFunction(this.options.onErrorReset)&&this.options.onErrorReset(d?this.getImageSrc():undefined)};c.prototype._removeError=function(){this._$imageView.find(".aui-message.error").remove()};return c});
}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.atlassian.confluence.plugins.confluence-user-profile:avatar-picker', location = 'avatar-picker/js/image-upload-and-crop.js' */
define("confluence-user-profile/avatar-picker/image-upload-and-crop",["jquery","underscore","confluence-user-profile/avatar-picker/canvas-cropper","confluence-user-profile/avatar-picker/client-file-iframe-uploader","confluence-user-profile/avatar-picker/client-file-reader","confluence-user-profile/avatar-picker/drag-drop-file-target","confluence-user-profile/avatar-picker/image-explorer","confluence-user-profile/avatar-picker/text-util","confluence-user-profile/avatar-picker/upload-interceptor"],function(e,h,b,i,f,g,j,d,a){function c(l,k){if(!c.isSupported()){AJS.messages.error({body:"This browser doesn't support ImageUploadAndCrop."})}this.init.apply(this,arguments)}c.isSupported=function(){return b.isSupported()};c.prototype.defaults={HiDPIMultiplier:2,dragDropUploadPrompt:"\u041f\u0435\u0440\u0435\u0442\u0430\u0449\u0438\u0442\u0435 \u0441\u044e\u0434\u0430 \u0438\u0437\u043e\u0431\u0440\u0430\u0436\u0435\u043d\u0438\u0435",onImageUpload:function(){},onImageUploadError:function(){},onCrop:function(){},outputFormat:"image/jpeg",outputQuality:0.9,fallbackUploadOptions:{},initialScaleMode:j.scaleModes.containAndFill,scaleMax:1,fileSizeLimit:10*1024*1024,maxImageDimension:4000};c.prototype.init=function(n,m){this.options=h.extend({},this.defaults,m);this.$container=n;h.bindAll(this,"crop","resetState","_onFileProcessed","setImageSrc","validateImageResolution","_onFilesError","_onFileError","_resetFileUploadField","_onErrorReset","_rotateImage");this.imageExplorer=new j(this.$container.find(".profile-pic-explorer-container"),{initialScaleMode:this.options.initialScaleMode,scaleMax:this.options.scaleMax,onErrorReset:this._onErrorReset});if(f.isSupported()){this.clientFileReader=new f({onRead:this._onFileProcessed,onError:this._onFilesError,fileTypeFilter:f.typeFilters.imageWeb,fileCountLimit:1,fileSizeLimit:this.options.fileSizeLimit});this.dragDropFileTarget=new g(this.imageExplorer.get$ImageView(),{uploadPrompt:this.options.dragDropUploadPrompt,clientFileHandler:this.clientFileReader})}else{this.$container.addClass("filereader-unsupported");var l=h.extend({onUpload:this._onFileProcessed,onError:this._onFileError},this.options.fallbackUploadOptions);this.clientFileReader=new i(l)}this.uploadIntercepter=new a(this.$container.find(".image-upload-field"),{replacementEl:this.$container.find(".image-upload-field-replacement"),clientFileHandler:this.clientFileReader});var k=this.imageExplorer.get$Mask();this.canvasCroppper=new b(k.width()*this.options.HiDPIMultiplier,k.height()*this.options.HiDPIMultiplier,{outputFormat:this.options.outputFormat,outputQuality:this.options.outputQuality});this.options.cropButton&&e(this.options.cropButton).click(this.crop)};c.prototype.crop=function(){var k="";if(!this.imageExplorer.$container.hasClass("empty")){var l=this.imageExplorer.getMaskedImageProperties();k=this.canvasCroppper.cropToDataURI(this.imageExplorer.get$SourceImage()[0],l.maskedAreaImageX,l.maskedAreaImageY,l.maskedAreaWidth,l.maskedAreaHeight)}h.isFunction(this.options.onCrop)&&this.options.onCrop(k)};c.prototype.resetState=function(){this.imageExplorer.clearError();this._resetFileUploadField()};c.prototype.saveState=function(){if(this.imageExplorer.$container.hasClass("empty")){return}var k=this.imageExplorer.get$SourceImage();if(k.length){this.imageState={top:k.css("top"),left:k.css("left"),marginTop:k.css("margin-top"),marginLeft:k.css("margin-left"),zoom:e(".image-explorer-scale-slider").val()}}};c.prototype.restoreState=function(){if(this.imageExplorer.$container.hasClass("empty")||!this.imageState){return}var k=this.imageExplorer.get$SourceImage();if(k.length){this.imageExplorer.$scaleSlider.val(this.imageState.zoom).trigger("change");k.css({top:this.imageState.top,left:this.imageState.left,"margin-top":this.imageState.marginTop,"margin-left":this.imageState.marginLeft})}};c.prototype._onFileProcessed=function(m){if(m){var l=this.validateImage(m);var k=this;l.done(function(){if(!isNaN(k.options.maxImageDimension)){var n=k.validateImageResolution(m);n.done(function(p,o){k.setImageSrc(m)}).fail(function(p,o){k._onFileError(AJS.format("\u0412\u044b\u0431\u0440\u0430\u043d\u043d\u043e\u0435 \u0438\u0437\u043e\u0431\u0440\u0430\u0436\u0435\u043d\u0438\u0435 \u0438\u043c\u0435\u0435\u0442 \u0440\u0430\u0437\u043c\u0435\u0440 {0}px * {1}px. \u041c\u0430\u043a\u0441\u0438\u043c\u0430\u043b\u044c\u043d\u044b\u0439 \u0440\u0430\u0437\u043c\u0435\u0440 \u0434\u043e\u043b\u0436\u0435\u043d \u0431\u044b\u0442\u044c {2}px * {2}px",p,o,k.options.maxImageDimension))})}else{k.setImageSrc(m)}}).fail(function(){k._onFileError("\u0423\u0431\u0435\u0434\u0438\u0442\u0435\u0441\u044c, \u0447\u0442\u043e \u0432\u0430\u0448 \u0444\u0430\u0439\u043b \u044f\u0432\u043b\u044f\u0435\u0442\u0441\u044f \u0434\u0435\u0439\u0441\u0442\u0432\u0438\u0442\u0435\u043b\u044c\u043d\u044b\u043c \u0438\u0437\u043e\u0431\u0440\u0430\u0436\u0435\u043d\u0438\u0435\u043c \u0432 \u0444\u043e\u0440\u043c\u0430\u0442\u0435 JPEG, GIF \u0438\u043b\u0438 PNG \u0438 \u043f\u043e\u043f\u0440\u043e\u0431\u0443\u0439\u0442\u0435 \u0441\u043d\u043e\u0432\u0430.")})}else{this._onFileError()}};c.prototype.validateImage=function(m){var k=e.Deferred(),l=new Image();l.onerror=function(){k.reject()};l.onload=function(){k.resolve()};l.src=m;return k};c.prototype.setImageSrc=function(k){this._rotateImage(k,h.bind(function(l){this.imageExplorer.setImageSrc(l);h.isFunction(this.options.onImageUpload)&&this.options.onImageUpload(l);this._resetFileUploadField()},this))};c.prototype._rotateImage=function(l,m){if(!h.isObject(window.EXIF)){m(l);return}var k=new Image();k.onload=function(){window.EXIF.getData(k);var r=window.EXIF.getTag(k,"Orientation");if(h.isUndefined(r)){m(l);return}var q=k.width,n=k.height,p=document.createElement("canvas"),o=p.getContext("2d");if([5,6,7,8].indexOf(r)>-1){p.width=n;p.height=q}else{p.width=q;p.height=n}switch(r){case 2:o.transform(-1,0,0,1,q,0);break;case 3:o.transform(-1,0,0,-1,q,n);break;case 4:o.transform(1,0,0,-1,0,n);break;case 5:o.transform(0,1,1,0,0,0);break;case 6:o.transform(0,1,-1,0,n,0);break;case 7:o.transform(0,-1,-1,0,n,q);break;case 8:o.transform(0,-1,1,0,0,q);break;default:o.transform(1,0,0,1,0,0)}o.drawImage(k,0,0);m(p.toDataURL())};k.src=l};c.prototype.validateImageResolution=function(n){var k=e.Deferred(),m=new Image(),l=this;m.onload=function(){if(this.naturalWidth>l.options.maxImageDimension||this.naturalHeight>l.options.maxImageDimension){k.reject(this.naturalWidth,this.naturalHeight)}else{k.resolve(this.naturalWidth,this.naturalHeight)}};m.src=n;return k};c.prototype._onFilesError=function(l){if(l&&l.bySize&&l.bySize.length){var k=h.first(l.bySize);this._onFileError(AJS.format("\u0424\u0430\u0439\u043b \u00ab{0}\u00bb \u044f\u0432\u043b\u044f\u0435\u0442\u0441\u044f {1} \u0438 \u043f\u0440\u0435\u0432\u044b\u0448\u0430\u0435\u0442 \u043c\u0430\u043a\u0441\u0438\u043c\u0430\u043b\u044c\u043d\u043e \u0434\u043e\u043f\u0443\u0441\u0442\u0438\u043c\u044b\u0439 \u0440\u0430\u0437\u043c\u0435\u0440 {2}",d.abbreviateText(k.name,50),d.formatSizeInBytes(k.size),d.formatSizeInBytes(this.options.fileSizeLimit)))}else{this._onFileError()}};c.prototype._onFileError=function(k){AJS.log("onFileError",k);var m="\u041f\u0440\u0438 \u0437\u0430\u0433\u0440\u0443\u0437\u043a\u0435 \u0438\u0437\u043e\u0431\u0440\u0430\u0436\u0435\u043d\u0438\u044f \u043f\u0440\u043e\u0438\u0437\u043e\u0448\u043b\u0430 \u043e\u0448\u0438\u0431\u043a\u0430",l=k||"\u0423\u0431\u0435\u0434\u0438\u0442\u0435\u0441\u044c, \u0447\u0442\u043e \u0432\u0430\u0448 \u0444\u0430\u0439\u043b \u044f\u0432\u043b\u044f\u0435\u0442\u0441\u044f \u0434\u0435\u0439\u0441\u0442\u0432\u0438\u0442\u0435\u043b\u044c\u043d\u044b\u043c \u0438\u0437\u043e\u0431\u0440\u0430\u0436\u0435\u043d\u0438\u0435\u043c \u0432 \u0444\u043e\u0440\u043c\u0430\u0442\u0435 JPEG, GIF \u0438\u043b\u0438 PNG \u0438 \u043f\u043e\u043f\u0440\u043e\u0431\u0443\u0439\u0442\u0435 \u0441\u043d\u043e\u0432\u0430.";this.imageExplorer.showError(m,l);this._resetFileUploadField();h.isFunction(this.options.onImageUploadError)&&this.options.onImageUploadError(k)};c.prototype._resetFileUploadField=function(){var k=this.$container.find("#image-upload-and-crop-upload-field").prop("form");k&&k.reset()};c.prototype._onErrorReset=function(k){if(k){h.isFunction(this.options.onImageUpload)&&this.options.onImageUpload(k)}};return c});
}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.atlassian.confluence.plugins.confluence-user-profile:avatar-picker', location = 'avatar-picker/js/text-util.js' */
define("confluence-user-profile/avatar-picker/text-util",[],function(){return{formatSizeInBytes:function(d){var b=[" bytes","KB","MB","GB","TB","PB"],c=1024,a=0,e=b.length-1;d=(typeof d==="number")?d:parseInt(d,10);if(isNaN(d)){return""}while(d>=c&&a<e){d/=c;a++}d=Math.floor((d*10))/10;return d+b[a]},abbreviateText:function(f,a,e){if(typeof f!=="string"){return undefined}if(isNaN(a)||a<0||f.length<=a){return f}var c=(typeof e==="string")?e:"…",b=f.length-a+c.length,d=Math.round(f.length/2);return f.substring(0,d-Math.ceil(b/2))+c+f.substring(d+Math.floor(b/2),f.length)}}});
}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.atlassian.confluence.plugins.confluence-user-profile:avatar-picker', location = 'avatar-picker/js/upload-interceptor.js' */
define("confluence-user-profile/avatar-picker/upload-interceptor",["jquery","underscore"],function(c,a){function b(d,e){return this.init.apply(this,arguments)}b.prototype.defaults={replacementEl:undefined,clientFileHandler:null};b.prototype.init=function(d,e){a.bindAll(this,"onSelectFile","onReplacementClick");this._$el=c(d);this.options=a.extend({},this.defaults,e);this._$el.on("change",this.onSelectFile);if(this.options.replacementEl){this._$replacement=c(this.options.replacementEl);this._$el.hide();if(c.browser&&c.browser.msie){if(!this._$replacement.is("label")){this._$replacement.hide();this._$el.show()}}else{this._$replacement.on("click",this.onReplacementClick)}}};b.prototype.onSelectFile=function(d){if(c(d.target).val()&&this.options.clientFileHandler){this.options.clientFileHandler.handleFiles(d.target.files,this._$el)}};b.prototype.onReplacementClick=function(d){d.preventDefault();this._$el.click()};b.prototype.destroy=function(){this._$el.off("change",this.onSelectFile);this._$replacement.off("click",this.onReplacementClick)};return b});
}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.atlassian.confluence.plugins.confluence-user-profile:avatar-picker', location = 'avatar-picker/js/avatar-picker-panel.js' */
define("confluence-user-profile/avatar-picker/avatar-picker-panel",["jquery","underscore","ajs","confluence-user-profile/avatar-picker/image-upload-and-crop"],function(c,b,a,e){function d(f){if(!e.isSupported()){a.messages.error({body:"This browser doesn't support AvatarPickerPanel."})}return this.init(f)}d.prototype.defaults={panel:null,saveButton:null,cancelButton:null,onCrop:function(){},onExpanded:function(){}};d.prototype.init=function(f){b.bindAll(this,"initPanelContent","_onImageUpload","_onImageUploadError","_toggleSaveButtonEnabled","_onUpdateDetails");this.options=c.extend(true,{},this.defaults,f);this._$panel=this.options.panel;this._$saveButton=this.options.saveButton;this.initPanelContent();this._toggleSaveButtonEnabled(false);this.imageUploadAndCrop=new e(this._$panel.find(".profile-pic-upload-and-crop-container"),{HiDPIMultiplier:1,onCrop:this._onUpdateDetails,onImageUpload:this._onImageUpload,onImageUploadError:this._onImageUploadError,fallbackUploadOptions:{uploadURL:a.Meta.get("context-path")+"/rest/user-profile/1.0/avatar/uploadFallback",uploadFieldName:"upload-logo-input",responseHandler:function(k,l){var j=c(k),i=j.find("#json-response");if(i.length){var h;try{h=JSON.parse(i.html())}catch(m){l.reject()}if(h&&h.src){l.resolve(a.Meta.get("context-path")+h.src)}else{l.reject(h&&h.errorMessages&&h.errorMessages[0])}}else{var g=j.find(".error-image + h2").text();g=g.replace(/; nested exception.*$/,".").replace(/(\d+) bytes/,function(n,o){return TextUtil.formatSizeInBytes(o)});l.reject(g)}},cancelTrigger:this._$saveButton.add(this.options.cancelButton)}});this._$saveButton.click(function(){this.imageUploadAndCrop.crop()}.bind(this));return this};d.prototype.initPanelContent=function(){this._$panel.append(Confluence.Templates.User.Avatar.Picker.imageUploadAndCrop({description:"JPG, GIF \u0438\u043b\u0438 PNG \u0444\u0430\u0439\u043b",fallbackDescription:"JPG, GIF \u0438\u043b\u0438 PNG \u0444\u0430\u0439\u043b"}));this._$message=this._$panel.find(".image-upload-and-crop-message")};d.prototype._onUpdateDetails=function(f){this.options.onCrop(f)};d.prototype._onImageUpload=function(){this._toggleExpanded(true);this._toggleSaveButtonEnabled(true)};d.prototype._onImageUploadError=function(){this._toggleExpanded(false);this._toggleSaveButtonEnabled(false)};d.prototype._toggleSaveButtonEnabled=function(f){if(f===null){f=this._$saveButton.attr("disabled")!==null}if(f){this._$saveButton.removeAttr("disabled")}else{this._$saveButton.attr("disabled","disabled")}};d.prototype.setMessage=function(f){this._$message.html(aui.message.error({content:f,closeable:false})).show()};d.prototype.hideMessage=function(){this._$message.hide()};d.prototype.getImageCropper=function(){return this.imageUploadAndCrop};d.prototype._toggleExpanded=function(f){this.options.onExpanded(f)};return d});
}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.atlassian.confluence.plugins.confluence-user-profile:avatar-picker', location = 'avatar-picker/js/avatar-picker-dialog.js' */
define("confluence-user-profile/avatar-picker/avatar-picker-dialog",["jquery","underscore","confluence-user-profile/avatar-picker/avatar-picker-panel"],function(b,a,d){function c(e){return this.init(e)}c.prototype.defaults={dialogTitle:"\u0417\u0430\u0433\u0440\u0443\u0437\u0438\u0442\u044c \u0438\u0437\u043e\u0431\u0440\u0430\u0436\u0435\u043d\u0438\u0435 \u043f\u0440\u043e\u0444\u0438\u043b\u044f",dialogOptions:{width:400,height:518,id:"personal-avatar-picker-dialog",closeOnOutsideClick:false},onCrop:function(){},trigger:null};c.prototype.init=function(e){a.bindAll(this,"initDialogContent","hide","show","cancel");this.options=b.extend(true,{},this.defaults,e);this._$dialog=new AJS.Dialog(this.options.dialogOptions);this.initDialogContent();if(this.options.trigger){this._$trigger=b(this.options.trigger);this._$trigger.click(a.bind(function(f){f.preventDefault();this.show()},this))}return this};c.prototype.initDialogContent=function(){this._$dialog.addHeader(this.options.dialogTitle).addPanel().addSubmit("\u0421\u043e\u0445\u0440\u0430\u043d\u0438\u0442\u044c").addCancel("\u041e\u0442\u043c\u0435\u043d\u0430",this.cancel);this._$saveButton=this._$dialog.getCurrentPanel().page.buttonpanel.find(".button-panel-submit-button");this._$cancelButton=this._$dialog.getCurrentPanel().page.buttonpanel.find(".button-panel-cancel-link");this.panel=new d({panel:this._$dialog.getCurrentPanel().body,saveButton:this._$saveButton,cancelButton:this._$cancelButton,onCrop:this.options.onCrop,onExpanded:function(e){b("#personal-avatar-picker-dialog").toggleClass("expanded",e)}})};c.prototype.hide=function(){this.panel.hideMessage();this._$dialog.hide();this.panel.getImageCropper().resetState()};c.prototype.cancel=function(){this.panel.getImageCropper().restoreState();this.hide()};c.prototype.setMessage=function(e){this.panel.setMessage(e)};c.prototype.show=function(){this.panel.getImageCropper().saveState();this._$dialog.show();b("#personal-avatar-picker-dialog .button-panel-submit-button").removeClass("button-panel-button").addClass("aui-button aui-button-primary")};return c});
}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.atlassian.confluence.plugins.confluence-user-profile:confluence-user-profile-resources', location = '/js/confluence-user-profile-plugin.js' */
require(["jquery","confluence-user-profile/avatar-picker/avatar-picker-dialog"],function(a,b){a(function(){var f;var d=AJS.Meta.get("remote-user-key");var c=function(g){a(".user-avatar-preview").attr("src",AJS.Meta.get("context-path")+g);a(".userLogo").attr("src",AJS.Meta.get("context-path")+g);a(".aui-avatar-inner img").attr("src",AJS.Meta.get("context-path")+g)};var e=function(g){if(!f){f=new b({onCrop:function(h){a.ajax({type:"POST",dataType:"json",contentType:"application/json",data:JSON.stringify({avatarDataURI:h}),url:AJS.Meta.get("context-path")+"/rest/user-profile/1.0/"+d+"/avatar/upload",success:function(i){c(i.avatarPath);f.hide()},error:function(i){f.setMessage("\u0412\u043e\u0437\u043d\u0438\u043a\u043b\u0430 \u043e\u0448\u0438\u0431\u043a\u0430 \u043f\u0440\u0438 \u043e\u0431\u043d\u043e\u0432\u043b\u0435\u043d\u0438\u0438 \u043f\u043e\u0434\u0440\u043e\u0431\u043d\u044b\u0445 \u0434\u0430\u043d\u043d\u044b\u0445 \u0430\u0432\u0430\u0442\u0430\u0440\u0430")}})}})}f.show();g.preventDefault();return false};a("#profile-avatar-button").click(function(g){e(g);g.preventDefault()})})});
}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.atlassian.confluence.plugins.confluence-user-profile:confluence-user-profile-resources', location = '/templates/soy/confluence-user-profile.soy' */
// This file was automatically generated from confluence-user-profile.soy.
// Please don't edit this file by hand.

/**
 * @fileoverview Templates in namespace Confluence.User.Profile.
 */

if (typeof Confluence == 'undefined') { var Confluence = {}; }
if (typeof Confluence.User == 'undefined') { Confluence.User = {}; }
if (typeof Confluence.User.Profile == 'undefined') { Confluence.User.Profile = {}; }


Confluence.User.Profile.avatarUploader = function(opt_data, opt_ignored) {
  return '\u2002 \u2002 <div class="user-avatar-uploader" id="request-access">' + ((opt_data.userInfo.userName == null) ? '\u2002 \u2002 <img class="user-avatar-preview logo anonymous" src="' + soy.$$escapeHtml("/s/ru_RU/7901/58be3fa11e9ad58113c0ea45e7063389a7c7d344/_") + '/images/icons/profilepics/anonymous.png" alt="user icon">' : (opt_data.userInfo.profilePicture.isDefault) ? '\u2002 \u2002 <img class="user-avatar-preview logo defaultLogo" src="' + soy.$$escapeHtml("/s/ru_RU/7901/58be3fa11e9ad58113c0ea45e7063389a7c7d344/_") + '/images/icons/profilepics/default.png" alt="' + soy.$$escapeHtml('\u0418\u043a\u043e\u043d\u043a\u0430 \u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u0435\u043b\u044f') + ': ' + soy.$$escapeHtml('\u0414\u043e\u0431\u0430\u0432\u0438\u0442\u044c \u0441\u0432\u043e\u044e \u0444\u043e\u0442\u043e\u0433\u0440\u0430\u0444\u0438\u044e') + '">' : '\u2002 \u2002 <img class="user-avatar-preview logo" src="' + soy.$$escapeHtml(opt_data.userInfo.profilePicture.path) + '" alt="user icon">') + '<br><button class="aui-button avatar-picker-trigger" id="profile-avatar-button">' + soy.$$escapeHtml('\u0417\u0430\u0433\u0440\u0443\u0437\u0438\u0442\u044c \u0438\u0437\u043e\u0431\u0440\u0430\u0436\u0435\u043d\u0438\u0435') + '</button></div>';
};
if (goog.DEBUG) {
  Confluence.User.Profile.avatarUploader.soyTemplateName = 'Confluence.User.Profile.avatarUploader';
}

}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.atlassian.plugins.base-hipchat-integration-plugin-api:ajs-amd', location = 'lib/amd/ajs-amd.js' */
define("ajs",function(){return AJS});
}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.atlassian.plugins.base-hipchat-integration-plugin-api:wrm-amd', location = 'lib/amd/wrm-amd.js' */
define("wrm/context-path",function(){return AJS.contextPath});define("wrm/data",function(){var a=function(){};if(WRM){if(typeof WRM.data==="function"){a=WRM.data}else{if(WRM.data&&typeof WRM.data.claim==="function"){a=WRM.data.claim}}}return{claim:a}});define("wrm",function(){if(WRM.data instanceof Function){WRM.data.claim=WRM.data}return WRM});
}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.atlassian.plugins.base-hipchat-integration-plugin-api:backbone-amd', location = 'lib/amd/backbone-amd.js' */
define("backbone",function(){return Backbone});
}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.atlassian.plugins.base-hipchat-integration-plugin-api:jquery-amd', location = 'lib/amd/jquery-amd.js' */
define("jquery",function(){return AJS.$});
}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.atlassian.plugins.base-hipchat-integration-plugin-api:underscore-amd', location = 'lib/amd/underscore-amd.js' */
define("underscore",function(){return _});
}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.atlassian.plugins.base-hipchat-integration-plugin:hipchat-configuration-panel-js', location = 'oauth2/hipchat-configuration-panel.js' */
AJS.toInit(function(b){var a=b("#enable-hipchat-button");var h={begin:b("#oauth2-begin-uri").val(),redirect:b("#redirect-uri").val()};var g=HipChat.Templates.Configuration;function f(k){window.location=k}var e=function(l){var k={url:h.begin,type:"POST",contentType:"application/x-www-form-urlencoded",data:{redirect:h.redirect}};AJS.safe.ajax(k).done(f);return false};a.click(e);var i=b("#oauth2-error-message");var c=b("#oauth2-error-status-code");if(i.length>0){var j=b("#hipchat-configuration-top-banner");var d=g.errorMessage({statusCode:c.val()});j.html(AJS.messages.error({title:"Error message",body:d}));b("#oauth2-retry-link").click(e)}});
}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.atlassian.plugins.base-hipchat-integration-plugin:hipchat-configuration-panel-js', location = 'oauth2/hipchat-error-template.soy' */
// This file was automatically generated from hipchat-error-template.soy.
// Please don't edit this file by hand.

/**
 * @fileoverview Templates in namespace HipChat.Templates.Configuration.
 */

if (typeof HipChat == 'undefined') { var HipChat = {}; }
if (typeof HipChat.Templates == 'undefined') { HipChat.Templates = {}; }
if (typeof HipChat.Templates.Configuration == 'undefined') { HipChat.Templates.Configuration = {}; }


HipChat.Templates.Configuration.errorMessage = function(opt_data, opt_ignored) {
  return '<p>' + soy.$$escapeHtml(AJS.format('\u041e\u0448\u0438\u0431\u043a\u0430 \u0438\u043d\u0442\u0435\u0433\u0440\u0430\u0446\u0438\u0438 Hipchat: \u043f\u043e\u043b\u0443\u0447\u0435\u043d \u043a\u043e\u0434 \u0441\u043e\u0441\u0442\u043e\u044f\u043d\u0438\u044f HTTP {0}.',opt_data.statusCode)) + ' <a href="#" id="oauth2-retry-link">' + soy.$$escapeHtml('\u041d\u0430\u0436\u043c\u0438\u0442\u0435 \u0437\u0434\u0435\u0441\u044c, \u0447\u0442\u043e\u0431\u044b \u043f\u043e\u0432\u0442\u043e\u0440\u0438\u0442\u044c \u043f\u043e\u043f\u044b\u0442\u043a\u0443.') + '</a></p>';
};
if (goog.DEBUG) {
  HipChat.Templates.Configuration.errorMessage.soyTemplateName = 'HipChat.Templates.Configuration.errorMessage';
}

}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.atlassian.plugin.notifications.notifications-module:notification-util', location = '/js/notifications-module-util.js' */
if(typeof AJS.namespace==="undefined"){AJS.namespace=function(d,c,e){var f=d.split(".");c=c||window;for(var b=0,g=f.length-1;b<g;b++){var a=c[f[b]];c=(a!=null)?a:c[f[b]]={}}return c[f[b]]=e||{}}}AJS.overrides={};AJS.Meta=jQuery.extend({},AJS.Meta,{set:function(a,b){AJS.overrides[a]=b},get:function(b){if(typeof AJS.overrides[b]!="undefined"){return AJS.overrides[b]}var a=jQuery("meta[name='ajs-"+b+"']");if(!a.length){return undefined}var c=a.attr("content");return AJS.asBooleanOrString(c)},getBoolean:function(a){return this.get(a)===true},getNumber:function(a){return +this.get(a)},getAllAsMap:function(){var a={};jQuery("meta[name^=ajs-]").each(function(){a[this.name.substring(4)]=this.content});return jQuery.extend(a,AJS.overrides)}});if(typeof Class==="undefined"){(function(){begetObject=function(d){var c=function(){};c.prototype=d;return new c()};var a=false,b=/xyz/.test(function(){xyz})?/\b_super\b/:/.*/;this.Class=function(){};Class.extend=function(){var j;var g=this.prototype;if(arguments.length>1){var i=AJS.$.makeArray(arguments);j=i.pop();var h;AJS.$.each(i,function(l,k){if(h){h=h.extend(k)}else{h=k}});return h.extend(this.prototype).extend(j)}else{j=arguments[0]}a=true;var f=new this();a=false;for(var e in j){if(f[e]=typeof j[e]=="function"&&typeof g[e]=="function"&&b.test(j[e])){f[e]=(function(k,l){return function(){var n=this._super;this._super=g[k];var m=l.apply(this,arguments);this._super=n;return m}})(e,j[e])}else{if(typeof g[e]==="object"){var d=begetObject(j[e]);AJS.$.each(g[e],function(l,m){if(!d[l]){d[l]=m}else{if(typeof d[l]==="object"){var k=begetObject(d[l]);AJS.$.each(m,function(o,n){if(!k[o]){k[o]=n}});d[l]=k}}});f[e]=d}else{f[e]=j[e]}}}function c(){if(!a&&this.init){this.init.apply(this,arguments)}}c.fn=c.prototype=f;c.constructor=c;c.extend=arguments.callee;return c}})()};
}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.atlassian.plugin.notifications.notifications-module:notification-util', location = '/js/FormDialog.js' */
(function(){AJS.namespace("Notifications.FormDialog");Notifications.FormDialog=Class.extend({init:function(b){var a=this;this.options=b;this.$trigger=AJS.$(this.options.trigger);this.url=this.$trigger.attr("href");this.options.id=this.options.id||"notifiations-form-dialog";AJS.$(".notifications-form-dialog").remove();this.dialog=new AJS.Dialog({width:this.options.width||810,height:this.options.height||600,id:this.options.id});AJS.$(this.dialog.popup.element).addClass("notifications-form-dialog");this.ajaxOptions=AJS.$.extend({url:this.url,success:function(c){a._renderContents(c);a.dialog.show()},error:function(c){alert("\u0412\u043e\u0437\u043d\u0438\u043a\u043b\u0430 \u043d\u0435\u0438\u0437\u0432\u0435\u0441\u0442\u043d\u0430\u044f \u043e\u0448\u0438\u0431\u043a\u0430. \u041f\u0435\u0440\u0435\u0437\u0430\u0433\u0440\u0443\u0437\u0438\u0442\u0435 \u0441\u0442\u0440\u0430\u043d\u0438\u0446\u0443 \u0438 \u043f\u043e\u043f\u0440\u043e\u0431\u0443\u0439\u0442\u0435 \u0437\u0430\u043d\u043e\u0432\u043e.")},complete:function(d,c){a._hideLoadingIndicator()}},this.options.ajaxOptions)},show:function(){this._showLoadingIndicator();AJS.$.ajax(this.ajaxOptions)},hide:function(){this.dialog.hide()},_getThrobber:function(){if(!this.$throbber){this.$throbber=AJS.$('<span class="icon throbber loading notif-hidden"></span>');this.dialog.popup.element.find(".dialog-button-panel").prepend(this.$throbber)}return this.$throbber},_showThrobber:function(){this._getThrobber().show()},_hideThrobber:function(){this._getThrobber().hide()},_handleSubmit:function(b){var a=this;a._showThrobber();b.addClass("submitting");AJS.$(".error",b).remove();var c=b.serializeArray();AJS.$.ajax({url:b.attr("action"),type:!!this.options.edit?"PUT":"POST",contentType:"application/json",data:JSON.stringify({config:c}),success:function(d){b.removeClass("submitting");window.location.reload()},error:function(f){if(f&&f.responseText){try{var d=JSON.parse(f.responseText);if(d&&d.errors){AJS.$.each(d.errors,function(h,i){AJS.$("input[name='"+h+"']",b).after("<div class='error'>"+i+"</div>")})}if(d&&d.errorMessages){var g="";AJS.$.each(d.errorMessages,function(h,i){g+=i+"<br/>"});if(g!==""){AJS.$("#errorContainer",b).append("<div class='field-group error'>"+g+"</div>")}}}catch(e){alert("\u0412\u043e\u0437\u043d\u0438\u043a\u043b\u0430 \u043d\u0435\u0438\u0437\u0432\u0435\u0441\u0442\u043d\u0430\u044f \u043e\u0448\u0438\u0431\u043a\u0430. \u041f\u0435\u0440\u0435\u0437\u0430\u0433\u0440\u0443\u0437\u0438\u0442\u0435 \u0441\u0442\u0440\u0430\u043d\u0438\u0446\u0443 \u0438 \u043f\u043e\u043f\u0440\u043e\u0431\u0443\u0439\u0442\u0435 \u0437\u0430\u043d\u043e\u0432\u043e.")}}b.removeClass("submitting")},complete:function(e,d){a._hideThrobber()}})},_renderContents:function(f){var e=AJS.$(f),a=this,c=AJS.$(":header:first",e);this.dialog.addHeader(c.text());c.remove();this.dialog.addPanel(this.options.id);var b=this.dialog.getPanel(0,0);b.html(e);e.find("form").submit(function(i){i.preventDefault();var h=AJS.$(this);a._handleSubmit.call(a,h)});var d=AJS.$("div.buttons-container",e);var g=d.find(".button:first");this.dialog.addButton(g.val(),function(){e.find("form").submit()},"aui-button "+g.attr("id"));this.dialog.addLink("\u041e\u0442\u043c\u0435\u043d\u0438\u0442\u044c",function(){a.hide()},"cancel-dialog");d.remove();if(this.options.decorateContents){this.options.decorateContents(e)}this.dialog.popup.element.addClass("jira-dialog-content-ready")},_showLoadingIndicator:function(){var a=this,b=440,c=0;clearInterval(this.loadingTimer);this._getLoadingIndicator().show();this.loadingTimer=window.setInterval(function(){if(c===b){c=0}c=c+40;a._getLoadingIndicator().css("backgroundPosition","0 -"+c+"px")},50)},_hideLoadingIndicator:function(){clearInterval(this.loadingTimer);this._getLoadingIndicator().hide()},_getLoadingIndicator:function(){if(!this.loadingIndicator){this.loadingIndicator=AJS.$('<div class="aui-loading"></div>');this.loadingIndicator.appendTo("body")}return this.loadingIndicator}})})();
}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.atlassian.plugin.notifications.notifications-module:notification-prefs', location = '/js/userprefs.js' */
(function(){var c=function(e){var d=e.attr("data-notifications-module-preference-rest-url");if(d!==undefined){return AJS.contextPath()+d}else{return AJS.contextPath()+"/rest/notifications/1.0/user/notifications/"+e.val()}};var b=function(h){var g=AJS.$(this),f="DELETE";var i=g.is(":checked");if(i){f="PUT"}var d=AJS.$('<span class="icon throbber loading"></span>');g.hide().after(d);AJS.trigger("notifications.userpreferences.changed.start",i);AJS.$.ajax({url:c(g),type:f,contentType:"application/json",success:function(){d.remove();g.show();AJS.trigger("notifications.userpreferences.changed.end",i)},error:function(e){alert("\u0412\u043e\u0437\u043d\u0438\u043a\u043b\u0430 \u043d\u0435\u0438\u0437\u0432\u0435\u0441\u0442\u043d\u0430\u044f \u043e\u0448\u0438\u0431\u043a\u0430. \u041f\u0435\u0440\u0435\u0437\u0430\u0433\u0440\u0443\u0437\u0438\u0442\u0435 \u0441\u0442\u0440\u0430\u043d\u0438\u0446\u0443 \u0438 \u043f\u043e\u043f\u0440\u043e\u0431\u0443\u0439\u0442\u0435 \u0437\u0430\u043d\u043e\u0432\u043e.");if(g.is(":checked")){g.removeAttr("checked")}else{g.attr("checked","checked")}d.remove();g.show();AJS.trigger("notifications.userpreferences.changed.end",{error:e})}})};var a=function(f){f.preventDefault();var d={mappings:AJS.$(this).serializeArray()};AJS.$("#user-server-mapping-form .success-msg").empty();AJS.$(AJS.$.ajax({url:AJS.contextPath()+"/rest/notifications/1.0/user/mapping",type:"PUT",contentType:"application/json",data:JSON.stringify(d),success:function(){AJS.messages.success("#user-server-mapping-form .success-msg",{title:"\u0418\u0437\u043c\u0435\u043d\u0435\u043d\u0438\u044f \u0443\u0441\u043f\u0435\u0448\u043d\u043e \u0441\u043e\u0445\u0440\u0430\u043d\u0435\u043d\u044b!",closeable:false})},error:function(e){alert("\u0412\u043e\u0437\u043d\u0438\u043a\u043b\u0430 \u043d\u0435\u0438\u0437\u0432\u0435\u0441\u0442\u043d\u0430\u044f \u043e\u0448\u0438\u0431\u043a\u0430. \u041f\u0435\u0440\u0435\u0437\u0430\u0433\u0440\u0443\u0437\u0438\u0442\u0435 \u0441\u0442\u0440\u0430\u043d\u0438\u0446\u0443 \u0438 \u043f\u043e\u043f\u0440\u043e\u0431\u0443\u0439\u0442\u0435 \u0437\u0430\u043d\u043e\u0432\u043e.")}})).throbber({target:"#user-server-mapping-form .throbber"})};AJS.$(function(){var d=AJS.$("body");d.undelegate("#user-prefs-form input.checkbox");d.undelegate("#user-server-mapping-form");d.delegate("#user-prefs-form input.checkbox","change",b);d.delegate("#user-server-mapping-form","submit",a);if(typeof AJS.HelpTip!=="undefined"){d.bind("notifications-panel-loaded",function(){var e=AJS.$(".first-server-mapping");if(e.length>0){var f=new AJS.HelpTip({id:"notification.server.identity",title:"\u0423\u0441\u0442\u0430\u043d\u043e\u0432\u0438\u0442\u0435 \u0441\u0432\u043e\u044e \u043b\u0438\u0447\u043d\u043e\u0441\u0442\u044c!",body:AJS.format("\u0423\u043a\u0430\u0436\u0438\u0442\u0435 ID \u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u0435\u043b\u044f, \u0441\u043e\u043e\u0442\u0432\u0435\u0442\u0441\u0442\u0432\u0443\u044e\u0449\u0438\u0439 \u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u0435\u043b\u044e \u0434\u043b\u044f \u0432\u0441\u0435\u0445 \u0440\u0430\u0437\u043b\u0438\u0447\u043d\u044b\u0445 \u0441\u0435\u0440\u0432\u0435\u0440\u043e\u0432 \u0443\u0432\u0435\u0434\u043e\u043c\u043b\u0435\u043d\u0438\u0439, \u043f\u0435\u0440\u0435\u0447\u0438\u0441\u043b\u0435\u043d\u043d\u044b\u0445 \u0437\u0434\u0435\u0441\u044c. \n\n \u041d\u0430\u043f\u0440\u0438\u043c\u0435\u0440, \u0435\u0441\u043b\u0438 \u043a\u043e\u043c\u043f\u0430\u043d\u0438\u044f \u0438\u0441\u043f\u043e\u043b\u044c\u0437\u0443\u0435\u0442 \u0441\u0435\u0440\u0432\u0435\u0440 XMPP, \u0430 XMPP-\u0438\u0434\u0435\u043d\u0442\u0438\u0444\u0438\u043a\u0430\u0446\u0438\u044f \u0432\u044b\u0440\u0430\u0436\u0430\u0435\u0442\u0441\u044f \u043f\u0430\u0440\u0430\u043c\u0435\u0442\u0440\u043e\u043c {0}@chat.yourcompany.com, \u0443\u0441\u0442\u0430\u043d\u043e\u0432\u0438\u0442\u0435 \u0437\u0434\u0435\u0441\u044c \u044d\u0442\u043e \u0437\u043d\u0430\u0447\u0435\u043d\u0438\u0435 \u0434\u043b\u044f \u0438\u0434\u0435\u043d\u0442\u0438\u0444\u0438\u043a\u0430\u0446\u0438\u0438 \u0441\u043e\u0431\u0441\u0442\u0432\u0435\u043d\u043d\u043e\u0439 \u043b\u0438\u0447\u043d\u043e\u0441\u0442\u0438.",AJS.Meta.get("remote-user")),anchor:e});e.focus(function(){f.dismiss()});f.show()}})}})})();
}catch(e){WRMCB(e)};